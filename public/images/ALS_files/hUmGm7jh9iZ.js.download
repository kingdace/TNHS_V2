;/*FB_PKG_DELIM*/

__d("MWChatMediaViewerControls.react",["fbt","FDSCircleButton.react","FDSShareFilled20Icon","FDSTooltip.react","Int64Hooks","LSFactory","LSIntEnum","LSMessagePointQueryStoredProcedure","LSVerifyThreadRowExistsStoredProcedure","MWChatMessageId","MWXCircleButton.react","MWXIconDownload","MWXRow.react","MWXRowItem.react","ODS","ReQL","ReQLSuspense","emptyFunction","promiseDone","react","react-compiler-runtime","useMWChatForward","useMWV2ForwardMessage","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m=d||(d=o("react")),p=d.useCallback,_=s._(/*BTDS*/"Download"),f=s._(/*BTDS*/"Forward");function g(t,n){var a=o("react-compiler-runtime").c(18),l=(e||(e=r("useReStore")))(),s,c;a[0]!==l||a[1]!==n?(s=function(){return n!=null?o("ReQL").fromTableAscending(l.tables.threads,["threadType"]).getKeyRange(n).map(h):o("ReQL").empty()},c=[l,n],a[0]=l,a[1]=n,a[2]=s,a[3]=c):(s=a[2],c=a[3]);var d=o("ReQLSuspense").useFirst(s,c,i.id+":63"),m,p;a[4]!==l||a[5]!==t?(m=function(){return t!=null?o("ReQL").fromTableAscending(l.tables.messages.index("messageId")).getKeyRange(t):o("ReQL").empty()},p=[l,t],a[4]=l,a[5]=t,a[6]=m,a[7]=p):(m=a[6],p=a[7]);var _=o("ReQLSuspense").useFirst(m,p,i.id+":75"),f,g;a[8]!==l||a[9]!==_||a[10]!==t||a[11]!==d||a[12]!==n?(f=function(){if(!(t==null||n==null)){if(d==null){r("promiseDone")(l.runInTransaction(function(e){return r("LSVerifyThreadRowExistsStoredProcedure")(r("LSFactory")(e),{syncGroup:(u||(u=o("LSIntEnum"))).ofNumber(1),threadKey:n})},"readwrite",void 0,void 0,i.id+":91"));return}_==null&&r("promiseDone")(l.runInTransaction(function(e){return r("LSMessagePointQueryStoredProcedure")(r("LSFactory")(e),{messageId:t,threadKey:n,threadType:d})},"readwrite",void 0,void 0,i.id+":104"))}},g=[l,_,t,d,n],a[8]=l,a[9]=_,a[10]=t,a[11]=d,a[12]=n,a[13]=f,a[14]=g):(f=a[13],g=a[14]),o("Int64Hooks").useEffectInt64(f,g);var y;return a[15]!==_||a[16]!==d?(y=[_,d],a[15]=_,a[16]=d,a[17]=y):y=a[17],y}function h(e){var t=e.threadType;return t}function y(e){var t=o("react-compiler-runtime").c(11),n=e.attachmentID,a=e.canForward,i=e.downloadLink,l=e.isCrossTransportForwardEnabled,s=e.isSecureForwardEnabled,u=e.messageID,c=a===void 0?!0:a,d=l===void 0?!1:l,p=s===void 0?!1:s,g;t[0]!==i?(g=i!=null?m.jsx(r("MWXRowItem.react"),{children:m.jsx(r("FDSTooltip.react"),{align:"middle",tooltip:_,children:m.jsx(r("MWXCircleButton.react"),{icon:r("MWXIconDownload"),label:_,linkProps:{download:!0,target:"_blank",url:i},size:36,type:"dark-overlay"})})}):null,t[0]=i,t[1]=g):g=t[1];var h;t[2]!==n||t[3]!==c||t[4]!==d||t[5]!==p||t[6]!==u?(h=c===!0?m.jsx(r("MWXRowItem.react"),{children:m.jsx(r("FDSTooltip.react"),{align:"middle",tooltip:f,children:m.jsx(b,{attachmentID:n,isCrossTransportForwardEnabled:d,isSecureForwardEnabled:p,messageID:u})})}):null,t[2]=n,t[3]=c,t[4]=d,t[5]=p,t[6]=u,t[7]=h):h=t[7];var y;return t[8]!==g||t[9]!==h?(y=m.jsxs(r("MWXRow.react"),{paddingTop:0,spacing:8,children:[g,h]}),t[8]=g,t[9]=h,t[10]=y):y=t[10],y}function C(e){var t=o("react-compiler-runtime").c(8),n=e.isCrossTransportForwardEnabled,a=e.isSecureForwardEnabled,i=e.messageID,l=e.onForwardSend,s=n===void 0?!1:n,u=a===void 0?!1:a,d=u?"secure":s?"cross_transport":"open_",p;t[0]!==d||t[1]!==i||t[2]!==l?(p={forwardDialogType:d,messageID:i,onClose:r("emptyFunction"),onSend:l},t[0]=d,t[1]=i,t[2]=l,t[3]=p):p=t[3];var _=r("useMWChatForward")(p),g;t[4]!==_?(g=function(){(c||(c=o("ODS"))).bumpEntityKey(3185,"mwchat_media_viewer","forward"),_&&_.onClick()},t[4]=_,t[5]=g):g=t[5];var h=g,y;return t[6]!==h?(y=m.jsx(r("FDSCircleButton.react"),{icon:r("FDSShareFilled20Icon"),label:f,onPress:function(t){return h()},size:36,testid:void 0,type_DEPRECATED:"dark-overlay"}),t[6]=h,t[7]=y):y=t[7],y}function b(e){var t=o("react-compiler-runtime").c(11),n=e.attachmentID,r=e.isCrossTransportForwardEnabled,a=e.isSecureForwardEnabled,i=e.messageID,l=r===void 0?!1:r,s=a===void 0?!1:a,u;t[0]!==i?(u=o("MWChatMessageId").getMessageId(i),t[0]=i,t[1]=u):u=t[1];var c=u,d;t[2]!==i?(d=o("MWChatMessageId").getThreadId(i),t[2]=i,t[3]=d):d=t[3];var p=d,_=g(c,p),f=_[0],h=_[1];if(f==null||h==null)return null;var y;return t[4]!==n||t[5]!==l||t[6]!==s||t[7]!==f||t[8]!==i||t[9]!==h?(y=m.jsx(v,{attachmentID:n,isCrossTransportForwardEnabled:l,isSecureForwardEnabled:s,message:f,messageID:i,messageThreadType:h}),t[4]=n,t[5]=l,t[6]=s,t[7]=f,t[8]=i,t[9]=h,t[10]=y):y=t[10],y}function v(e){var t=o("react-compiler-runtime").c(7),n=e.attachmentID,a=e.isCrossTransportForwardEnabled,i=e.isSecureForwardEnabled,l=e.message,s=e.messageID,u=e.messageThreadType,c=a===void 0?!1:a,d=i===void 0?!1:i,p=o("useMWV2ForwardMessage").useMWV2ForwardMessage(l,u,n),_;t[0]!==p?(_=function(t){return r("promiseDone")(p(t))},t[0]=p,t[1]=_):_=t[1];var f=_,g;return t[2]!==c||t[3]!==d||t[4]!==s||t[5]!==f?(g=m.jsx(C,{isCrossTransportForwardEnabled:c,isSecureForwardEnabled:d,messageID:s,onForwardSend:f}),t[2]=c,t[3]=d,t[4]=s,t[5]=f,t[6]=g):g=t[6],g}l.default=y}),226);
__d("MWV2MediaViewerThreadCutoverWrapper.react",["LSThreadMediaGalleryGroup","MWChatAttachmentMediaState.react","MWV2MediaViewerContext.react","emptyFunction","justknobx","react","react-compiler-runtime","useMAWLoadMoreCutoverThreadSharedAttachments","useMWMaybeInboxMediaRestoreLoop","useMWV2MediaViewerOpenDownloadUrl","useMWV2MediaViewerOpenPlayableUrl","useMWV2MediaViewerOpenPreviewUrl","useMWV2MediaViewerSecurePlayableUrl_CausesSuspense","useMWV2MediaViewerSecurePreviewUrl_CausesSuspense"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useCallback;function c(e){var t=o("react-compiler-runtime").c(27),n=e.children,a=e.initialAttachment,i=e.openThreadKey,l=e.secureThreadKey,u=e.threadType,c;t[0]!==l||t[1]!==u?(c={threadKey:l,threadType:u},t[0]=l,t[1]=u,t[2]=c):c=t[2],r("useMWMaybeInboxMediaRestoreLoop")(c);var m;t[3]===Symbol.for("react.memo_cache_sentinel")?(m={entrypoint:"media_viewer"},t[3]=m):m=t[3];var p;t[4]===Symbol.for("react.memo_cache_sentinel")?(p=r("justknobx")._("3233"),t[4]=p):p=t[4];var _=r("useMAWLoadMoreCutoverThreadSharedAttachments")(l,i,u,m,r("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS,!1,p),f=_.attachments,g=_.onLoadMore,h=d,y=r("useMWV2MediaViewerOpenPreviewUrl")(),C=r("useMWV2MediaViewerOpenPlayableUrl")(),b=r("useMWV2MediaViewerOpenDownloadUrl")(),v=r("useMWV2MediaViewerSecurePreviewUrl_CausesSuspense")(),S=r("useMWV2MediaViewerSecurePlayableUrl_CausesSuspense")(),R;t[5]!==y||t[6]!==v?(R=function(t,n,r){return t?h(t)?v(t,n,r):y(t,n,r):""},t[5]=y,t[6]=v,t[7]=R):R=t[7];var L=R,E;t[8]!==C||t[9]!==S?(E=function(t,n,r){return t==null?"":h(t)?S(t,n,r):C(t,n,r)},t[8]=C,t[9]=S,t[10]=E):E=t[10];var k=E,I;t[11]!==b||t[12]!==S?(I=function(t,n,r){return t==null?"":h(t)?S(t,n,r):b(t,n,r)},t[11]=b,t[12]=S,t[13]=I):I=t[13];var T=I,D;t[14]!==f||t[15]!==n||t[16]!==k||t[17]!==L||t[18]!==a?(D=s.jsx(o("MWChatAttachmentMediaState.react").MWChatAttachmentMediaStateProviderFromAttachments,{attachments:f,getIsSecureThread:h,getPlayableUrl:k,getPreviewUrl:L,initialAttachment:a,children:n}),t[14]=f,t[15]=n,t[16]=k,t[17]=L,t[18]=a,t[19]=D):D=t[19];var x;return t[20]!==f||t[21]!==T||t[22]!==k||t[23]!==L||t[24]!==g||t[25]!==D?(x=s.jsx(o("MWV2MediaViewerContext.react").MWV2MediaViewerContextProvider,{getDownloadUrl:T,getPlayableUrl:k,getPreviewUrl:L,heroLoggingComponent:r("emptyFunction"),loadMore:g,media:f,children:D}),t[20]=f,t[21]=T,t[22]=k,t[23]=L,t[24]=g,t[25]=D,t[26]=x):x=t[26],x}function d(e){return!((e==null?void 0:e.transportKey)==="FBBroker"||(e==null?void 0:e.transportKey)==="FBLegacyBroker")}l.default=c}),98);