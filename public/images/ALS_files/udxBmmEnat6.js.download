;/*FB_PKG_DELIM*/

__d("LSDeleteRollCallContribution",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.db.table(255).fetch([[[e[0],e[1],e[2],e[3],e[4]]]]),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxDeleteRollCallContributionStoredProcedure",e.__tables__=["roll_call_contributions_v2"],a.exports=e}),null);
__d("LSHandleRepliesOnUnsend",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return r[0]=t.createArray(),t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"replySourceIdMessageID"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.replySourceId===e[1]}),function(e){var t=e.item;return r[2]=(r[0].push(t.messageId),r[0])})},function(o){return r[1]=t.i64.of_int32(r[0].length),t.i64.eq(r[1],t.i64.cast([0,0]))?t.resolve():(r[2]=new t.Map,r[2].set("thread_key",e[0]),r[2].set("message_id",e[1]),r[2].set("reply_message_ids",r[0]),r[3]=t.toJSON(r[2]),t.storedProcedure(n("LSIssueNewTask"),"update_replies_on_unsend",t.i64.cast([0,74]),r[3],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0])))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxHandleRepliesOnUnsendStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSUpdateRecentXMAForRollCallMessageDeleted",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.islc(t.sortBy(t.filter(t.db.table(255).fetch(),function(n){return t.i64.eq(n.rollCallId,e[0])&&e[1]!==n.messageId}),[["messageTimestampMs","DESC"]]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a=e.done,i=e.value;return a?0:(o=i.item,t.sequence([function(e){return r[5]=o.threadKey,t.db.table(9).fetch([[[r[5]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[0]=t.i64.cast([0,1]):(n=a.item,r[7]=n.syncGroup,t.i64.neq(r[7],void 0)?r[6]=r[7]:r[6]=t.i64.cast([0,1]),r[0]=r[6])})},function(e){return r[2]=new t.Map,r[2].set("message_id",o.messageId),r[2].set("thread_key",r[5]),r[2].set("sync_group",r[0]),r[3]=r[2].get("thread_key"),r[4]=t.toJSON(r[2]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[3]),t.i64.cast([0,19]),r[4],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}]))})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateRecentXMAForRollCallMessageDeletedStoredProcedure",e.__tables__=["roll_call_contributions_v2","threads"],a.exports=e}),null);
__d("LSUpdateRollCall",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.db.table(250).fetch([[[e[0]]]]),function(t){var n=t.update,r=t.item;return n({viewerHasContributed:e[1],isBlurred:e[2]})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateRollCallStoredProcedure",e.__tables__=["roll_calls"],a.exports=e}),null);
__d("LSUpdateForRollCallMessageDeleted",["LSDeleteRollCallContribution","LSGetViewerFBID","LSUpdateRecentXMAForRollCallMessageDeleted","LSUpdateRollCall"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.filter(t.db.table(255).fetch(),function(t){return t.messageId===e[0]}).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0,void 0],r[0]=n[0],r[1]=n[1],r[2]=n[2],n):(t=i.item,o=[t.rollCallId,t.messageTimestampMs,t.rollCallContributionId],r[0]=o[0],r[1]=o[1],r[2]=o[2])})},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[4]=t[0],t})},function(n){return t.filter(t.db.table(255).fetch(),function(n){return t.i64.eq(r[0],n.rollCallId)&&e[0]!==n.messageId&&t.i64.eq(r[4],n.contributorId)}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[5]=!1:(t=o.item,r[5]=!0)})},function(e){return t.filter(t.db.table(250).fetch(),function(e){return t.i64.eq(r[0],e.rollCallId)}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[7]=!1:(t=o.item,r[7]=t.canViewWithoutContributing)})},function(o){return t.i64.neq(r[0],void 0)?t.sequence([function(o){return t.storedProcedure(n("LSUpdateRecentXMAForRollCallMessageDeleted"),r[0],e[0])},function(e){return r[7]?r[9]=!1:r[9]=!r[5],t.storedProcedure(n("LSUpdateRollCall"),r[0],r[5],r[9])},function(o){return t.i64.neq(r[1],void 0)&&t.i64.neq(r[2],void 0)?t.storedProcedure(n("LSDeleteRollCallContribution"),r[2],r[0],e[0],r[1],e[1]):t.resolve()}]):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateForRollCallMessageDeletedStoredProcedure",e.__tables__=["roll_call_contributions_v2","roll_calls"],a.exports=e}),null);
__d("LSUpdateRepliesOnSharedAlbumContributionDeletion",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"replySourceIdMessageID"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.replySourceId===e[1]&&t.i64.eq(n.replyAttachmentId,e[2])}),function(e){var t=e.update,n=e.item;return t({replySourceId:void 0,replyStatus:void 0,replyMessageText:void 0,replyMediaExpirationTimestampMs:void 0,replyMediaUrl:void 0,replyMediaPreviewWidth:void 0,replyMediaPreviewHeight:void 0,replyMediaUrlMimeType:void 0,replyMediaUrlFallback:void 0,replyAttachmentId:void 0,replyAttachmentExtra:void 0,replySourceType:void 0,replySourceTypeV2:void 0})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateRepliesOnSharedAlbumContributionDeletionStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSUpdateSharedAlbumOnMessageRecall",["LSArrayGetObjectAt","LSIssueNewTask","LSUpdateRepliesOnSharedAlbumContributionDeletion"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=new t.Map,t.forEach(t.filter(t.db.table(280).fetch(),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(e){var o=e.item;return t.sequence([function(e){return r[3]=o.sharedAlbumId,r[4]=o.sharedAlbumContributionId,r[5]=o.threadKey,r[0].set(t.i64.to_string(r[3]),r[3]),t.storedProcedure(n("LSUpdateRepliesOnSharedAlbumContributionDeletion"),r[5],t.i64.to_string(r[3]),r[4])},function(e){return t.forEach(t.db.table(280).fetch([[[r[3],r[4],r[5],o.messageId]]]),function(e){return e.delete()})}])})},function(o){return r[1]=r[0].keys(),r[2]=t.i64.of_int32(r[1].length),t.i64.gt(r[2],t.i64.cast([0,0]))?t.loopAsync(r[2],function(o){return r[3]=o,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[1],r[3]).then(function(e){var t;return t=e,r[4]=t[0],r[5]=t[1],t})},function(o){return r[6]=r[0].get(r[4]),t.forEach(t.filter(t.db.table(16).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.eq(n.collapsibleId,r[6])}),function(o){var a=o.item;return t.sequence([function(n){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[7]=t.i64.cast([0,1]):(n=a.item,r[13]=n.syncGroup,t.i64.neq(r[13],void 0)?r[12]=r[13]:r[12]=t.i64.cast([0,1]),r[7]=r[12])})},function(o){return r[9]=new t.Map,r[9].set("message_id",a.messageId),r[9].set("thread_key",e[0]),r[9].set("sync_group",r[7]),r[10]=r[9].get("thread_key"),r[11]=t.toJSON(r[9]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[10]),t.i64.cast([0,19]),r[11],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}])})}])}):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateSharedAlbumOnMessageRecallStoredProcedure",e.__tables__=["shared_album_contributions","attachments","threads"],a.exports=e}),null);
__d("LSUpdateUnsentMessageCollapsedStatus",["LSCollapseAttachments"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.filter(t.db.table(16).fetch([[[e[0],e[2],e[1]]],"fk_messages"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]&&t.i64.eq(n.timestampMs,e[2])&&t.i64.neq(n.collapsibleId,void 0)}).next().then(function(o,a){var i=o.done,l=o.value;return i?0:(a=l.item,t.sequence([function(n){return r[0]=a.collapsibleId,t.forEach(t.db.table(16).fetch([[[e[0],e[2],e[1]]],"fk_messages"]),function(e){var t=e.update,n=e.item;return t({collapsibleId:void 0})})},function(o){return t.i64.neq(r[0],void 0)?t.storedProcedure(n("LSCollapseAttachments"),e[0],r[0]):t.resolve()}]))})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateUnsentMessageCollapsedStatusStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);