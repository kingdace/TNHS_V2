;/*FB_PKG_DELIM*/

__d("CometPhotoViewerImageSuspense",["Promise","PromiseAnnotate","promiseDone","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e=["ref"],s,u,c,d=c||(c=o("react")),m=document.body,p=typeof jest=="undefined"&&document!==void 0&&typeof document.createElement=="function";function _(e){return new(s||(s=n("Promise")))(function(t){if(!p||m==null)return t();var n=document.createElement("img");n.onload=n.onerror=t,n.src=e})}var f=new Map,g=2e3,h={get:function(t){var e=f.get(t);if(e!=null)return f.delete(t),f.set(t,e),e},set:function(t,n){if(f.delete(t),f.set(t,n),f.size>g){var e=f.keys().next();e.done||f.delete(e.value)}}};function y(e){if(e!=null){var t=h.get(e);if(t!=null){if(t.pending===!0)throw t.promise;return}var n=_(e);r("promiseDone")((u||(u=o("PromiseAnnotate"))).setDisplayName(n,"SuspenseImage"));var a={pending:!0,promise:n};throw r("promiseDone")(n.then(function(){a.pending===!0&&(a.pending=!1)})),h.set(e,a),n}}function C(t){var n=o("react-compiler-runtime").c(6),r,a;n[0]!==t?(a=t.ref,r=babelHelpers.objectWithoutPropertiesLoose(t,e),n[0]=t,n[1]=r,n[2]=a):(r=n[1],a=n[2]),y(r.src);var i;return n[3]!==r||n[4]!==a?(i=d.jsx("img",babelHelpers.extends({},r,{ref:a})),n[3]=r,n[4]=a,n[5]=i):i=n[5],i}l.default=C}),98);
__d("CometPhotoViewerInnerWrapper.react",["CometRouteRenderType","react","react-compiler-runtime","stylex"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=500,d=52,m={backgroundContainer:{alignItems:"x6s0dn4",display:"x78zum5",justifyContent:"xl56j7k",minHeight:"x1xoerdy",$$css:!0},backgroundContainerDialog:{height:"x1dr59a3",$$css:!0},backgroundContainerDialogWithFooter:{height:"x4uq5q4",$$css:!0},backgroundContainerTabs:{height:"xtp0wl1",$$css:!0},backgroundContainerTabsWithFooter:{height:"xossbfl",$$css:!0},image:{height:"xt7dq6l",maxWidth:"x193iq5w",width:"x14atkfc",$$css:!0},maxImageHeightDialog:{maxHeight:"x1bwycvy",$$css:!0},maxImageHeightDialogWithFooter:{maxHeight:"x4ju7c5",$$css:!0},maxImageHeightTabs:{maxHeight:"x85a59c",$$css:!0},maxImageHeightTabsWithFooter:{maxHeight:"x1wlxzsl",$$css:!0},passthroughImage:{backgroundPosition:"x1lvsgvq",backgroundRepeat:"xiy17q3",backgroundSize:"x1tbiz1a",height:"x5yr21d",width:"xh8yej3",$$css:!0},placeholderContainer:{width:"xh8yej3",$$css:!0}};function p(t,n){var a=o("react-compiler-runtime").c(6),i=t===void 0?!1:t,l=n===void 0?!1:n,s=o("CometRouteRenderType").useIsPushView(),u=!i&&s&&m.backgroundContainerDialog,c=!i&&!s&&m.backgroundContainerTabs,d=i&&s&&m.backgroundContainerDialogWithFooter,p=i&&!s&&m.backgroundContainerTabsWithFooter,_=l&&m.placeholderContainer,f;return a[0]!==u||a[1]!==c||a[2]!==d||a[3]!==p||a[4]!==_?(f=(e||(e=r("stylex")))(m.backgroundContainer,u,c,d,p,_),a[0]=u,a[1]=c,a[2]=d,a[3]=p,a[4]=_,a[5]=f):f=a[5],f}function _(t,n){var a=o("react-compiler-runtime").c(7),i=o("CometRouteRenderType").useIsPushView(),l=!t&&i&&m.maxImageHeightDialog,s=!t&&!i&&m.maxImageHeightTabs,u=t&&i&&m.maxImageHeightDialogWithFooter,c=t&&!i&&m.maxImageHeightTabsWithFooter,d=n&&m.passthroughImage,p=!n&&m.image,_;return a[0]!==l||a[1]!==s||a[2]!==u||a[3]!==c||a[4]!==d||a[5]!==p?(_=(e||(e=r("stylex")))(l,s,u,c,d,p),a[0]=l,a[1]=s,a[2]=u,a[3]=c,a[4]=d,a[5]=p,a[6]=_):_=a[6],_}function f(e,t){var n=o("react-compiler-runtime").c(7),r=o("CometRouteRenderType").useIsPushView(),a=!e&&r&&m.maxImageHeightDialog,i=!e&&!r&&m.maxImageHeightTabs,l=e&&r&&m.maxImageHeightDialogWithFooter,s=e&&!r&&m.maxImageHeightTabsWithFooter,u=t&&m.passthroughImage,c=!t&&m.image,d;return n[0]!==a||n[1]!==i||n[2]!==l||n[3]!==s||n[4]!==u||n[5]!==c?(d=[a,i,l,s,u,c],n[0]=a,n[1]=i,n[2]=l,n[3]=s,n[4]=u,n[5]=c,n[6]=d):d=n[6],d}function g(e){var t=o("react-compiler-runtime").c(10),n=e.height,r=e.imageUri,a=e.ref,i=e.showPlaceholderImage,l=e.width,s=e.withFooter,c=i===void 0?!0:i,d=s===void 0?!1:s,m=_(d,!0),f=p(!1,!0),g=a!=null?a:null,h;t[0]!==n||t[1]!==r||t[2]!==m||t[3]!==c||t[4]!==l?(h=r!=null&&c&&u.jsx("div",{className:"x6s0dn4 x78zum5 xl56j7k xmz0i5r x1n2onr6 x5yr21d xh8yej3",children:u.jsx("div",{className:m,style:n!=null&&l!=null?{backgroundImage:"url("+r+")",maxHeight:n,maxWidth:l}:{backgroundImage:"url("+r+")"}},r)}),t[0]=n,t[1]=r,t[2]=m,t[3]=c,t[4]=l,t[5]=h):h=t[5];var y;return t[6]!==f||t[7]!==g||t[8]!==h?(y=u.jsx("div",{className:f,ref:g,children:h}),t[6]=f,t[7]=g,t[8]=h,t[9]=y):y=t[9],y}function h(e){var t=o("react-compiler-runtime").c(9),n=e.imageComponent,r=e.imageComponentWithXStyle,a=e.ref,i=e.withFooter,l=i===void 0?!1:i,s=_(l,!1),c=f(l,!1),d;t[0]===Symbol.for("react.memo_cache_sentinel")?(d={className:"x6s0dn4 x78zum5 xl56j7k xmz0i5r x1n2onr6"},t[0]=d):d=t[0];var m;t[1]!==n||t[2]!==r||t[3]!==s||t[4]!==c?(m=n!=null?n(s):r!=null?r(c):null,t[1]=n,t[2]=r,t[3]=s,t[4]=c,t[5]=m):m=t[5];var p;return t[6]!==a||t[7]!==m?(p=u.jsx("div",babelHelpers.extends({},d,{ref:a,children:m})),t[6]=a,t[7]=m,t[8]=p):p=t[8],p}var y=h,C=g;l.useCometPhotoViewerContainerStyles=p,l.CometPhotoViewerImageWrapper=y,l.CometPhotoViewerPlaceholderWrapper=C}),98);
__d("MWChatDeleteMessageEventEmitter",["BaseEventEmitter"],(function(t,n,r,o,a,i,l){"use strict";var e="deleteMessage",s=new(r("BaseEventEmitter"));function u(t){s.emit(e,t)}function c(t){var n=s.addListener(e,t);return function(){return n.remove()}}l.emit=u,l.subscribe=c}),98);
__d("MWChatMediaData",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return t==null||t.__typename!=="MessageVideo"||t.sdUrl==null||t.image_thumb==null||t.image_thumb.uri==null||t.image_thumb.width==null||t.image_thumb.height==null||t.original_dimensions==null||t.original_dimensions.x==null||t.original_dimensions.y==null?null:{hdUrl:t.hdUrl,imageThumb:{height:t.image_thumb.height,uri:t.image_thumb.uri,width:t.image_thumb.width},legacyAttachmentID:t.legacy_attachment_id,originalDimensions:{x:t.original_dimensions.x,y:t.original_dimensions.y},sdUrl:t.sdUrl}},l=function(t){return t==null||t.__typename!=="MessageImage"||t.image==null||t.image.uri==null||t.image.width==null||t.image.height==null||t.image_thumb==null||t.image_thumb.uri==null||t.image_thumb.width==null||t.image_thumb.height==null?null:{blurredImageUri:t.blurred_image_uri,image:{downloadableUri:t.image.downloadable_uri,height:t.image.height,uri:t.image.uri,width:t.image.width},imageThumb:{height:t.image_thumb.height,uri:t.image_thumb.uri,width:t.image_thumb.width},legacyAttachmentID:t.legacy_attachment_id}},s=function(t){return t==null||t.__typename!=="MessageAnimatedImage"||t.image==null||t.image.uri==null||t.image.width==null||t.image.height==null||t.image_thumb==null||t.image_thumb.uri==null||t.image_thumb.width==null||t.image_thumb.height==null?null:{blurredImageUri:null,image:{downloadableUri:t.image.downloadable_uri,height:t.image.height,uri:t.image.uri,width:t.image.width},imageThumb:{height:t.image_thumb.height,uri:t.image_thumb.uri,width:t.image_thumb.width},legacyAttachmentID:t.legacy_attachment_id}},u=function(n){return n.reduce(function(t,n){if(n==null||n.node==null||n.node.id==null||n.node.message_id==null||n.node.blob_attachments==null||n.cursor==null)return t;var r=n.node,o=r.blob_attachments,a=r.id,i=r.message_id,u=r.timestamp_precise,c=n.cursor,d=o.map(function(t){if(t.__typename==="MessageImage"){var n=l(t);return n==null?null:{__typename:"MessageImage",attachment:n,cursor:c,messageID:i,nodeID:a,timestamp:u}}else if(t.__typename==="MessageVideo"){var r=e(t);return r==null?null:{__typename:"MessageVideo",attachment:r,cursor:c,messageID:i,nodeID:a,timestamp:u}}else if(t.__typename==="MessageAnimatedImage"){var o=s(t);return o==null?null:{__typename:"MessageAnimatedImage",altText:t.animated_image_caption,attachment:o,cursor:c,messageID:i,nodeID:a,timestamp:u}}else return null}).filter(Boolean);return t.concat(d)},[]).filter(Boolean)};i.normalizeMessages=u}),66);
__d("MWChatMediaReducer",[],(function(t,n,r,o,a,i){"use strict";var e={curIdx:0,hasNextPage:!1,hasPrevPage:!1,initialCursor:null,isFetchingNextPage:!1,isFetchingPrevPage:!1,mediaList:[]},l=function(t,n){switch(n.type){case"initialize":return babelHelpers.extends({},t,{curIdx:n.curIdx,initialCursor:n.initialCursor,mediaList:n.mediaList});case"startFetchingNextPage":return babelHelpers.extends({},t,{isFetchingNextPage:!0});case"startFetchingPrevPage":return babelHelpers.extends({},t,{isFetchingPrevPage:!0});case"prevPageReceived":return babelHelpers.extends({},t,{curIdx:t.curIdx+n.medias.length,hasPrevPage:n.hasPrevPage,isFetchingPrevPage:!1,mediaList:n.medias.concat(t.mediaList)});case"nextPageReceived":return babelHelpers.extends({},t,{hasNextPage:n.hasNextPage,isFetchingNextPage:!1,mediaList:t.mediaList.concat(n.medias)});case"messageDeleted":return babelHelpers.extends({},t,{curIdx:Math.min(Math.max(n.curIdx,0),t.mediaList.length-1),mediaList:n.mediaList});case"viewMediaAtIndex":return babelHelpers.extends({},t,{curIdx:Math.min(Math.max(n.curIdx,0),t.mediaList.length-1)});default:return t}};i.initialState=e,i.reducer=l}),66);
__d("MWChatMediaRootQuery.graphql",["MWChatMediaRootQuery_facebookRelayOperation","relay-runtime"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={defaultValue:null,kind:"LocalArgument",name:"after"},t={defaultValue:null,kind:"LocalArgument",name:"before"},r={defaultValue:null,kind:"LocalArgument",name:"first"},o={defaultValue:null,kind:"LocalArgument",name:"last"},a={defaultValue:null,kind:"LocalArgument",name:"messageID"},i={defaultValue:null,kind:"LocalArgument",name:"scale"},l={defaultValue:null,kind:"LocalArgument",name:"threadID"},s=[{kind:"Variable",name:"id",variableName:"threadID"}],u={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"folder",storageKey:null},d=[{kind:"Variable",name:"after",variableName:"after"},{kind:"Literal",name:"ascending",value:!0},{kind:"Variable",name:"before",variableName:"before"},{kind:"Variable",name:"first",variableName:"first"},{kind:"Variable",name:"last",variableName:"last"},{kind:"Variable",name:"message_id",variableName:"messageID"},{kind:"Literal",name:"message_shared_media_type",value:"PHOTO_VIDEO_AND_GIF"}],m={alias:null,args:null,kind:"ScalarField",name:"message_id",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"legacy_attachment_id",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"width",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"height",storageKey:null},C=[g,h,y,{alias:null,args:null,kind:"ScalarField",name:"downloadable_uri",storageKey:null}],b={alias:"image_thumb",args:[{kind:"Literal",name:"height",value:250},{kind:"Literal",name:"width",value:250}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:[g,h,y],storageKey:"image(height:250,width:250)"},v={kind:"InlineFragment",selections:[f,{alias:null,args:null,kind:"ScalarField",name:"blurred_image_uri",storageKey:null},{alias:null,args:[{kind:"Literal",name:"height",value:2048},{kind:"Variable",name:"scale",variableName:"scale"},{kind:"Literal",name:"width",value:2048}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:C,storageKey:null},b],type:"MessageImage",abstractKey:null},S={kind:"InlineFragment",selections:[f,{alias:"sdUrl",args:[{kind:"Literal",name:"quality",value:"SD"}],kind:"ScalarField",name:"playable_url",storageKey:'playable_url(quality:"SD")'},{alias:"hdUrl",args:[{kind:"Literal",name:"quality",value:"HD"}],kind:"ScalarField",name:"playable_url",storageKey:'playable_url(quality:"HD")'},b,{alias:null,args:null,concreteType:"Vect2",kind:"LinkedField",name:"original_dimensions",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"x",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"y",storageKey:null}],storageKey:null}],type:"MessageVideo",abstractKey:null},R={kind:"InlineFragment",selections:[f,{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:C,storageKey:null},b,{alias:null,args:null,kind:"ScalarField",name:"animated_image_caption",storageKey:null}],type:"MessageAnimatedImage",abstractKey:null},L={alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},E={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"page_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_next_page",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_previous_page",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:[e,t,r,o,a,i,l],kind:"Fragment",metadata:null,name:"MWChatMediaRootQuery",selections:[{alias:null,args:s,concreteType:"MessageThread",kind:"LinkedField",name:"message_thread",plural:!1,selections:[u,c,{alias:null,args:d,concreteType:"MessagesWithAttachmentsOfThreadConnection",kind:"LinkedField",name:"messages_with_attachments",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagesWithAttachmentsOfThreadEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{kind:"InlineFragment",selections:[m,u,p,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:[_,v,S,R],storageKey:null}],type:"UserMessage",abstractKey:null}],storageKey:null},L],storageKey:null},E],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,a,e,r,t,o,i],kind:"Operation",name:"MWChatMediaRootQuery",selections:[{alias:null,args:s,concreteType:"MessageThread",kind:"LinkedField",name:"message_thread",plural:!1,selections:[u,c,{alias:null,args:d,concreteType:"MessagesWithAttachmentsOfThreadConnection",kind:"LinkedField",name:"messages_with_attachments",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagesWithAttachmentsOfThreadEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[_,u,{kind:"InlineFragment",selections:[m,p,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:[_,v,S,R,{kind:"InlineFragment",selections:[u],type:"Node",abstractKey:"__isNode"}],storageKey:null}],type:"UserMessage",abstractKey:null}],storageKey:null},L],storageKey:null},E],storageKey:null}],storageKey:null}]},params:{id:n("MWChatMediaRootQuery_facebookRelayOperation"),metadata:{},name:"MWChatMediaRootQuery",operationKind:"query",text:null}}})();n("relay-runtime").PreloadableQueryRegistry.set(e.params.id,e),a.exports=e}),null);
__d("MWChatMediaUtil",["ExecutionEnvironment"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(n){(e||(e=r("ExecutionEnvironment"))).canUseDOM&&n.forEach(function(e){if(typeof e=="string"){var t=new Image;t.src=e}})};l.prefetchImages=s}),98);
__d("MWChatMediaViewerImage.react",["fbt","CometHero.react","CometPageletWithDiv.react","CometPhotoViewerImageSuspense","CometPhotoViewerInnerWrapper.react","MWAnimatedImageControlsUtil","MWAnimatedImageThumbnailWithPlayButton.react","MWXPressable.react","react","react-compiler-runtime","useMWMediaViewerOpenQPLLogger","useSinglePartialViewImpression"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useState,p={pauseGIFButon:{width:"xh8yej3",$$css:!0}},_=s._(/*BTDS*/"No description available.");function f(e){var t=o("react-compiler-runtime").c(25),n=e.blurredImageURI,a=e.imageURI,i=e.isAnimatedImage,l=e.origHeight,c=e.origSrc,d=e.origWidth,f=m(!1),g=f[0],h=f[1],y=o("useMWMediaViewerOpenQPLLogger").useMWMediaViewerOpenQPLLogger(),C=y.endSuccess,b=m(!1),v=b[0],S=b[1],R=o("MWAnimatedImageControlsUtil").useGetMessengerAutoplaySetting(),L;t[0]!==C?(L=function(){C()},t[0]=C,t[1]=L):L=t[1];var E=L,k;t[2]!==E?(k={onImpressionStart:E},t[2]=E,t[3]=k):k=t[3];var I=r("useSinglePartialViewImpression")(k),T=o("CometPhotoViewerInnerWrapper.react").useCometPhotoViewerContainerStyles(!0),D=i===!0&&R!==o("MWAnimatedImageControlsUtil").MWAutoplayAnimationsSetting.ON,x;t[4]!==l||t[5]!==c||t[6]!==d?(x=c!=null?u.jsx(o("CometPhotoViewerInnerWrapper.react").CometPhotoViewerPlaceholderWrapper,{height:l,imageUri:c,showPlaceholderImage:c!=null&&d!=null&&l!=null,width:d,withFooter:!0}):null,t[4]=l,t[5]=c,t[6]=d,t[7]=x):x=t[7];var $;t[8]===Symbol.for("react.memo_cache_sentinel")?($=u.jsx(r("CometHero.react"),{description:"MWChatMediaViewerImage"}),t[8]=$):$=t[8];var P;t[9]!==n||t[10]!==a||t[11]!==v||t[12]!==g||t[13]!==l||t[14]!==d||t[15]!==D?(P=n==null||g?u.jsx(o("CometPhotoViewerInnerWrapper.react").CometPhotoViewerImageWrapper,{imageComponent:function(t){return u.jsx(u.Fragment,{children:D&&v===!1?u.jsx(o("MWAnimatedImageThumbnailWithPlayButton.react").MWAnimatedImageThumbnailWithPlayButton,{altText:_.toString(),connectBottom:!1,connectTop:!1,dbAttachment:null,entryPoint:o("MWAnimatedImageThumbnailWithPlayButton.react").AnimatedImageEntryPoint.MediaViewer,mediaRenderQpl:null,message:null,onPlay:function(){return S(!0)},outgoing:!1,previewHeight:l!=null?l:0,previewWidth:d!=null?d:0,sourceURL:a}):u.jsx(r("MWXPressable.react"),{"aria-label":s._(/*BTDS*/"Pause GIF"),hideHoverOverlay:!0,onPress:function(){D&&S(!1)},xstyle:p.pauseGIFButon,children:u.jsx(r("CometPhotoViewerImageSuspense"),{alt:_,className:t,src:a},a)})})},withFooter:!0}):u.jsx(r("MWXPressable.react"),{display:"inline",label:s._(/*BTDS*/"Tap to see sensitive content"),onPress:function(){return h(!0)},children:u.jsx(o("CometPhotoViewerInnerWrapper.react").CometPhotoViewerImageWrapper,{imageComponent:function(t){return u.jsx(u.Fragment,{children:D?u.jsx(o("MWAnimatedImageThumbnailWithPlayButton.react").MWAnimatedImageThumbnailWithPlayButton,{altText:_.toString(),connectBottom:!1,connectTop:!1,dbAttachment:null,entryPoint:o("MWAnimatedImageThumbnailWithPlayButton.react").AnimatedImageEntryPoint.MediaViewer,mediaRenderQpl:null,message:null,onPlay:function(){return S(!0)},outgoing:!1,previewHeight:l!=null?l:0,previewWidth:d!=null?d:0,sourceURL:n}):u.jsx(r("MWXPressable.react"),{"aria-label":s._(/*BTDS*/"Pause GIF"),onPress:function(){D&&S(!1)},children:u.jsx(r("CometPhotoViewerImageSuspense"),{alt:_,className:t,src:n},n)})})},withFooter:!0})}),t[9]=n,t[10]=a,t[11]=v,t[12]=g,t[13]=l,t[14]=d,t[15]=D,t[16]=P):P=t[16];var N;t[17]!==a||t[18]!==T||t[19]!==x||t[20]!==P?(N=u.jsxs(o("CometPageletWithDiv.react").Placeholder,{className:T,fallback:x,name:"MessengerMediaViewerPhoto",pageletType:"media",children:[$,P]},a),t[17]=a,t[18]=T,t[19]=x,t[20]=P,t[21]=N):N=t[21];var M;return t[22]!==I||t[23]!==N?(M=u.jsx("div",{"data-testid":void 0,ref:I,children:N}),t[22]=I,t[23]=N,t[24]=M):M=t[24],M}l.default=f}),226);
__d("MWChatMediaViewerStage.react",["fbt","CometKeys","CometMediaViewerFilmstrip.react","CurrentEnvironment","FDSBlurredBackgroundImage.react","MWChatMediaViewerNavigationTapTarget.react","MWXLink.react","MessengerLogoSvg.react","XMessengerDotComCometRootControllerRouteBuilder","deferredLoadComponent","gkx","react","requireDeferred","useCometRouterDispatcher","useDebouncedComet","useIsReadOnlyFeatureLimitedWithThreadType","useLayerKeyCommands","useLayoutEffect_SAFE_FOR_SSR"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useMemo,m=c.useRef,p=c.useState,_=r("deferredLoadComponent")(r("requireDeferred")("MWChatMediaViewerControls.react").__setRef("MWChatMediaViewerStage.react")),f=48,g=32,h=2e3,y=r("gkx")("22681");function C(e){var t=e.activeIndex,n=e.attachmentID,o=e.backgroundSrc,a=e.children,i=e.disableNextButton,l=e.disablePrevButton,c=e.downloadLink,f=e.hideNextButton,g=e.hidePrevButton,C=e.isForwardEnabledForThread,b=e.messageID,v=e.setActiveIndex,S=e.showMessengerLink,R=r("CurrentEnvironment").messengerdotcom,L=r("gkx")("20836"),E=r("gkx")("22805"),k=r("useIsReadOnlyFeatureLimitedWithThreadType")(null),I=!k&&C&&(!L||!r("gkx")("4888")),T=s._(/*BTDS*/"Previous photo"),D=s._(/*BTDS*/"Next photo"),x=m(!0),$=p(!1),P=$[0],N=$[1],M=m(null),w=r("useCometRouterDispatcher")(),A=function(){return F.isPending()?O():F()},F=r("useDebouncedComet")(function(){N(!1),O()},{leading:!0,wait:h}),O=r("useDebouncedComet")(function(){N(!0),x.current=!1},{leading:!1,wait:h});r("useLayoutEffect_SAFE_FOR_SSR")(function(){O(),M.current&&x.current&&M.current.focus()});var B=function(){w!=null&&w.popPushView()},W=d(function(){var t=[];return!g&&!l&&t.push({command:{key:r("CometKeys").LEFT},description:T,handler:function(){return v(e.activeIndex-1)}}),!f&&!i&&t.push({command:{key:r("CometKeys").RIGHT},description:D,handler:function(){return v(e.activeIndex+1)}}),t},[i,l,f,g,D,T,e.activeIndex,v]),q=u.jsx(r("MWChatMediaViewerNavigationTapTarget.react"),{direction:"previous",label:T,onClick:function(){return v(t-1)},shouldHide:g||P,testid:void 0,trackingNode:143}),U=u.jsx(r("MWChatMediaViewerNavigationTapTarget.react"),{direction:"next",label:D,onClick:function(){return v(t+1)},shouldHide:f||P,testid:void 0,trackingNode:142});return r("useLayerKeyCommands")(W),u.jsxs("div",{className:"x6s0dn4 xal61yo x78zum5 xdt5ytf x1iyjqo2 x17upfok x1n2onr6 x87ps6o x1uvtmcs x1dr59a3 x6ikm8r x10wlt62","data-testid":void 0,onMouseMove:A,ref:M,tabIndex:0,children:[S&&u.jsx("div",{className:"xzwoauc x10l6tqk xomnu4r x1n327nk",children:u.jsx(r("MWXLink.react"),{"aria-label":s._(/*BTDS*/"Go to Messenger home page"),href:r("XMessengerDotComCometRootControllerRouteBuilder").buildURL({}),children:u.jsx(r("MessengerLogoSvg.react"),{height:"40",width:"40"})})}),u.jsx("div",{className:"x1f90px3 x1ffmiix x10l6tqk xh8yej3 x1vjfegm"}),u.jsx("div",{className:"x1ey2m1c xtijo5x x1o0tod xuzhngd x10l6tqk x13vifvy",children:o!=null?u.jsx(r("FDSBlurredBackgroundImage.react"),{src:o}):null}),u.jsxs("div",{className:"x9f619 x78zum5 x1iyjqo2 x5yr21d xl56j7k x6ikm8r x10wlt62 x1n2onr6 xh8yej3 xw8kemb x1j1r7yx",children:[n!=null&&b!=null?u.jsx("div",babelHelpers.extends({},{0:{className:"x6s0dn4 x78zum5 x1s65kcs x1pak89f x10l6tqk x1vjfegm"},4:{className:"x6s0dn4 x78zum5 x10l6tqk x1vjfegm xnnlda6 xtijo5x"},2:{className:"x6s0dn4 x78zum5 x10l6tqk xng8ra xxx7yvo xhtitgo"},6:{className:"x6s0dn4 x78zum5 x10l6tqk xng8ra xxx7yvo xhtitgo"},1:{className:"x6s0dn4 x78zum5 x10l6tqk xng8ra xxx7yvo xhtitgo"},5:{className:"x6s0dn4 x78zum5 x10l6tqk xng8ra xxx7yvo xhtitgo"},3:{className:"x6s0dn4 x78zum5 x10l6tqk xng8ra xxx7yvo xhtitgo"},7:{className:"x6s0dn4 x78zum5 x10l6tqk xng8ra xxx7yvo xhtitgo"}}[!!R<<2|!!L<<1|!!E<<0],{children:u.jsx(_,{attachmentID:n,canForward:I,downloadLink:c,messageID:b})})):null,u.jsxs("div",{className:"x6s0dn4 x1ey2m1c x78zum5 xtijo5x x1o0tod x1qughib x10l6tqk x13vifvy x1ja2u2z",children:[!y&&u.jsx("div",{"aria-hidden":!0,className:"x1ey2m1c x9f619 xtijo5x x1o0tod x10l6tqk x13vifvy","data-testid":void 0,onClick:B}),q,U]}),a]}),u.jsx("div",{className:"x193iq5w x6ikm8r x10wlt62 x1vjfegm",children:u.jsx(r("CometMediaViewerFilmstrip.react"),{activeIndex:t,images:e.thumbnails.map(function(e){return babelHelpers.extends({},e,{mediaType:"image"})}),onSetImage:v})})]})}C.displayName=C.name+" [from "+i.id+"]",l.default=C}),226);
__d("MWChatMediaViewerVideo.react",["CometRouteRenderType","MWChatVideoPlayer.react","MWVideoPlayerControllerContext.react","react","react-compiler-runtime","useMWMediaViewerOpenQPLLogger","useRoutePassthroughProps","useSinglePartialViewImpression"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useCallback,d=u.useContext,m=u.useEffect,p=u.useMemo,_=u.useRef;function f(e){var t=e.fbid,n=e.hdSrc,a=e.originalHeight,i=e.originalWidth,l=e.sdSrc,u=o("CometRouteRenderType").useIsPushView(),p=r("useRoutePassthroughProps")(),f=(p==null?void 0:p.startTimestamp)!=null?Number(p.startTimestamp):void 0,g=(p==null?void 0:p.volumeSetting)!=null?Number(p.volumeSetting):void 0,h=_(!1),y=d(r("MWVideoPlayerControllerContext.react")),C=y.ref.current;m(function(){C!==null&&!h.current&&(C.setMuted(!1,"product_initiated"),h.current=!0)},[C,h]);var b=o("useMWMediaViewerOpenQPLLogger").useMWMediaViewerOpenQPLLogger(),v=b.endSuccess,S=c(function(){v()},[v]),R=r("useSinglePartialViewImpression")({onImpressionStart:S});return s.jsx("div",babelHelpers.extends({},{0:{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k x1xoerdy xh8yej3"},2:{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k x1xoerdy xh8yej3 x4uq5q4"},1:{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k x1xoerdy xh8yej3 x1ch8t6n"},3:{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k x1xoerdy xh8yej3 x1ch8t6n"}}[!!u<<1|!u<<0],{ref:R,children:s.jsx(r("MWChatVideoPlayer.react"),{controls:"mwchat",fbid:t,hdSrc:n,initialForceHD:!0,isMediaViewer:!0,mediaRenderQpl:null,originalHeight:a,originalWidth:i,sdSrc:l,shouldForcePauseOnClick:!1,startTimestamp:f,volumeSetting:g})}))}f.displayName=f.name+" [from "+i.id+"]";function g(e){var t=o("react-compiler-runtime").c(3),n=_(null),a,i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={ref:n},t[0]=i):i=t[0],a=i;var l=a,u;return t[1]!==e?(u=s.jsx(r("MWVideoPlayerControllerContext.react").Provider,{value:l,children:s.jsx(f,babelHelpers.extends({},e))}),t[1]=e,t[2]=u):u=t[2],u}l.default=g}),98);
__d("MWChatMediaRoot.react",["fbt","CometContentNotAvailable.react","CometErrorBoundary.react","CometErrorRoot.react","CometRelay","CometRouteParams","CometRouterPushViewStackContext","FBLogger","I64","LSMessagingThreadTypeUtil","MAWThreadCutover","MWChatDeleteMessageEventEmitter","MWChatMediaData","MWChatMediaReducer","MWChatMediaRootQuery.graphql","MWChatMediaUtil","MWChatMediaViewerImage.react","MWChatMediaViewerStage.react","MWChatMediaViewerVideo.react","MWChatMessageId","MWLSThread","Promise","ReQL","ReQLSuspense","WebPixelRatio","cr:7185","deferredLoadComponent","promiseDone","react","react-compiler-runtime","requireDeferred","useIsMountedRef","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m,p=m||(m=o("react")),_=m,f=_.useCallback,g=_.useContext,h=_.useEffect,y=_.useReducer,C=_.useState,b=r("deferredLoadComponent")(n("cr:7185")),v=r("deferredLoadComponent")(r("requireDeferred")("MWV2MediaViewerThreadCutoverWrapper.react").__setRef("MWChatMediaRoot.react")),S=20,R=e!==void 0?e:e=n("MWChatMediaRootQuery.graphql");function L(e){var t,a,i,l,u,m,_,b,v,L=e.props,E=e.queries,k=o("CometRelay").useRelayEnvironment(),I=o("CometRouteParams").useRouteParams();L.manualRouteParams!=null&&(I=L.manualRouteParams);var T=g(r("CometRouterPushViewStackContext"))||[],D=T.length===0&&L.routeProps.showMessengerLink,x=C(null),$=x[0],P=x[1],N=y(o("MWChatMediaReducer").reducer,o("MWChatMediaReducer").initialState),M=N[0],w=M.curIdx,A=M.hasNextPage,F=M.hasPrevPage,O=M.initialCursor,B=M.isFetchingNextPage,W=M.isFetchingPrevPage,q=M.mediaList,U=N[1],V=r("useIsMountedRef")(),H=o("CometRelay").usePreloadedQuery(R,E.messengerMediaRootQueryReference);if($!==null)throw $;h(function(){var e,t=H==null||(e=H.message_thread)==null||(e=e.messages_with_attachments)==null||(e=e.edges[0])==null?void 0:e.cursor;if(t!=null&&O===null){var n,r=H==null||(n=H.message_thread)==null||(n=n.messages_with_attachments)==null?void 0:n.edges;if(r!=null){var a=o("MWChatMediaData").normalizeMessages(r),i=0;I.attachment_id!=null&&(i=a.findIndex(function(e){return e.attachment.legacyAttachmentID===I.attachment_id})),U({curIdx:i,initialCursor:t,mediaList:a,type:"initialize"})}}},[O,H,I.attachment_id]);var G=H==null||(t=H.message_thread)==null?void 0:t.id,z=H==null||(a=H.message_thread)==null?void 0:a.folder;h(function(){return o("MWChatDeleteMessageEventEmitter").subscribe(function(e){var t=w,n=q.filter(function(n,r){var o=n.messageID===e;return o&&r<=w&&w>0&&t--,!o});n.length!==q.length&&G!=null&&k.commitUpdate(function(e){var t;return(t=e.get(G))==null?void 0:t.invalidateRecord()}),U({curIdx:t,mediaList:n,type:"messageDeleted"})})},[k,G,w,q]);var j=f(function(e){if(U({type:"startFetchingPrevPage"}),typeof I.thread_id!="string")return(c||(c=n("Promise"))).resolve();var t=I,r=t.thread_id;return o("CometRelay").fetchQuery(k,R,{before:e,last:S,scale:o("WebPixelRatio").get(),threadID:r}).toPromise().then(function(e){var t,n;if(V.current){var r=e==null||(t=e.message_thread)==null?void 0:t.messages_with_attachments,a=o("MWChatMediaData").normalizeMessages((n=r==null?void 0:r.edges)!=null?n:[]);if(a.length>0){var i,l;U({hasPrevPage:(i=r==null||(l=r.page_info)==null?void 0:l.has_previous_page)!=null?i:!1,medias:a,type:"prevPageReceived"})}}}).catch(function(e){V.current&&P(e)})},[k,V,I]),K=f(function(e){if(U({type:"startFetchingNextPage"}),typeof I.thread_id!="string")return(c||(c=n("Promise"))).resolve();var t=I,r=t.thread_id;return o("CometRelay").fetchQuery(k,R,{after:e,first:S,scale:o("WebPixelRatio").get(),threadID:r}).toPromise().then(function(e){var t,n;if(V.current){var r=e==null||(t=e.message_thread)==null?void 0:t.messages_with_attachments,a=o("MWChatMediaData").normalizeMessages((n=r==null?void 0:r.edges)!=null?n:[]);if(a.length>0){var i,l;U({hasNextPage:(i=r==null||(l=r.page_info)==null?void 0:l.has_next_page)!=null?i:!1,medias:a,type:"nextPageReceived"})}}}).catch(function(e){V.current&&P(e)})},[k,V,I]);h(function(){O!=null&&(r("promiseDone")(K(O)),r("promiseDone")(j(O)))},[k,K,j,O,I.thread_id]);var Q=(i=(l=q[0])==null?void 0:l.cursor)!=null?i:null,X=(u=(m=q[q.length-1])==null?void 0:m.cursor)!=null?u:null;h(function(){w<=S/2&&F&&!W&&Q!=null?r("promiseDone")(j(Q)):w>=q.length-S/2&&A&&!B&&X!=null&&r("promiseDone")(K(X))},[w,j,K,A,F,Q,X,q.length,B,W]);var Y=q[w-1],J=q[w+1],Z=null,ee=null;Y!=null&&Y.__typename==="MessageImage"&&(Z=Y.attachment.image.uri),J!=null&&J.__typename==="MessageImage"&&(ee=J.attachment.image.uri),h(function(){o("MWChatMediaUtil").prefetchImages([Z,ee])},[Z,ee]);var te=q[w],ne=typeof I.thread_id=="string"?(d||(d=o("I64"))).of_string(I.thread_id):null,re=o("MWLSThread").useThread(ne,function(e){return o("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(e.threadType)});if(((_=H==null||(b=H.message_thread)==null||(b=b.messages_with_attachments)==null||(b=b.edges)==null?void 0:b.length)!=null?_:0)<1)return r("FBLogger")("messenger_web_media").warn("No attachments found for media viewer"),p.jsx(r("CometContentNotAvailable.react"),{});if(O==null)return null;if(te==null)return p.jsx(r("CometContentNotAvailable.react"),{});var oe=q.map(function(e){var t,n=e.__typename,r=e.altText,o=e.attachment.imageThumb,a=o.height,i=o.uri,l=o.width,u=s._(/*BTDS*/"No description available.");return{alt:n==="MessageAnimatedImage"&&r!=null?r:u,height:a,key:(t=e.attachment.legacyAttachmentID)!=null?t:i,uri:i,width:l}}).filter(Boolean);return p.jsx(r("MWChatMediaViewerStage.react"),{activeIndex:w,attachmentID:te.attachment.legacyAttachmentID,backgroundSrc:te.__typename!=="MessageAnimatedImage"?te.attachment.imageThumb.uri:void 0,disableNextButton:B&&q[w+1]==null,disablePrevButton:W&&q[w-1]==null,downloadLink:te.__typename==="MessageVideo"?(v=te.attachment.hdUrl)!=null?v:te.attachment.sdUrl:te.attachment.image.downloadableUri,hideNextButton:!A&&q[w+1]==null,hidePrevButton:!F&&q[w-1]==null,isForwardEnabledForThread:z!=="COMMUNITY"&&z!=="E2EE_CUTOVER"&&!re,messageID:typeof I.thread_id=="string"&&te.timestamp!=null?o("MWChatMessageId").makeSent(I.thread_id,te.messageID,te.timestamp):null,setActiveIndex:function(t){return U({curIdx:t,type:"viewMediaAtIndex"})},showMessengerLink:D,thumbnails:oe,children:te.__typename==="MessageVideo"?p.jsx(r("MWChatMediaViewerVideo.react"),{fbid:te.nodeID,hdSrc:te.attachment.hdUrl!=null?te.attachment.hdUrl:void 0,originalHeight:te.attachment.originalDimensions.x,originalWidth:te.attachment.originalDimensions.y,sdSrc:te.attachment.sdUrl}):te.__typename==="MessageImage"?p.jsx(r("MWChatMediaViewerImage.react"),{blurredImageURI:te.attachment.blurredImageUri,imageURI:te.attachment.image.uri}):te.__typename==="MessageAnimatedImage"?p.jsx(r("MWChatMediaViewerImage.react"),{blurredImageURI:null,imageURI:te.attachment.image.uri,isAnimatedImage:!0,origHeight:te.attachment.image.height,origWidth:te.attachment.image.width}):null})}L.displayName=L.name+" [from "+i.id+"]";function E(e){var t=o("react-compiler-runtime").c(4),n=o("CometRouteParams").useRouteParams();e.props.manualRouteParams!=null&&(n=e.props.manualRouteParams);var a=String(n.thread_id),i=String(n.attachment_id),l=String(n.message_id),s=I(i,l,a),u;if(s!=null)u=s;else{var c;t[0]!==e?(c=p.jsx(L,babelHelpers.extends({},e)),t[0]=e,t[1]=c):c=t[1],u=c}var d;return t[2]!==u?(d=p.jsx(r("CometErrorBoundary.react"),{fallback:k,children:u}),t[2]=u,t[3]=d):d=t[3],d}function k(){return p.jsx(r("CometErrorRoot.react"),{})}k.displayName=k.name+" [from "+i.id+"]";function I(e,t,n){var r=o("react-compiler-runtime").c(11),a;r[0]!==n?(a=(d||(d=o("I64"))).of_string(n),r[0]=n,r[1]=a):a=r[1];var i=a,l=o("MAWThreadCutover").useGetCutoverOpenThreadKey(i),s=o("MAWThreadCutover").useCutoverSecureThreadKeyForOpenThreadKey(l==null?i:void 0),u=o("MWLSThread").useThread(i),c=T(t,e);if(c==null||u==null||l==null&&s==null)return null;var m=l!=null?l:u.threadKey,_=s!=null?s:u.threadKey,f;r[2]!==c||r[3]!==u?(f=p.jsx(b,{initialAttachment:c,thread:u}),r[2]=c,r[3]=u,r[4]=f):f=r[4];var g;return r[5]!==c||r[6]!==m||r[7]!==_||r[8]!==f||r[9]!==u.threadType?(g=p.jsx(v,{initialAttachment:c,openThreadKey:m,secureThreadKey:_,threadType:u.threadType,children:f}),r[5]=c,r[6]=m,r[7]=_,r[8]=f,r[9]=u.threadType,r[10]=g):g=r[10],g}function T(e,t){var n=o("react-compiler-runtime").c(5),a=(u||(u=r("useReStore")))(),l,s;return n[0]!==t||n[1]!==a.tables.attachments||n[2]!==e?(l=function(){return o("ReQL").fromTableAscending(a.tables.attachments).filter(function(n){return n.messageId===e&&n.attachmentFbid===t})},s=[a.tables.attachments,e,t],n[0]=t,n[1]=a.tables.attachments,n[2]=e,n[3]=l,n[4]=s):(l=n[3],s=n[4]),o("ReQLSuspense").useFirst(l,s,i.id+":618")}l.default=E}),226);
__d("MWV2MediaViewerContentDeferred",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("MWV2MediaViewerContent.react").__setRef("MWV2MediaViewerContentDeferred"),s=e;l.default=s}),98);