;/*FB_PKG_DELIM*/

__d("LSGetFirstAvailableAdminMessageCTAID",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(e){return t.sequence([function(e){return t.db.table(27).fetchDesc([[[]],"ctaId"]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[0]=t.i64.cast([0,1]):(r=a.item,n[0]=t.i64.add(r.ctaId,t.i64.cast([0,1])))})},function(e){return r[0]=n[0]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxGetFirstAvailableAdminMessageCTAIDStoredProcedure",e.__tables__=["admin_message_ctas"],a.exports=e}),null);
__d("LSApplyAdminMessageCTA",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop","LSGetFirstAvailableAdminMessageCTAID"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return t.storedProcedure(n("LSGetFirstAvailableAdminMessageCTAID")).then(function(e){var t;return t=e,r[0]=t[0],t})},function(n){return t.db.table(27).put({threadKey:e[0],messageId:e[2],ctaId:r[0],timestampMs:e[1],adClientToken:e[5],adPreferenceUrl:e[6],adHelpUrl:e[7],showAdChoiceIcon:e[8],title:e[3],actionUrl:e[9],adminMessageNicknameParticipantId:e[10],targetId:e[11],targetTitle:e[12],actionContentBlob:e[13]})},function(o){return t.filter(t.db.table(12).fetch([[[e[2]]],"messageId"]),function(n){return e[2]===n.messageId&&t.i64.eq(e[0],n.threadKey)}).next().then(function(e,o){var a=e.done,i=e.value;return a?r[1]=void 0:(o=i.item,t.sequence([function(e){return r[7]=o.metadataDataclass,r[7]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[7]).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return r[9]=new t.Map,r[10]=r[8].keys(),r[11]=t.i64.of_int32(r[10].length),t.i64.gt(r[11],t.i64.cast([0,0]))?t.loopAsync(r[11],function(e){return r[12]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[10],r[12]).then(function(e){var t;return t=e,r[13]=t[0],r[14]=t[1],t})},function(e){return r[15]=r[8].get(r[13]),r[9].set(r[13],r[15])}])}):t.resolve()},function(e){return r[6]=r[9]}]):t.resolve((r[8]=new t.Map,r[6]=r[8]))},function(e){return r[1]=r[6]}]))})},function(n){return r[1]?r[3]=!1:r[3]=!0,r[3]||(r[6]=new t.Map,r[6].set("ad_client_token",e[5]),r[6].set("ad_preference_url",e[6]),r[6].set("ad_help_url",e[7]),r[6].set("show_ad_choice_icon",e[8]),r[6].set("title",e[3]),r[6].set("action_url",e[9]),t.i64.neq(e[10],void 0)?r[7]=t.i64.to_string(e[10]):r[7]=void 0,r[6].set("admin_message_nickname_participant_id",r[7]),t.i64.neq(e[11],void 0)?r[8]=t.i64.to_string(e[11]):r[8]=void 0,r[6].set("target_id",r[8]),r[6].set("target_title",e[12]),r[6].set("identifier_name",void 0),r[1].set("admin_message",r[6])),r[1]?r[4]=!1:r[4]=!0,r[4]?r[5]=void 0:(r[6]=t.toJSON(r[1]),r[5]=r[6]),t.forEach(t.filter(t.db.table(12).fetch([[[e[0],e[1],e[2]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.timestampMs,e[1])&&n.messageId===e[2]}),function(t){var n=t.update,o=t.item;return n({adminMsgCtaId:r[0],adminMsgCtaTitle:e[3],adminMsgCtaType:e[4],metadataDataclass:r[5]})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxApplyAdminMessageCTAStoredProcedure",e.__tables__=["admin_message_ctas","messages"],a.exports=e}),null);
__d("LSClearThreadBannedUsers",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.i64.neq(void 0,void 0)?t.forEach(t.db.table(297).fetch([[[e[0],void 0]]]),function(e){return e.delete()}):t.forEach(t.db.table(297).fetch([[[e[0]]]]),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxClearThreadBannedUsersStoredProcedure",e.__tables__=["thread_bans"],a.exports=e}),null);
__d("LSIssueParticipantPointQuery",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=new t.Map,r[0].set("table","14"),r[0].set("type",t.i64.cast([0,1])),r[0].set("1",e[0]),r[0].set("2",e[1]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),"ppq",t.i64.cast([0,17]),r[1],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),t.i64.cast([0,1]),void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxIssueParticipantPointQueryStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSUpdateSelectiveSyncStateV2",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.db.table(294).fetch([[[e[0]]]]).next().then(function(r,o){var a=r.done,i=r.value;return a?(t.i64.neq(e[1],void 0)?n[1]=e[1]:n[1]=t.i64.cast([0,0]),t.db.table(294).add({threadKey:e[0],threadQueueSequenceId:n[1],lastSelectiveSyncTimestampMs:e[2]})):(o=i.item,t.sequence([function(n){return t.i64.neq(e[2],void 0)?t.forEach(t.db.table(294).fetch([[[e[0]]]]),function(t){var n=t.update,r=t.item;return n({lastSelectiveSyncTimestampMs:e[2]})}):t.resolve()},function(n){return t.i64.neq(e[1],void 0)?t.forEach(t.db.table(294).fetch([[[e[0]]]]),function(t){var n=t.update,r=t.item;return n({threadQueueSequenceId:e[1]})}):t.resolve()}]))})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateSelectiveSyncStateV2StoredProcedure",e.__tables__=["community_thread_sync_info"],a.exports=e}),null);
__d("LSUpsertTpqTtrc",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return n[0]=t.i64.of_float(Date.now()),t.db.table(286).put({threadKey:e[0],dasmExecutionTimestampMs:n[0],deltaInsertionTimestampMs:e[1],status:e[2]})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpsertTpqTtrcStoredProcedure",e.__tables__=["thread_point_query_ttrc"],a.exports=e}),null);
__d("LSVerifyCommunityMemberContextualProfileExists",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.db.table(216).fetch([[[e[0],e[1]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?(r[1]=new t.Map,r[1].set("community_id",e[1]),r[1].set("user_id",e[0]),r[2]=t.toJSON(r[1]),t.storedProcedure(n("LSIssueNewTask"),"load_contextual_profile",t.i64.cast([0,548]),r[2],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))):(a=l.item,0)})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxVerifyCommunityMemberContextualProfileExistsStoredProcedure",e.__tables__=["contextual_profile_v1"],a.exports=e}),null);
__d("LSVerifyContactParticipantExist",["LSIssueNewTask","LSIssueParticipantPointQuery"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return t.db.table(7).fetch([[[e[0]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(o){return r[2]=new t.Map,r[2].set("contact_id",e[0]),r[3]=t.toJSON(r[2]),t.storedProcedure(n("LSIssueNewTask"),"cpq_v2",t.i64.cast([0,207]),r[3],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(n){return t.forEach(t.filter(t.db.table(7).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.id,e[0])&&t.i64.eq(t.i64.cast([0,1]),t.i64.cast([0,1]))&&t.i64.lt(n.authorityLevel,t.i64.cast([0,60]))}),function(e){return e.delete()})},function(n){return t.db.table(7).add({id:e[0],rank:0,profilePictureUrl:"",name:e[2],isMessengerUser:!1,isMemorialized:!1,contactType:t.i64.cast([0,1]),contactTypeExact:t.i64.cast([0,1]),blockedByViewerStatus:t.i64.cast([0,0]),authorityLevel:t.i64.cast([0,60]),workForeignEntityType:t.i64.cast([0,0]),contactViewerRelationship:t.i64.cast([0,0])})}]):(a=l.item,0)})},function(r){return t.filter(t.db.table(14).fetch([[[e[1],e[0]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.contactId,e[0])}).next().then(function(r,o){var a=r.done,i=r.value;return a?t.storedProcedure(n("LSIssueParticipantPointQuery"),e[1],e[0]):(o=i.item,0)})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxVerifyContactParticipantExistStoredProcedure",e.__tables__=["contacts","participants"],a.exports=e}),null);