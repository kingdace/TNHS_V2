;/*FB_PKG_DELIM*/

__d("LSHandleRepliesOnMessageEdit",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return r[0]=t.createArray(),t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"replySourceIdMessageID"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.replySourceId===e[1]}),function(e){var t=e.item;return r[4]=(r[0].push(t.messageId),r[0])})},function(o){return r[1]=t.i64.of_int32(r[0].length),t.i64.eq(r[1],t.i64.cast([0,0]))?t.resolve():t.sequence([function(o){return r[4]=new t.Map,r[4].set("thread_key",e[0]),r[4].set("message_id",e[1]),r[4].set("reply_message_ids",r[0]),r[5]=t.toJSON(r[4]),t.storedProcedure(n("LSIssueNewTask"),"update_replies_on_message_edit",t.i64.cast([0,753]),r[5],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(o){return r[6]=new t.Map,r[6].set("thread_key",e[0]),r[6].set("message_id",e[1]),r[6].set("bump_message_ids",r[0]),r[7]=t.toJSON(r[6]),t.storedProcedure(n("LSIssueNewTask"),"update_bump_messages_on_message_edit",t.i64.cast([0,757]),r[7],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}])},function(n){return t.db.table(12).fetch([[[e[1]]],"messageId"]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[2]=void 0:(t=o.item,r[2]=t.subthreadKey)})},function(e){return t.i64.neq(r[2],void 0)?t.forEach(t.db.table(9).fetch([[[r[2]]]]),function(e){return e.delete()}):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxHandleRepliesOnMessageEditStoredProcedure",e.__tables__=["messages","threads"],a.exports=e}),null);
__d("LSSetSuggestedModerationActions",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return e[1]===n.messageId&&t.i64.eq(e[0],n.threadKey)}).next().then(function(e,o){var a=e.done,i=e.value;return a?r[0]=void 0:(o=i.item,t.sequence([function(e){return r[6]=o.metadataDataclass,r[6]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[6]).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[8]=new t.Map,r[9]=r[7].keys(),r[10]=t.i64.of_int32(r[9].length),t.i64.gt(r[10],t.i64.cast([0,0]))?t.loopAsync(r[10],function(e){return r[11]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[9],r[11]).then(function(e){var t;return t=e,r[12]=t[0],r[13]=t[1],t})},function(e){return r[14]=r[7].get(r[12]),r[8].set(r[12],r[14])}])}):t.resolve()},function(e){return r[5]=r[8]}]):t.resolve((r[7]=new t.Map,r[5]=r[7]))},function(e){return r[0]=r[5]}]))})},function(n){return r[0]?r[2]=!1:r[2]=!0,r[2]||(r[5]=new t.Map,r[5].set("suggested_moderation_actions_json",e[3]),r[0].set("suggested_moderation_actions",r[5])),r[0]?r[3]=!1:r[3]=!0,r[3]?r[4]=void 0:(r[5]=t.toJSON(r[0]),r[4]=r[5]),t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return e[1]===n.messageId&&t.i64.eq(e[0],n.threadKey)}),function(e){var t=e.update,n=e.item;return t({metadataDataclass:r[4]})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxSetSuggestedModerationActionsStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSUpdateMessageTranslationInfo",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return t.filter(t.db.table(12).fetch([[[e[0]]],"messageId"]),function(n){return e[0]===n.messageId&&t.i64.eq(e[1],n.threadKey)}).next().then(function(e,o){var a=e.done,i=e.value;return a?r[0]=void 0:(o=i.item,t.sequence([function(e){return r[6]=o.metadataDataclass,r[6]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[6]).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[8]=new t.Map,r[9]=r[7].keys(),r[10]=t.i64.of_int32(r[9].length),t.i64.gt(r[10],t.i64.cast([0,0]))?t.loopAsync(r[10],function(e){return r[11]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[9],r[11]).then(function(e){var t;return t=e,r[12]=t[0],r[13]=t[1],t})},function(e){return r[14]=r[7].get(r[12]),r[8].set(r[12],r[14])}])}):t.resolve()},function(e){return r[5]=r[8]}]):t.resolve((r[7]=new t.Map,r[5]=r[7]))},function(e){return r[0]=r[5]}]))})},function(n){return r[0]?r[2]=!1:r[2]=!0,r[2]||(r[5]=new t.Map,r[5].set("translated_text",e[2]),r[5].set("translated_text_dialect",e[3]),r[0].set("text_translation",r[5])),r[0]?r[3]=!1:r[3]=!0,r[3]?r[4]=void 0:(r[5]=t.toJSON(r[0]),r[4]=r[5]),t.forEach(t.db.table(12).fetch([[[e[0]]],"messageId"]),function(t){var n=t.update,o=t.item;return n({translatedText:e[2],translatedTextDialect:e[3],metadataDataclass:r[4]})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateMessageTranslationInfoStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);