;/*FB_PKG_DELIM*/

__d("LSSendOTCNotifications",["LSIssueNewEbTaskAndGetTaskIDV2"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return t.forEach(t.db.table(285).fetch(),function(e){return e.delete()})},function(e){return t.forEach(t.filter(t.db.table(285).fetch([[[t.i64.cast([0,1])]]]),function(e){return t.i64.eq(e.pk,t.i64.cast([0,1]))&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(285).add({pk:t.i64.cast([0,1]),notificationSendingStatus:t.i64.cast([0,2]),authorityLevel:t.i64.cast([0,20])})},function(o){return r[0]=new t.Map,r[0].set("device_ids",e[0]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_send_otc_notifications",t.i64.cast([0,50032]),r[1],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[2]=t[0],t})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsSendOTCNotificationsStoredProcedure",e.__tables__=["encrypted_backups_otc_notification_sending_status"],a.exports=e}),null);
__d("LSSendOTCNotificationsStoredProcedure",["LSSendOTCNotifications","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSSendOTCNotifications"),a.deviceIds);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWEncryptedBackupsRestoreDialogContexts_query.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWEncryptedBackupsRestoreDialogContexts_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup"},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'}],storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MWEBVestaUserInfoContextProvider_viewer"},{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null}],storageKey:null}],storageKey:null},action:"THROW",path:"viewer"}],type:"Query",abstractKey:null};a.exports=e}),null);
__d("MWChatEncryptedBackupOnCloseContext",["FBLogger","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(){r("FBLogger")("messenger_web_trust").warn("setOnCloseSkipConfirmation called outside of a provider")}var c=s.createContext({onCloseSkipConfirmation:null,setOnCloseSkipConfirmation:u});l.default=c}),98);
__d("MWChatEncryptedBackupOnCloseContextProvider.react",["MWChatEncryptedBackupOnCloseContext","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useMemo,d=u.useState;function m(e){var t=o("react-compiler-runtime").c(5),n=e.children,a=d(null),i=a[0],l=a[1],u,c;t[0]!==i?(c={onCloseSkipConfirmation:i,setOnCloseSkipConfirmation:l},t[0]=i,t[1]=c):c=t[1],u=c;var m=u,p;return t[2]!==n||t[3]!==m?(p=s.jsx(r("MWChatEncryptedBackupOnCloseContext").Provider,{value:m,children:n}),t[2]=n,t[3]=m,t[4]=p):p=t[4],p}l.default=m}),98);
__d("MWChatEncryptedBackupResetContextProvider.react",["MWChatEncryptedBackupResetContext","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useMemo,d=u.useRef;function m(e){var t=o("react-compiler-runtime").c(3),n=e.children,a=d(!1),i=d(!1),l,u;t[0]===Symbol.for("react.memo_cache_sentinel")?(u={isEncryptedBackupResetStartedRef:a,isEncryptedBackupResetUserJourneyStartedRef:i},t[0]=u):u=t[0],l=u;var c=l,m;return t[1]!==n?(m=s.jsx(r("MWChatEncryptedBackupResetContext").Provider,{value:c,children:n}),t[1]=n,t[2]=m):m=t[2],m}l.default=m}),98);
__d("MWChatEncryptedBackupsDismissalDialogContextProvider.react",["MWChatEncryptedBackupsDismissalDialogContext","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useMemo,d=u.useState;function m(e){var t=o("react-compiler-runtime").c(5),n=e.children,a=e.isDismissedDisabledValue,i=d(a),l=i[0],u=i[1],c,m;t[0]!==l?(m={isDismissedDisabled:l,setIsDismissedDisabled:u},t[0]=l,t[1]=m):m=t[1],c=m;var p=c,_;return t[2]!==n||t[3]!==p?(_=s.jsx(r("MWChatEncryptedBackupsDismissalDialogContext").Provider,{value:p,children:n}),t[2]=n,t[3]=p,t[4]=_):_=t[4],_}l.default=m}),98);
__d("MWChatEncryptedBackupsRestoreUpsellDialogContextProvider.react",["MWChatEncryptedBackupsSetIsDialogPersistedContext","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useMemo;function c(e){var t=o("react-compiler-runtime").c(5),n=e.children,a=e.setIsDialogPersisted,i,l;t[0]!==a?(l={setIsDialogPersisted:a},t[0]=a,t[1]=l):l=t[1],i=l;var u=i;if(a!=null){var c;return t[2]!==n||t[3]!==u?(c=s.jsx(r("MWChatEncryptedBackupsSetIsDialogPersistedContext").Provider,{value:u,children:n}),t[2]=n,t[3]=u,t[4]=c):c=t[4],c}return n}l.default=c}),98);
__d("MWEBHasSeenAutoRestoreNoticeContextProvider.react",["MWEBHasSeenAutoRestoreNoticeContext","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useMemo;function c(e){var t=o("react-compiler-runtime").c(5),n=e.children,a=e.hasSeenNotice,i,l;t[0]!==a?(l={hasSeenNotice:a},t[0]=a,t[1]=l):l=t[1],i=l;var u=i,c;return t[2]!==n||t[3]!==u?(c=s.jsx(r("MWEBHasSeenAutoRestoreNoticeContext").Provider,{value:u,children:n}),t[2]=n,t[3]=u,t[4]=c):c=t[4],c}l.default=c}),98);
__d("MAWEncryptedBackupsRestoreDialogContexts.react",["CometRelay","CometTransientDialogProvider.react","MAWEncryptedBackupsRestoreDialogContexts_query.graphql","MWChatEncryptedBackupOnCloseContextProvider.react","MWChatEncryptedBackupResetContextProvider.react","MWChatEncryptedBackupsDismissalDialogContextProvider.react","MWChatEncryptedBackupsRestoreUpsellDialogContextProvider.react","MWEBFlowSourceContextProvider.react","MWEBHasSeenAutoRestoreNoticeContextProvider.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContextProvider.react","react","react-compiler-runtime","useMWEncryptedBackupsGetVirtualDevicesPreloaded"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react"));function c(t){var a,i,l,s,c=o("react-compiler-runtime").c(25),d=t.children,m=t.query,p=t.setIsDialogPersisted,_=t.source,f=o("CometRelay").useFragment(e!==void 0?e:e=n("MAWEncryptedBackupsRestoreDialogContexts_query.graphql"),m),g;c[0]!==f.xfb_backup?(g={encryptedBackup:f.xfb_backup},c[0]=f.xfb_backup,c[1]=g):g=c[1];var h=r("useMWEncryptedBackupsGetVirtualDevicesPreloaded")(g),y=h.getVirtualDevices,C;c[2]!==y?(C=y(),c[2]=y,c[3]=C):C=c[3];var b=C,v=b.offlineDevicesCount,S=b.vestaClientID,R=(a=(i=f.xfb_backup)==null?void 0:i.has_otc_eligible_devices)!=null?a:void 0,L=(l=(s=f.viewer.encrypted_backup)==null?void 0:s.has_seen_eb_auto_restore_notice)!=null?l:!1,E;c[4]!==p?(E=function(t){p==null||p(t)},c[4]=p,c[5]=E):E=c[5];var k;c[6]!==d?(k=u.jsx(r("CometTransientDialogProvider.react"),{children:d}),c[6]=d,c[7]=k):k=c[7];var I;c[8]!==f.viewer||c[9]!==k?(I=u.jsx(o("MWEBVestaUserInfoContext.react").MWEBVestaUserInfoContextProvider,{viewer$key:f.viewer,children:k}),c[8]=f.viewer,c[9]=k,c[10]=I):I=c[10];var T;c[11]!==E||c[12]!==I?(T=u.jsx(r("MWChatEncryptedBackupOnCloseContextProvider.react"),{children:u.jsx(r("MWChatEncryptedBackupResetContextProvider.react"),{children:u.jsx(r("MWChatEncryptedBackupsDismissalDialogContextProvider.react"),{isDismissedDisabledValue:!1,children:u.jsx(r("MWChatEncryptedBackupsRestoreUpsellDialogContextProvider.react"),{setIsDialogPersisted:E,children:I})})})}),c[11]=E,c[12]=I,c[13]=T):T=c[13];var D;c[14]!==_||c[15]!==T?(D=u.jsx(r("MWEBFlowSourceContextProvider.react"),{source:_,children:T}),c[14]=_,c[15]=T,c[16]=D):D=c[16];var x;c[17]!==L||c[18]!==D?(x=u.jsx(r("MWEBHasSeenAutoRestoreNoticeContextProvider.react"),{hasSeenNotice:L,children:D}),c[17]=L,c[18]=D,c[19]=x):x=c[19];var $;return c[20]!==v||c[21]!==x||c[22]!==R||c[23]!==S?($=u.jsx(r("MWEBVirtualDevicesContextProvider.react"),{hasOtcEligibleDevicesInitialValue:R,offlineDevicesCountInitialValue:v,vestaClientIDInitialValue:S,children:x}),c[20]=v,c[21]=x,c[22]=R,c[23]=S,c[24]=$):$=c[24],$}l.default=c}),98);
__d("MWEBLazyLoadResetPinPage",["JSResourceForInteraction","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e=r("JSResourceForInteraction")("MWEBPushResetPinPage").__setRef("MWEBLazyLoadResetPinPage");function s(t,n){r("promiseDone")(e.load().then(function(e){return e(t,n)}))}l.default=s}),98);
__d("MWEBPinCodeUpsellDialog.entrypoint",["JSResourceForInteraction"],(function(t,n,r,o,a,i,l){"use strict";var e={getPreloadProps:function(){return{queries:{}}},root:r("JSResourceForInteraction")("MWEBPinCodeUpsellDialog.react").__setRef("MWEBPinCodeUpsellDialog.entrypoint")};l.default=e}),98);
__d("MWEBRestoreOTCFirstDialogStepDeferred.react",["deferredLoadComponent","react","react-compiler-runtime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("deferredLoadComponent")(r("requireDeferred")("MWEBRestoreOTCFirstStep.react").__setRef("MWEBRestoreOTCFirstDialogStepDeferred.react"));function c(e){var t=o("react-compiler-runtime").c(2),n;return t[0]!==e?(n=s.jsx(u,babelHelpers.extends({},e)),t[0]=e,t[1]=n):n=t[1],n}l.default=c}),98);
__d("MAWEncryptedBackupsRestoreStep.react",["MWChatEncryptedBackupResetContext","MWChatEncryptedBackupsQPLSource.enum","MWEBLazyLoadResetPinPage","MWEBOTCDialogStepDeferred.react","MWEBPinCodeUpsellDialog.entrypoint","MWEBRestoreOTCFirstDialogStepDeferred.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","deferredLoadComponent","react","react-compiler-runtime","requireDeferred","requireDeferredForDisplay","usePushFDSMultiStepDialogEntryPointPage","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useCallback,d=u.useContext,m=r("deferredLoadComponent")(r("requireDeferred")("MWChatEncryptedBackupsAccessCodeInputStep.react").__setRef("MAWEncryptedBackupsRestoreStep.react")),p=r("deferredLoadComponent")(r("requireDeferredForDisplay")("MWChatEncryptedBackupsPinCodeRestoreStep.react").__setRef("MAWEncryptedBackupsRestoreStep.react")),_=r("deferredLoadComponent")(r("requireDeferred")("MWChatEncryptedBackupsKVSOnlyRestoreStep.react").__setRef("MAWEncryptedBackupsRestoreStep.react"));function f(e){var t=o("react-compiler-runtime").c(21),n=e.offlineDevicesCount,a=e.onClose,i=e.onComplete,l=e.onForgotRC,u=e.onSkip,c=e.pushPage,d=e.shouldShowForgotButton,p=e.source,f=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),g=f.virtualDeviceInfo;if(g.doesUserHaveOtcEligibleDevices){var h=p===r("MWChatEncryptedBackupsQPLSource.enum").INBOX_INTERSTITIAL_SOFTBLOCK;if(h){var y;return t[0]!==a||t[1]!==i||t[2]!==u||t[3]!==c?(y=s.jsx(r("MWEBRestoreOTCFirstDialogStepDeferred.react"),{onCloseDialog:a,onComplete:i,onSkip:u,pushPage:c}),t[0]=a,t[1]=i,t[2]=u,t[3]=c,t[4]=y):y=t[4],y}var C;return t[5]!==a||t[6]!==i||t[7]!==u||t[8]!==c?(C=s.jsx(r("MWEBOTCDialogStepDeferred.react"),{onClose:a,onComplete:i,onSkip:u,pushPage:c}),t[5]=a,t[6]=i,t[7]=u,t[8]=c,t[9]=C):C=t[9],C}if(n!==null&&n>=1){var b;return t[10]!==a||t[11]!==i||t[12]!==l||t[13]!==u||t[14]!==c||t[15]!==d?(b=s.jsx(m,{onClose:a,onComplete:i,onForgotRC:l,onSkip:u,pushPage:c,shouldShowForgotButton:d}),t[10]=a,t[11]=i,t[12]=l,t[13]=u,t[14]=c,t[15]=d,t[16]=b):b=t[16],b}var v;return t[17]!==a||t[18]!==i||t[19]!==c?(v=s.jsx(_,{onClose:a,onComplete:i,pushPage:c}),t[17]=a,t[18]=i,t[19]=c,t[20]=v):v=t[20],v}function g(e){var t=e.clientID,n=e.offlineDevicesCount,a=e.onClose,i=e.onComplete,l=e.onForgotRC,u=e.onSkip,m=e.pushPage,_=e.shouldShowForgotButton,g=e.source,h=o("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),y=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),C=y.virtualDeviceInfo,b=C.doesUserHaveOtcEligibleDevices,v=c(function(){r("MWEBLazyLoadResetPinPage")(i,m)},[i,m]),S=r("usePushFDSMultiStepDialogEntryPointPage")(r("MWEBPinCodeUpsellDialog.entrypoint"),{}),R=S[0],L=S[1],E=d(r("MWChatEncryptedBackupResetContext")),k=c(function(){var e;if(((e=E.isEncryptedBackupResetStartedRef)==null?void 0:e.current)===!0){i();return}L({onClose:u,onComplete:i},{withoutBackButton:!0})},[E,i,u,L]);return h?s.jsx(p,{onClose:a,onComplete:i,onSkip:u,pushPage:m,shouldShowForgotButton:_}):t!=null&&h&&b?(r("vulture")("1qMwdD2NN3MYmNe7aqWvRYoPY64="),s.jsx(f,{offlineDevicesCount:n,onClose:a,onComplete:v,onForgotRC:l,onSkip:u,pushPage:m,shouldShowForgotButton:_,source:g})):t!=null?s.jsx(p,{onClose:a,onComplete:i,onSkip:u,pushPage:m,shouldShowForgotButton:_}):s.jsx(f,{offlineDevicesCount:n,onClose:a,onComplete:k,onForgotRC:l,onSkip:u,pushPage:m,shouldShowForgotButton:_,source:g})}g.displayName=g.name+" [from "+i.id+"]",l.default=g}),98);
__d("MAWPinCodeGating",["gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("3955")&&r("justknobx")._("1015")}l.isPinCodeEnabled=e}),98);
__d("MWChatEncryptedBackupsPinCodeRestoreContext.react",["FBLogger","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useContext,d=u.useMemo,m=s.createContext({onComplete:function(){throw r("FBLogger")("messenger_web_trust").mustfixThrow("MWChatEncryptedBackupsPinCodeRestoreContext onComplete called outside of provider!")},onSkip:function(){throw r("FBLogger")("messenger_web_trust").mustfixThrow("MWChatEncryptedBackupsPinCodeRestoreContext onSkip called outside of provider!")},pushPage:function(){throw r("FBLogger")("messenger_web_trust").mustfixThrow("MWChatEncryptedBackupsPinCodeRestoreContext pushPage called outside of provider!")}});function p(){return c(m)}function _(e){var t=o("react-compiler-runtime").c(7),n=e.children,r=e.onComplete,a=e.onSkip,i=e.pushPage,l,u;t[0]!==r||t[1]!==a||t[2]!==i?(u={onComplete:r,onSkip:a,pushPage:i},t[0]=r,t[1]=a,t[2]=i,t[3]=u):u=t[3],l=u;var c=l,d;return t[4]!==n||t[5]!==c?(d=s.jsx(m.Provider,{value:c,children:n}),t[4]=n,t[5]=c,t[6]=d):d=t[6],d}l.MWChatEncryptedBackupsPinCodeRestoreContext=m,l.usePinCodeRestoreContext=p,l.MWChatEncryptedBackupsPinCodeRestoreProvider=_}),98);
__d("MWChatEncryptedBackupsPinCodeRestoreStep.react",["fbt","CometPlaceholder.react","FocusRegion.react","JSResourceForInteraction","MWChatEBPinCodeVerifyIndicator.react","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsPinCodeRestoreContext.react","MWChatEncryptedBackupsQPLEvents","MWEBQPResetPIN.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsForgotPinStep","MWEncryptedBackupsOtcRestoreSteps","MWLogInteraction","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXLink.react","MWXMultiStepDialogHeader.react","MWXText.react","QPLUserFlow","cr:6247","focusScopeQueries","gkx","lazyLoadComponent","nullthrows","promiseDone","react","react-compiler-runtime","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsPinCodeRestore","useVisibilityObserver","useWAInfraMobileDeviceList","xplatToDOMRef"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useEffect,p=c.useState,_=r("gkx")("23219"),f=r("JSResourceForInteraction")("MWChatEncryptedBackupsPinCodeBlockedStep.react").__setRef("MWChatEncryptedBackupsPinCodeRestoreStep.react"),g="chat-encrypted-backups-dialog-layout-restore-step";function h(e){var t=o("react-compiler-runtime").c(12),n=e.isInProgress,a=e.onClose,i=e.onComplete,l=e.pushPage,s=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),c=s.virtualDeviceInfo,d=c.offlineDevicesCount,m=o("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),p=r("useWAInfraMobileDeviceList")(),_=p.length>0,f;t[0]!==d||t[1]!==a||t[2]!==i||t[3]!==l||t[4]!==_?(f={hasMobileDevices:_,offlineDevicesCount:d,onClose:a,onComplete:i,pushPage:l},t[0]=d,t[1]=a,t[2]=i,t[3]=l,t[4]=_,t[5]=f):f=t[5];var g=o("MWEncryptedBackupsForgotPinStep").useForgotPinLinkPushPageProps(f),h=m||n?"disabled":"highlight",y=m||n,C;t[6]!==g||t[7]!==y?(C=u.jsx(r("MWXLink.react"),babelHelpers.extends({},g,{disabled:y,testid:void 0})),t[6]=g,t[7]=y,t[8]=C):C=t[8];var b;return t[9]!==h||t[10]!==C?(b=u.jsx(r("MWXText.react"),{color:h,type:"button2",children:C}),t[9]=h,t[10]=C,t[11]=b):b=t[11],b}function y(e){var t=o("react-compiler-runtime").c(46),a=e.onClose,i=e.onComplete,l=e.onSkip,c=e.pushPage,d=e.shouldShowForgotButton,y=d===void 0?!0:d,v=p(null),S=v[0],R=v[1],L=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),E=L.virtualDeviceInfo,k=E.vestaClientID,I;t[0]!==k?(I=r("nullthrows")(k),t[0]=k,t[1]=I):I=t[1];var T;t[2]!==i||t[3]!==I?(T={clientID:I,focusRegionId:g,onVestaComplete:i},t[2]=i,t[3]=I,t[4]=T):T=t[4];var D=o("useMWChatEncryptedBackupsPinCodeRestore").useMWChatEncryptedBackupsPinCodeRestore(T),x=D.focusOnInput,$=D.inputProps,P=D.invalidKeyPressedError,N=D.isInProgress,M=D.isLabyrinthError,w=D.isPinCodeIncorrect,A=D.isVestaError,F=p(!1),O=F[0],B=F[1],W=N||O,q;t[5]===Symbol.for("react.memo_cache_sentinel")?(q=s._(/*BTDS*/"Some messages are missing. Enter your PIN to restore your chat history."),t[5]=q):q=t[5];var U=q,V=o("MWEBVestaUserInfoContext.react").useMWEBVestaUserInfo(),H=V.attemptsRemaining,G=V.loginTimeoutRemainingSecs,z=V.refetchVestaClientInfo,j=H===0,K=o("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),Q=r("useEncryptedBackupsQplImpressionRef")(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"PIN_CODE_RESTORE_SCREEN",void 0,function(){x(),re!=null&&r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_OPTION_DISPLAYED_RESTORE_SCREEN")}),X=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),Y=X.virtualDeviceInfo,J=Y.doesUserHaveOtcEligibleDevices,Z;t[6]!==W||t[7]!==a||t[8]!==i||t[9]!==c||t[10]!==y?(Z=y?u.jsx(h,{isInProgress:W,onClose:a,onComplete:i,pushPage:c}):null,t[6]=W,t[7]=a,t[8]=i,t[9]=c,t[10]=y,t[11]=Z):Z=t[11];var ee=Z,te;t[12]!==a||t[13]!==i||t[14]!==l||t[15]!==c?(te=function(){o("MWEncryptedBackupsOtcRestoreSteps").pushByOneTimeCodePage({onClose:a,onOtcComplete:i,onSkip:l,pushPage:c})},t[12]=a,t[13]=i,t[14]=l,t[15]=c,t[16]=te):te=t[16];var ne=te,re=J?u.jsx(r("MWXText.react"),{color:K||W?"disabled":"highlight",type:"button2",children:u.jsx(r("MWXLink.react"),{disabled:K||W,onClick:function(){o("MWLogInteraction").logPopoverOpenCancel("initiate_restore"),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),ne()},rel:"noreferrer",testid:void 0,children:s._(/*BTDS*/"Use a one-time code instead")})}):null,oe=re!=null?re:ee,ae;t[17]===Symbol.for("react.memo_cache_sentinel")?(ae=s._(/*BTDS*/"Enter your PIN to restore your chat history"),t[17]=ae):ae=t[17];var ie=ae,le;t[18]===Symbol.for("react.memo_cache_sentinel")?(le=r("lazyLoadComponent")(f),t[18]=le):le=t[18];var se=le,ue;t[19]===Symbol.for("react.memo_cache_sentinel")?(ue={onVisible:b},t[19]=ue):ue=t[19];var ce=r("useVisibilityObserver")(ue),de;if(t[20]!==H||t[21]!==$||t[22]!==P||t[23]!==K||t[24]!==W||t[25]!==M||t[26]!==w||t[27]!==A||t[28]!==G||t[29]!==j||t[30]!==a||t[31]!==i||t[32]!==S||t[33]!==Q||t[34]!==z||t[35]!==oe||t[36]!==re||t[37]!==ce){var me;de=K?u.jsx(se,{attemptsRemaining:H,loginTimeoutRemainingSecs:G,onClose:a,onComplete:i,refetchVestaClientInfo:z}):u.jsx(r("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",includeFDSContentPadding_REMOVE_THIS_AFTER_CONTENT_PADDING_MIGRATION:!1,ref:o("xplatToDOMRef").xplatToDOMRef(Q),children:u.jsxs(r("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingVertical:16,ref:ce,spacing:0,children:[u.jsx(r("MWXColumnItem.react"),{align:"center",paddingTop:16,children:u.jsx("div",{className:"xg87l8a",children:u.jsx(r("MWEBQPResetPIN.react"),{})})}),u.jsx(r("MWXColumnItem.react"),{align:"center",paddingVertical:16,children:u.jsx(r("MWXText.react"),{align:"center",isSemanticHeading:!0,type:"headlineEmphasized2",children:ie})}),u.jsx(r("MWXColumnItem.react"),{align:"center",children:u.jsx(r("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:u.jsx("div",{className:"x1l90r2v x2b8uid",children:U})})}),u.jsx(r("MWXColumnItem.react"),{align:"center",children:u.jsx(r("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:(me=P!=null?P:S)!=null?me:w&&re!=null?s._(/*BTDS*/"Incorrect PIN. Try again or use a one-time code."):w?s._(/*BTDS*/"Incorrect PIN. Try again."):M||A?s._(/*BTDS*/"There was an error while using the PIN Code, please try again"):void 0,children:u.jsx(o("FocusRegion.react").FocusRegion,{autoFocusQuery:o("focusScopeQueries").tabbableScopeQuery,id:g,children:u.jsx(r("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers.extends({},$,{disabled:G!=null||j||W,testid:void 0}))})})}),W&&u.jsx(r("MWXColumnItem.react"),{align:"center",children:u.jsx(r("MWChatEBPinCodeVerifyIndicator.react"),{isMessenger:_})}),!W&&u.jsx(r("MWXColumnItem.react"),{align:"center",children:u.jsx("div",{className:"x1y1aw1k",children:oe})}),n("cr:6247")!=null&&u.jsx(r("CometPlaceholder.react"),{fallback:null,name:"MWChatEncryptedBackupsPinCodeRestoreStep",children:u.jsx(n("cr:6247"),{onComplete:i,onError:R,setIsLoading:B})})]})}),t[20]=H,t[21]=$,t[22]=P,t[23]=K,t[24]=W,t[25]=M,t[26]=w,t[27]=A,t[28]=G,t[29]=j,t[30]=a,t[31]=i,t[32]=S,t[33]=Q,t[34]=z,t[35]=oe,t[36]=re,t[37]=ce,t[38]=de}else de=t[38];var pe=de,_e;t[39]===Symbol.for("react.memo_cache_sentinel")?(_e=[],t[39]=_e):_e=t[39],m(C,_e);var fe;t[40]===Symbol.for("react.memo_cache_sentinel")?(fe=u.jsx(r("MWXMultiStepDialogHeader.react"),{withCloseButton:!1,withoutBackButton:!0}),t[40]=fe):fe=t[40];var ge;return t[41]!==pe||t[42]!==i||t[43]!==l||t[44]!==c?(ge=u.jsxs(o("MWChatEncryptedBackupsPinCodeRestoreContext.react").MWChatEncryptedBackupsPinCodeRestoreProvider,{onComplete:i,onSkip:l,pushPage:c,children:[fe,pe]}),t[41]=pe,t[42]=i,t[43]=l,t[44]=c,t[45]=ge):ge=t[45],ge}function C(){r("promiseDone")(f.load())}function b(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").ebResetObserverQplEvent,"PUSH_PIN_CODE_RESTORE_DIALOG_VISIBLE"),r("QPLUserFlow").endSuccess(o("MWChatEncryptedBackupsQPLEvents").ebResetObserverQplEvent)}l.default=y}),226);
__d("MWEBEOTRDialog.entrypoint",["JSResourceForInteraction"],(function(t,n,r,o,a,i,l){"use strict";var e=r("JSResourceForInteraction")("MWEBEOTRDialog.react").__setRef("MWEBEOTRDialog.entrypoint"),s={getPreloadProps:function(){return{queries:{}}},root:e};l.default=s}),98);
__d("MWEBOTCErrorMessages",["fbt"],(function(t,n,r,o,a,i,l,s){"use strict";var e=function(){return s._(/*BTDS*/"Incorrect code. Try again.")},u=function(){return s._(/*BTDS*/"Code not found. Try resending a new code.")},c=function(){return s._(/*BTDS*/"Too many attempts. Try again later.")},d=function(){return s._(/*BTDS*/"Code expired. Try generating a new code.")},m=function(){return s._(/*BTDS*/"Something went wrong. Please try again.")},p=function(){return s._(/*BTDS*/"Couldn't send code. Please try again.")},_=function(){return s._(/*BTDS*/"Couldn't load trusted devices. Please try again.")};l.getOtcIsWrongErrorMessage=e,l.getNoSessionOngoingErrorMessage=u,l.getMaxAttemptsReachedErrorMessage=c,l.getSessionExpiredErrorMessage=d,l.getGeneralErrorMessage=m,l.getNotificationFailedToSendErrorMessage=p,l.getFailedToFetchOtcDevicesErrorMessage=_}),226);
__d("MWEBPinCodeTryAgainLaterDialog.entrypoint",["JSResourceForInteraction"],(function(t,n,r,o,a,i,l){"use strict";var e={getPreloadProps:function(){return{queries:{}}},root:r("JSResourceForInteraction")("MWEBPinCodeTryAgainLaterDialog.react").__setRef("MWEBPinCodeTryAgainLaterDialog.entrypoint")};l.default=e}),98);
__d("PAKEClientTypeEnum",[],(function(t,n,r,o,a,i){var e=Object.freeze({PAKE_TEST:-1,ENCRYPTED_BACKUPS:0,EB_MULTI_USER_OTC:1});i.default=e}),66);
__d("useMWAbandonRestoreConfirmationDialog",["fbt","MWChatEncryptedBackupResetContext","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","gkx","react","useMWXConfirmationDialog"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=u.useCallback,d=u.useContext;function m(e){var t=r("useMWXConfirmationDialog")(),n=r("gkx")("23219"),a=d(r("MWChatEncryptedBackupResetContext")),i=a.isEncryptedBackupResetUserJourneyStartedRef;return c(function(){t({body:i!=null&&i.current?s._(/*BTDS*/"Your chats won't be backed up, and you won't be able to restore them if you switch devices."):n?s._(/*BTDS*/"This means that you won't see your full chat history on this device."):s._(/*BTDS*/"This means you won't see your full chat history on this device and new messages you send or receive may not load on other new devices."),cancel:i!=null&&i.current?s._(/*BTDS*/"Go back"):void 0,confirm:i!=null&&i.current?s._(/*BTDS*/"Close"):s._(/*BTDS*/"Don't restore messages"),title:i!=null&&i.current?s._(/*BTDS*/"Are you sure?"):s._(/*BTDS*/"Continue without restoring?")},function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"DONT_RESTORE_CONFIRMATION_CLICK"),e==null||e()},function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"DONT_RESTORE_CANCEL_CLICK")})},[i,t,n,e])}l.default=m}),226);
__d("MWEBRestoreDialog.react",["FBLogger","InteractionTracing.xplat","MAWEncryptedBackupsRestoreStep.react","MAWPinCodeGating","MWChatEncryptedBackupOnCloseContext","MWChatEncryptedBackupsDismissalDialogContext","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBHasSeenAutoRestoreNoticeContext","MWEBVirtualDevicesContext.react","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsForgotRCStep","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWXMultiStepDialog_DEPRECATED.react","PAKECleanupSessionReasonEnum","PAKEClientTypeEnum","QPLUserFlow","UserMobileEBState","cr:27430","cr:5777","promiseDone","react","react-compiler-runtime","requireDeferred","useLabyrinthLogging","useMWAbandonRestoreConfirmationDialog","useMWEBAutoRestoreNoticeStep","useMWEBFlowSourceContext","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=s,d=c.useCallback,m=c.useContext,p=c.useEffect,_=c.useRef,f=r("requireDeferred")("CleanupPakeSession").__setRef("MWEBRestoreDialog.react"),g=r("requireDeferred")("mwEBCheckIfEBKeysExistInDisk").__setRef("MWEBRestoreDialog.react");function h(t){var a=o("react-compiler-runtime").c(34),i=t.cancellable,l=t.onClose,s=t.onDismissUpsell,c=t.skipToEOTRForgotPINStep,d=i===void 0?!0:i,h=_(!1),C=(e||(e=r("useReStore")))(),b=o("useLabyrinthLogging").useLabyrinthLoggingFlow(),v=b.startFlow,S=r("useMWEBFlowSourceContext")(),R=m(r("MWChatEncryptedBackupsDismissalDialogContext")),L=R.isDismissedDisabled,E=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),k=E.virtualDeviceInfo,I=m(r("MWEBHasSeenAutoRestoreNoticeContext")),T=I.hasSeenNotice,D;a[0]!==s||a[1]!==C||a[2]!==k.doesUserHaveOtcEligibleDevices?(D=function(){s==null||s(),k.doesUserHaveOtcEligibleDevices===!0&&f.onReady(function(e){r("promiseDone")(e({cleanupReason:r("PAKECleanupSessionReasonEnum").FLOW_ABANDONED,clientType:r("PAKEClientTypeEnum").ENCRYPTED_BACKUPS,deviceId:o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),storage:C}))})},a[0]=s,a[1]=C,a[2]=k.doesUserHaveOtcEligibleDevices,a[3]=D):D=a[3];var x=D,$;a[4]!==l||a[5]!==x?($=function(){o("MWChatEncryptedBackupsLogging").closeDialogCancelFlow({event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,onClose:function(){return l()}}),x()},a[4]=l,a[5]=x,a[6]=$):$=a[6];var P=$,N=m(r("MWChatEncryptedBackupOnCloseContext")),M=N.setOnCloseSkipConfirmation,w,A;a[7]!==P||a[8]!==M?(w=function(){M(function(){return P})},A=[P,M],a[7]=P,a[8]=M,a[9]=w,a[10]=A):(w=a[9],A=a[10]),p(w,A);var F=r("useMWAbandonRestoreConfirmationDialog")(P),O;a[11]!==l||a[12]!==x?(O=function(){o("MWChatEncryptedBackupsLogging").cancelFlow({cancelEndPoint:"reset_skip",event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),l(),x()},a[11]=l,a[12]=x,a[13]=O):O=a[13];var B=O,W=r("useMWEBAutoRestoreNoticeStep")(),q=k.vestaClientID!=null,U,V;a[14]!==S||a[15]!==v||a[16]!==C?(U=function(){h.current||(h.current=!0,o("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:C,onFetch:function(t){var e=t.ebsmWiped,n=t.firstUpsellTime,a=t.hasEbKeysLocally,i=t.hasEBSM,l=t.hasPDB,s=t.hasUserRestoredBefore,u=t.hasUserRestoredBeforeTemp,c=S();v({additionalAnnotations:{eb_session_identifier:n,ebsm_wiped:e,has_eb_keys_locally:a,has_ebsm:i,has_pdb:l,has_user_restored_before:s,has_user_restored_before_temp:u,restore_upsell_first_impression_time:n},event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:c}),c===r("MWChatEncryptedBackupsQPLSource.enum").INBOX_INTERSTITIAL_SOFTBLOCK&&(r("InteractionTracing.xplat").getPendingInteractions().forEach(y),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"INBOX_SOFTBLOCK_RESTORE_SCREEN")),r("promiseDone")(g.load(),function(e){return e(a)})}}))},V=[S,v,C],a[14]=S,a[15]=v,a[16]=C,a[17]=U,a[18]=V):(U=a[17],V=a[18]),p(U,V);var H=L?l:F,G;a[19]!==W||a[20]!==S||a[21]!==T||a[22]!==q||a[23]!==l||a[24]!==F||a[25]!==B||a[26]!==c||a[27]!==k.offlineDevicesCount||a[28]!==k.vestaClientID?(G=function(t){var e=function(n){return W({hasSeenNotice:T,onNextStep:n,pushPage:t})},a=n("cr:27430")!=null?u.jsx(n("cr:27430"),{closeOnComplete:!0,onClose:l,onComplete:function(){e(l)}}):null,i=n("cr:5777")!=null?u.jsx(n("cr:5777"),{onClose:l,onComplete:function(){e(l)},pushPage:t}):null,s=c===o("UserMobileEBState").UserMobileEBState.UNTRUSTED_MOBILE?i:c===o("UserMobileEBState").UserMobileEBState.NO_MOBILE?a:null,d=c===o("UserMobileEBState").UserMobileEBState.UNTRUSTED_MOBILE||c===o("UserMobileEBState").UserMobileEBState.NO_MOBILE;return d&&s==null&&r("FBLogger")("messenger_web_trust").mustfix("No dialog step found for EOTR flow - empty dialog rendered to the user"),s!=null?s:u.jsx(r("MAWEncryptedBackupsRestoreStep.react"),{clientID:o("MAWPinCodeGating").isPinCodeEnabled()&&q?k.vestaClientID:null,offlineDevicesCount:k.offlineDevicesCount,onClose:F,onComplete:function(){e(l)},onForgotRC:function(){o("MWEncryptedBackupsForgotRCStep").pushForgotRCPage({onClose:l,onComplete:l,pushPage:t})},onSkip:B,pushPage:t,shouldShowForgotButton:!0,source:S()})},a[19]=W,a[20]=S,a[21]=T,a[22]=q,a[23]=l,a[24]=F,a[25]=B,a[26]=c,a[27]=k.offlineDevicesCount,a[28]=k.vestaClientID,a[29]=G):G=a[29];var z;return a[30]!==d||a[31]!==G||a[32]!==H?(z=u.jsx(r("MWXMultiStepDialog_DEPRECATED.react"),{onClose:H,size:"small",withCloseButton:d,children:G}),a[30]=d,a[31]=G,a[32]=H,a[33]=z):z=a[33],z}function y(e){e.addAnnotationBoolean("eb_soft_block",!0)}l.default=h}),98);
__d("MWEBRestoreInterstitialDialogWrapper_query.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEBRestoreInterstitialDialogWrapper_query",selections:[{args:null,kind:"FragmentSpread",name:"MAWEncryptedBackupsRestoreDialogContexts_query"}],type:"Query",abstractKey:null};a.exports=e}),null);
__d("MWEBRestoreInterstitialDialogWrapper.react",["CometRelay","MAWEncryptedBackupsRestoreDialogContexts.react","MWChatEncryptedBackupsQPLSource.enum","MWEBRestoreDialog.react","MWEBRestoreInterstitialDialogWrapper_query.graphql","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react"));function c(t){var a=o("react-compiler-runtime").c(9),i=t.query,l=t.setIsClosed,s=t.setIsDialogPersisted,c=t.setIsDismissed,d=o("CometRelay").useFragment(e!==void 0?e:e=n("MWEBRestoreInterstitialDialogWrapper_query.graphql"),i),m=r("MWChatEncryptedBackupsQPLSource.enum").INBOX_INTERSTITIAL_SOFTBLOCK,p;a[0]!==l?(p=function(){return l(!0)},a[0]=l,a[1]=p):p=a[1];var _;a[2]!==c||a[3]!==p?(_=u.jsx(r("MWEBRestoreDialog.react"),{onClose:p,onDismissUpsell:c}),a[2]=c,a[3]=p,a[4]=_):_=a[4];var f;return a[5]!==d||a[6]!==s||a[7]!==_?(f=u.jsx(r("MAWEncryptedBackupsRestoreDialogContexts.react"),{query:d,setIsDialogPersisted:s,source:m,children:_}),a[5]=d,a[6]=s,a[7]=_,a[8]=f):f=a[8],f}l.default=c}),98);
__d("MWEncryptedBackupsOTCShowNotificationSentToast",["fbt","FDSCheckmarkFilled24Icon","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","SVGIcon","cr:4027","cr:6570","mwPushToast","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(){var e=n("cr:6570")?u.jsx(n("cr:6570"),{icon:r("FDSCheckmarkFilled24Icon")}):void 0,t=n("cr:4027")?o("SVGIcon").svgIcon(n("cr:4027")):void 0;o("mwPushToast").mwPushToast({body:s._(/*BTDS*/"Code sent."),icon:{comet:e,mds:t},testid:"mw-chat-encrypted-backups-otc-notification-sent-successful-toast"}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_NOTIFICATION_SENT_SUCCESSFUL_TOAST")}l.showOTCNotificationSentToast=c}),226);
__d("MWEncrypedBackupsSendOTCNotifications",["FBLogger","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSFactory","LSSendOTCNotificationsStoredProcedure","LSVec","MWEncryptedBackupsOTCShowNotificationSentToast","ReQL","ReQLSuspense","err","react","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(s||(s=o("react"))).useCallback;async function d(e){var t=e.db,n=e.deviceIds,a=new Promise(function(e,n){var a=o("ReQL").fromTableAscending(t.tables.encrypted_backups_otc_notification_sending_status),i=a.subscribe(function(t,a){if(a.operation!=="delete"){var l=a.value;if(l!=null){var s=(u||(u=o("I64"))).to_int32(l.authorityLevel);if(s===r("LSAuthorityLevel").AUTHORITATIVE)switch(i(),(u||(u=o("I64"))).to_int32(l.notificationSendingStatus)){case r("LSEncryptedBackupsOpStatus").SUCCESS:return o("MWEncryptedBackupsOTCShowNotificationSentToast").showOTCNotificationSentToast(),e();case r("LSEncryptedBackupsOpStatus").FAILURE:return n(r("err")("[sendOTCNotifications] Failure"));default:return r("FBLogger")("wmi_eb").mustfix("OTC: Unexpected UNKNOWN status type for notification sending result."),n(r("err")("[sendOTCNotifications] Unknown"))}}}})});return await t.runInTransaction(function(e){return r("LSSendOTCNotificationsStoredProcedure")(r("LSFactory")(e),{deviceIds:r("LSVec").ofArray(n!=null?n:[])})},"readwrite",void 0,void 0,i.id+":81"),a}function m(){var t,n=o("react-compiler-runtime").c(5),a=(e||(e=r("useReStore")))(),l=(t=o("ReQLSuspense").useFirst(function(){return o("ReQL").fromTableAscending(a.tables.encrypted_backups_otc_notification_sending_status)},[a.tables.encrypted_backups_otc_notification_sending_status],i.id+":98"))==null?void 0:t.authorityLevel,s=l!=null&&(u||(u=o("I64"))).to_int32(l)===r("LSAuthorityLevel").OPTIMISTIC,c;n[0]!==a?(c=function(t){return d({db:a,deviceIds:t})},n[0]=a,n[1]=c):c=n[1];var m=c,p;return n[2]!==s||n[3]!==m?(p=[m,s],n[2]=s,n[3]=m,n[4]=p):p=n[4],p}l.sendOTCNotifications=d,l.useSendOTCNotifications=m}),98);
__d("usePakeInitiatorManager",["FBLogger","PakeCpaceWasm","promiseDone","react","react-compiler-runtime","requireDeferred","useAsyncReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useEffect,d=s.useRef,m=r("requireDeferred")("establishPakeHandshakeAsInitiator").__setRef("usePakeInitiatorManager"),p=3e4;function _(e){var t=o("react-compiler-runtime").c(15),n=e.onGeneralFailure,a=e.onMaxAttemptsReached,i=e.onNoSessionExists,l=e.onSessionExpired,s=e.onSuccessfulSecretDecryption,u=e.onWrongOtc,_=e.timeout,b=e.clientType,v=_===void 0?p:_,S=r("useAsyncReStore")(),R=d(null),L=d(C),E=d(y),k=d(null),I=d(!1),T;t[0]===Symbol.for("react.memo_cache_sentinel")?(T=function(){var e;E.current(),E.current=h,(e=R.current)==null||e.delete(),R.current=null,L.current(),L.current=g},t[0]=T):T=t[0];var D=T,x,$;t[1]===Symbol.for("react.memo_cache_sentinel")?(x=function(){return I.current===!1&&(I.current=!0,r("promiseDone")(o("PakeCpaceWasm").PakeCPaceWasm().then(function(e){k.current=e}),void 0,f)),D},$=[D],t[1]=x,t[2]=$):(x=t[1],$=t[2]),c(x,$);var P;t[3]!==b||t[4]!==S||t[5]!==n||t[6]!==a||t[7]!==i||t[8]!==l||t[9]!==s||t[10]!==u||t[11]!==v?(P=function(t){return Promise.all([S,m.load()]).then(async function(e){var r=e[0],o=e[1],c=await o({clientType:b,onGeneralFailure:n,onMaxAttemptsReached:a,onNoSessionExists:i,onSessionExpired:l,onSuccessfulSecretDecryption:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t;D(),s.apply(void 0,r)},onWrongOtc:u,otc:t,pakeCpaceModule:k.current,storage:r,timeout:v}),d=c.pakeClient,m=c.stopTimeout,p=c.unsubFromMessagesTable;R.current=d,L.current=m,E.current=p})},t[3]=b,t[4]=S,t[5]=n,t[6]=a,t[7]=i,t[8]=l,t[9]=s,t[10]=u,t[11]=v,t[12]=P):P=t[12];var N=P,M;return t[13]!==N?(M={establishPakeHandshakeAsInitiator:N},t[13]=N,t[14]=M):M=t[14],M}function f(){r("FBLogger")("wmi_eb").mustfix("PAKE: Error loading WASM module")}function g(){}function h(){}function y(){}function C(){}l.default=_}),98);
__d("MWEncryptedBackupsInsertOTCStep.react",["fbt","EBSMAPI","EBSMGatingUI","FBLogger","FocusRegion.react","JSResourceForInteraction","MWChatEncryptedBackupsDismissalDialogContext","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSetIsDialogPersistedContext","MWEBEOTRDialog.entrypoint","MWEBLazyLoadResetPinPage","MWEBOTCErrorMessages","MWEBOTCInterstitialIllustration.react","MWEBPinCodeTryAgainLaterDialog.entrypoint","MWEBVirtualDevicesContext.react","MWEncrypedBackupsSendOTCNotifications","MWEncryptedBackupsLocalStorageEntryEnum","MWXColumn.react","MWXColumnItem.react","MWXDeferredPopoverTrigger.react","MWXDialogPageLegacy.react","MWXLink.react","MWXMultiStepDialogHeader.react","MWXRow.react","MWXRowItem.react","MWXSpinner.react","MWXText.react","PAKEClientTypeEnum","QPLUserFlow","focusScopeQueries","gkx","justknobx","promiseDone","react","requireDeferred","useAsyncReStore","useMWChatEncryptedBackupsNumericCode","useMWEBFlowSourceContext","usePakeInitiatorManager","usePushFDSMultiStepDialogEntryPointPage","usePushPage","useVisibilityObserver"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["onHighIntent"],u,c=u||(u=o("react")),d=u,m=d.useCallback,p=d.useContext,_=d.useEffect,f=d.useMemo,g=d.useRef,h=d.useState,y=r("requireDeferred")("MWEBUseLocalStorage").__setRef("MWEncryptedBackupsInsertOTCStep.react"),C=r("requireDeferred")("MWEncryptedBackupsOTCEligibleDevicesPopover.react").__setRef("MWEncryptedBackupsInsertOTCStep.react"),b=r("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("MWEncryptedBackupsInsertOTCStep.react"),v=r("requireDeferred")("deserializeSecretsAndAddDevice").__setRef("MWEncryptedBackupsInsertOTCStep.react"),S=r("JSResourceForInteraction")("MWEBPushResetPinPage").__setRef("MWEncryptedBackupsInsertOTCStep.react"),R=r("gkx")("18276"),L="chat-encrypted-backups-dialog-layout-second-step",E=6,k="https://www.facebook.com/help/messenger-app/431055522328649?ref=learn_more",I=r("gkx")("23219"),T=r("gkx")("20861"),D=r("justknobx")._("654");function x(t){var n=t.onClose,a=t.onComplete,i=t.onSkip,l=t.pushPage,u=h(!1),d=u[0],x=u[1],$=g(!1),P=g(!1),N=g(function(){}),M=h(null),w=M[0],A=M[1],F=r("useAsyncReStore")(),O=r("useMWEBFlowSourceContext")(),B=p(r("MWChatEncryptedBackupsSetIsDialogPersistedContext")).setIsDialogPersisted;_(function(){return function(){N.current()}},[]);var W=o("MWEncrypedBackupsSendOTCNotifications").useSendOTCNotifications(),q=W[0],U=W[1],V=m(function(){q().catch(function(){r("FBLogger")("wmi_eb").mustfix("OTC: Send otc notifications sproc failed."),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_SEND_NOTIFICATION_FAILURE"),A(o("MWEBOTCErrorMessages").getNotificationFailedToSendErrorMessage())})},[q]),H=h(!1),G=H[0],z=H[1],j=r("useVisibilityObserver")({onVisible:function(){z(!0)}});_(function(){D!==!0&&$.current===!1&&($.current=!0,r("promiseDone")(S.load()),V())},[V]),_(function(){D!==!1&&($.current===!0||G===!1||($.current=!0,r("promiseDone")(S.load()),V()))},[G,V]);var K=p(r("MWChatEncryptedBackupsDismissalDialogContext")),Q=K.setIsDismissedDisabled,X=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),Y=X.virtualDeviceInfo,J=m(function(){Y.vestaClientID!=null?(Q(!0),r("MWEBLazyLoadResetPinPage")(a,l)):a()},[a,l,Q,Y.vestaClientID]),Z=r("usePakeInitiatorManager")({clientType:r("PAKEClientTypeEnum").ENCRYPTED_BACKUPS,onGeneralFailure:m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_API_FAILURE"),A(o("MWEBOTCErrorMessages").getGeneralErrorMessage()),P.current=!0,x(!1),B==null||B(!1)},[B]),onMaxAttemptsReached:m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_MAX_ATTEMPTS_REACHED"),A(o("MWEBOTCErrorMessages").getMaxAttemptsReachedErrorMessage()),P.current=!0,x(!1)},[]),onNoSessionExists:m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_NO_SESSION"),A(o("MWEBOTCErrorMessages").getNoSessionOngoingErrorMessage()),P.current=!0,x(!1)},[]),onSessionExpired:m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_SESSION_EXPIRED"),A(o("MWEBOTCErrorMessages").getSessionExpiredErrorMessage()),P.current=!0,x(!1)},[]),onSuccessfulSecretDecryption:m(function(e){var t=e.decryptedSecret,n=e.initiatorId;B==null||B(!0),r("promiseDone")(v.load(),function(e){r("promiseDone")(F.then(function(a){return e({db:a,initiatorId:n,onAddDeviceFailure:function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_ADD_DEVICE_FAILURE"),A(o("MWEBOTCErrorMessages").getGeneralErrorMessage()),P.current=!0,x(!1),B==null||B(!1)},onAddDeviceFinish:function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_ADD_DEVICE_FINISHED"),o("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),b.onReady(function(e){var t=e.upsertEBSharedStateEntry;r("promiseDone")(t({db:a,stateKey:r("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}))}),y.onReady(function(e){var t=e.mwEBCreateLocalStorageEntry,n=e.mwEBDeleteLocalStorageEntry;t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION),t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2),n(r("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),J(),x(!1),r("EBSMAPI").fetchBackupIds("MWEncryptedBackupsInsertOTCStep.react").catch(function(e){return r("FBLogger")("wmi_eb").mustfix("OTC Restore: Error when fetching backup ids, %s",e)})},secrets:t})}),function(e){N.current=e})})},[F,J,B]),onWrongOtc:m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_INCORRECT_CODE"),A(o("MWEBOTCErrorMessages").getOtcIsWrongErrorMessage()),P.current=!0,x(!1)},[])}),ee=Z.establishPakeHandshakeAsInitiator,te=o("useMWChatEncryptedBackupsNumericCode").useMWChatEncryptedBackupsNumericCode({focusRegionId:L,inputSize:E,onChange:function(){A()},onComplete:function(t){var e=O();r("QPLUserFlow").addAnnotations(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"one_time_code",source:e}}),x(!0),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_SUBMIT"),r("promiseDone")(ee(t))},type:"otc"}),ne=te[0],re=te[1],oe=re.clearNumericInput,ae=re.focusOnInput,ie=re.isLoading,le=m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_RESEND_CLICK"),V(),ae()},[ae,V]),se=r("usePushFDSMultiStepDialogEntryPointPage")(r("MWEBEOTRDialog.entrypoint"),{}),ue=se[0],ce=se[1],de=r("usePushPage")(r("MWEBPinCodeTryAgainLaterDialog.entrypoint"),{}),me=de[0],pe=de[1],_e=pe.onHighIntent,fe=babelHelpers.objectWithoutPropertiesLoose(pe,e),ge=m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_HELP_CLICK"),ce({onClose:n,onSkip:i})},[n,i,ce]),he=m(function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_PIN_LOCKED_NO_OTHER_DEVICE_CLICK"),me({onSkip:i})},[i,me]);_(function(){P.current&&(oe(),P.current=!1)},[oe]);var ye=r("useVisibilityObserver")({onVisible:function(){r("QPLUserFlow").addAnnotations(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{bool:{otc_check_first:!1,otc_devices_popover:!0}}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_SCREEN"),ae()}}),Ce=s._(/*BTDS*/"Check Messenger or Facebook on your mobile device for a one-time code"),be=f(function(){return{disabled:ie||U,label:s._(/*BTDS*/"Resend code"),onPress:le,testid:"mw-eb-otc-insert-resend-code-button",type:"secondary"}},[ie,U,le]),ve=r("justknobx")._("4787"),Se=f(function(){return{label:s._(/*BTDS*/"Need help?"),linkProps:ve?{rel:"noreferrer",target:"_blank",url:k}:void 0,onPress:ve?void 0:ge,testid:"mw-eb-otc-insert-help-button"}},[ge,ve]),Re=f(function(){return babelHelpers.extends({label:s._(/*BTDS*/"Don\u2019t have your other device?"),onPress:he},fe,{testid:"mw-eb-otc-no-other-device-button"})},[he,fe]),Le=R?Re:Se,Ee=Le!=null;return c.jsxs(c.Fragment,{children:[c.jsx(r("MWXMultiStepDialogHeader.react"),{withCloseButton:!1,withoutBackButton:!0,withoutHeaderBottomBorder:!0}),c.jsx(r("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",includeFDSContentPadding_REMOVE_THIS_AFTER_CONTENT_PADDING_MIGRATION:!1,primaryCallToAction:Ee&&!d?be:void 0,ref:ye,secondaryCallToAction:Ee&&!d?Le:void 0,children:c.jsx("div",{className:"x2lwn1j",ref:j,children:c.jsxs(r("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingTop:16,paddingVertical:Ee&&!d?void 0:16,spacing:8,children:[c.jsx(r("MWXColumnItem.react"),{align:"center",paddingTop:16,children:c.jsx("div",{className:"xg87l8a",children:c.jsx(r("MWEBOTCInterstitialIllustration.react"),{})})}),c.jsx(r("MWXColumnItem.react"),{align:"center",paddingVertical:16,children:c.jsx(r("MWXText.react"),{align:"center",isSemanticHeading:!0,type:"headlineEmphasized2",children:Ce})}),c.jsx(r("MWXColumnItem.react"),{align:"center",children:c.jsx("div",{className:"x1l90r2v x2b8uid",children:c.jsx(r("MWXDeferredPopoverTrigger.react"),{align:"middle",popoverProps:{},popoverResource:C,position:"above",children:function(t,n){return c.jsx(r("MWXText.react"),{color:"secondary",type:"body3",children:s._(/*BTDS*/"After confirming on {device} that you requested a code, you can enter it here.",[s._param("device",c.jsx(r("MWXText.react"),{color:"blueLink",ref:t,type:"bodyLink3",children:c.jsx(r("MWXLink.react"),{onClick:function(){r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_DEVICES_POPOVER_CLICK"),n()},testid:void 0,children:s._(/*BTDS*/"your mobile device")})}))])})}})})}),c.jsxs(r("MWXColumnItem.react"),{align:"center",children:[c.jsx(r("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:w,children:c.jsx(o("FocusRegion.react").FocusRegion,{autoFocusQuery:o("focusScopeQueries").tabbableScopeQuery,id:L,children:c.jsx(r("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers.extends({},ne,{disabled:ie||d,testid:void 0}))})}),T&&w===o("MWEBOTCErrorMessages").getGeneralErrorMessage()?c.jsx("div",{className:"xwib8y2",children:c.jsx(r("MWXText.react"),{align:"center",color:"negative",type:"body4",children:s._(/*BTDS*/"[meta-only] please rageshake from both devices (mobile and web) when reporting an OTC bug")})}):null]}),d&&c.jsx(r("MWXColumnItem.react"),{align:"center",paddingTop:Ee?16:0,paddingVertical:Ee?8:0,children:c.jsxs(r("MWXRow.react"),{align:"center",paddingTop:8,spacing:8,children:[c.jsx(r("MWXRowItem.react"),{verticalAlign:"center",children:c.jsx(r("MWXSpinner.react"),{color:I?"disabled_DEPRECATED":"blue",size:12})}),c.jsx(r("MWXRowItem.react"),{verticalAlign:"center",children:c.jsx(r("MWXText.react"),{color:"secondary",testid:void 0,type:"body3",children:s._(/*BTDS*/"Verifying your code")})})]})}),!Ee&&!d&&c.jsx(r("MWXColumnItem.react"),{align:"center",paddingTop:8,children:c.jsx(r("MWXText.react"),{color:be.disabled?"disabled":"highlight",type:"button2",children:c.jsx(r("MWXLink.react"),{disabled:be.disabled,onClick:be.onPress,rel:"noreferrer",children:be.label})})})]})})})]})}x.displayName=x.name+" [from "+i.id+"]",l.default=x}),226);
__d("useMWResetAttachmentsRangesOnEBOnboard",["LSThreadMediaGalleryGroup","MAWFetchAndPersistMedia","MAWMediaRestoreEBRange","MWEBEntrypointsKillswitch.enum","promiseDone","react","react-compiler-runtime","useMWEBBackupState"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect;function u(e){var t=o("react-compiler-runtime").c(8),n=e.thread,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a={entrypoint:r("MWEBEntrypointsKillswitch.enum").MEDIA_GALLERY_RESTORE},t[0]=a):a=t[0];var i=r("useMWEBBackupState")(a),l;t[1]===Symbol.for("react.memo_cache_sentinel")?(l=o("MAWMediaRestoreEBRange").getMediaRestoreEBRange(),t[1]=l):l=t[1];var u=l,c,d;t[2]!==i||t[3]!==n.threadKey?(c=function(){i===3&&(u.resetRange(n.threadKey),r("promiseDone")(o("MAWFetchAndPersistMedia").updateLocalAttachmentsRange(n.threadKey,r("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS,{hasMoreBefore:!0})))},d=[i,u,n.threadKey],t[2]=i,t[3]=n.threadKey,t[4]=c,t[5]=d):(c=t[4],d=t[5]),s(c,d);var m;return t[6]!==i?(m={backupState:i},t[6]=i,t[7]=m):m=t[7],m}l.default=u}),98);