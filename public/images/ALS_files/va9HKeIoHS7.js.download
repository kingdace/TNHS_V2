;/*FB_PKG_DELIM*/

__d("LSInsertStickerAttachment",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[14],e[18],e[19]]]]),function(n){return t.i64.eq(n.threadKey,e[14])&&t.i64.eq(t.i64.cast([0,0]),e[15])&&n.messageId===e[18]&&n.attachmentFbid===e[19]&&t.i64.lt(n.authorityLevel,e[31])&&t.i64.eq(n.attachmentType,t.i64.cast([0,1]))&&n.hasMedia===!0&&n.hasXma===!1&&t.i64.eq(n.ephemeralMediaState,void 0)&&n.isSharable===!1}),function(e){return e.delete()})},function(n){return t.db.table(16).add({threadKey:e[14],messageId:e[18],attachmentFbid:e[19],hasMedia:!0,isSharable:!1,playableUrl:e[0],playableUrlFallback:e[1],playableUrlExpirationTimestampMs:e[2],playableUrlMimeType:e[3],previewUrl:e[4],previewUrlFallback:e[5],previewUrlExpirationTimestampMs:e[6],previewUrlMimeType:e[7],previewWidth:e[9],previewHeight:e[10],imageUrlMimeType:e[11],attachmentIndex:e[12],accessibilitySummaryText:e[13],attachmentType:t.i64.cast([0,1]),timestampMs:e[17],hasXma:!1,imageUrl:e[20],imageUrlFallback:e[21],imageUrlExpirationTimestampMs:e[22],faviconUrlExpirationTimestampMs:e[23],avatarViewSize:e[25],avatarCount:e[26],targetId:e[27],mustacheText:e[30],authorityLevel:e[31]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxInsertStickerAttachmentStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);
__d("LSInsertXmaAttachment",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[25],e[30],e[32]]]]),function(n){return t.i64.eq(n.threadKey,e[25])&&t.i64.eq(t.i64.cast([0,0]),e[26])&&n.messageId===e[30]&&n.attachmentFbid===e[32]&&t.i64.lt(n.authorityLevel,e[131])&&(t.i64.eq(n.attachmentType,t.i64.cast([0,7]))||t.i64.eq(n.attachmentType,t.i64.cast([0,0])))&&n.hasMedia===!1&&n.hasXma===!0&&t.i64.eq(n.ephemeralMediaState,void 0)}),function(e){return e.delete()})},function(n){return t.db.table(16).add({threadKey:e[25],messageId:e[30],attachmentFbid:e[32],filename:e[1],filesize:e[2],hasMedia:!1,isSharable:e[3],playableUrl:e[4],playableUrlFallback:e[5],playableUrlExpirationTimestampMs:e[6],playableUrlMimeType:e[7],previewUrl:e[8],previewUrlFallback:e[9],previewUrlExpirationTimestampMs:e[10],previewUrlMimeType:e[11],previewWidth:e[13],previewHeight:e[14],attributionAppId:e[15],attributionAppName:e[16],attributionAppIcon:e[17],attributionAppIconFallback:e[18],attributionAppIconUrlExpirationTimestampMs:e[19],attachmentIndex:e[20],accessibilitySummaryText:e[21],shouldRespectServerPreviewSize:e[22],subtitleIconUrl:e[23],shouldAutoplayVideo:e[24],attachmentType:e[27],timestampMs:e[29],offlineAttachmentId:e[31],hasXma:!0,xmaLayoutType:e[33],xmasTemplateType:e[34],collapsibleId:e[35],defaultCtaId:e[36],defaultCtaTitle:e[37],defaultCtaType:e[38],attachmentCta1Id:e[40],cta1Title:e[41],cta1IconType:e[42],cta1Type:e[43],attachmentCta2Id:e[45],cta2Title:e[46],cta2IconType:e[47],cta2Type:e[48],attachmentCta3Id:e[50],cta3Title:e[51],cta3IconType:e[52],cta3Type:e[53],imageUrl:e[54],imageUrlFallback:e[55],imageUrlExpirationTimestampMs:e[56],actionUrl:e[57],titleText:e[58],subtitleText:e[59],subtitleDecorationType:e[60],maxTitleNumOfLines:e[61],maxSubtitleNumOfLines:e[62],descriptionText:e[63],sourceText:e[64],faviconUrl:e[65],faviconUrlFallback:e[66],faviconUrlExpirationTimestampMs:e[67],listItemsId:e[69],listItemsDescriptionText:e[70],listItemsDescriptionSubtitleText:e[71],listItemsSecondaryDescriptionText:e[72],listItemId1:e[73],listItemTitleText1:e[74],listItemContactUrlList1:e[75],listItemProgressBarFilledPercentage1:e[76],listItemContactUrlExpirationTimestampList1:e[77],listItemContactUrlFallbackList1:e[78],listItemAccessibilityText1:e[79],listItemTotalCount1:e[80],listItemId2:e[81],listItemTitleText2:e[82],listItemContactUrlList2:e[83],listItemProgressBarFilledPercentage2:e[84],listItemContactUrlExpirationTimestampList2:e[85],listItemContactUrlFallbackList2:e[86],listItemAccessibilityText2:e[87],listItemTotalCount2:e[88],listItemId3:e[89],listItemTitleText3:e[90],listItemContactUrlList3:e[91],listItemProgressBarFilledPercentage3:e[92],listItemContactUrlExpirationTimestampList3:e[93],listItemContactUrlFallbackList3:e[94],listItemAccessibilityText3:e[95],listItemTotalCount3:e[96],isBorderless:e[100],headerImageUrlMimeType:e[101],headerTitle:e[102],headerSubtitleText:e[103],headerImageUrl:e[104],headerImageUrlFallback:e[105],headerImageUrlExpirationTimestampMs:e[106],previewImageDecorationType:e[107],shouldHighlightHeaderTitleInTitle:e[108],targetId:e[109],attachmentLoggingType:e[112],previewUrlLarge:e[114],bodyText:e[115],gatingType:e[116],gatingTitle:e[117],targetExpiryTimestampMs:e[118],countdownTimestampMs:e[119],shouldBlurSubattachments:e[120],verifiedType:e[121],captionBodyText:e[122],isPublicXma:e[123],replyCount:e[124],playableAudioUrl:e[125],xmaDataclass:e[126],previewOverlayCountdownExpiry:e[127],stickerType:e[128],loggingGenericXmaContentType:e[129],loggingGenericXmaContentIdV2:e[130],authorityLevel:e[131]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxInsertXmaAttachmentStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);
__d("LSIssueInsertPersistentMenuCtasForThreadTask",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=new t.Map,r[0].set("thread_key",e[0]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),"insert_persistent_menu_ctas",t.i64.cast([0,54]),r[1],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return t.resolve(o)}])}e.__sproc_name__="LSComposerMenusIssueInsertPersistentMenuCtasForThreadTaskStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSSetBotResponseInfo",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[0]=void 0:(t=o.item,r[0]=t.metadataDataclass)})},function(o){return r[0]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[0]).then(function(e){var t;return t=e,r[2]=t[0],t})},function(e){return r[3]=new t.Map,r[4]=r[2].keys(),r[5]=t.i64.of_int32(r[4].length),t.i64.gt(r[5],t.i64.cast([0,0]))?t.loopAsync(r[5],function(e){return r[6]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[4],r[6]).then(function(e){var t;return t=e,r[7]=t[0],r[8]=t[1],t})},function(e){return r[9]=r[2].get(r[7]),r[3].set(r[7],r[9])}])}):t.resolve()},function(o){return e[3]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),e[3]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[7]=new t.Map,r[8]=r[6].keys(),r[9]=t.i64.of_int32(r[8].length),t.i64.gt(r[9],t.i64.cast([0,0]))?t.loopAsync(r[9],function(e){return r[14]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[8],r[14]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(e){return r[17]=r[6].get(r[15]),r[7].set(r[15],r[17])}])}):t.resolve()},function(e){return r[10]=r[7].get("ai_bot"),r[10]?r[11]=!1:r[11]=!0,r[11]?t.resolve(r[12]=void 0):t.sequence([function(e){return r[14]=new t.Map,r[15]=r[10].keys(),r[16]=t.i64.of_int32(r[15].length),t.i64.gt(r[16],t.i64.cast([0,0]))?t.loopAsync(r[16],function(e){return r[17]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[15],r[17]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(e){return r[20]=r[10].get(r[18]),r[14].set(r[18],r[20])}])}):t.resolve()},function(e){return r[12]=r[14]}])},function(n){return r[3].set("ai_bot",r[12]),r[13]=t.toJSON(r[3]),t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(t){var n=t.update,o=t.item;return n({botResponseId:e[2],metadataDataclass:r[13]})})}]):t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(t){var n=t.update,r=t.item;return n({botResponseId:e[2]})})}]):t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(t){var n=t.update,r=t.item;return n({botResponseId:e[2],metadataDataclass:e[3]})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxSetBotResponseInfoStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSSetMessageTextHasLinks",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(12).fetch([[[e[0],e[2],e[1]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.timestampMs,e[2])&&n.messageId===e[1]}),function(t){var n=t.update,r=t.item;return n({textHasLinks:e[3]==null?!0:e[3]})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxSetMessageTextHasLinksStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSUpdateAttachmentCtaAtIndexIgnoringAuthority",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.i64.eq(e[6],t.i64.cast([0,0]))?t.forEach(t.db.table(16).fetch([[[e[0],e[1],e[2]]]]),function(t){var n=t.update,r=t.item;return n({defaultCtaId:e[3],defaultCtaTitle:e[4],defaultCtaType:e[5]})}):t.i64.eq(e[6],t.i64.cast([0,1]))?t.forEach(t.db.table(16).fetch([[[e[0],e[1],e[2]]]]),function(t){var n=t.update,r=t.item;return n({attachmentCta1Id:e[3],cta1Title:e[4],cta1Type:e[5],cta1IconType:void 0})}):t.i64.eq(e[6],t.i64.cast([0,2]))?t.forEach(t.db.table(16).fetch([[[e[0],e[1],e[2]]]]),function(t){var n=t.update,r=t.item;return n({attachmentCta2Id:e[3],cta2Title:e[4],cta2Type:e[5],cta2IconType:void 0})}):t.i64.eq(e[6],t.i64.cast([0,3]))?t.forEach(t.db.table(16).fetch([[[e[0],e[1],e[2]]]]),function(t){var n=t.update,r=t.item;return n({attachmentCta3Id:e[3],cta3Title:e[4],cta3Type:e[5],cta3IconType:void 0})}):t.resolve((function(e){t.logger(e).warn(e)})("Unexpected CTA index"))},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateAttachmentCtaAtIndexIgnoringAuthorityStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);
__d("LSUpdateExtraAttachmentColumns",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[0],e[2],e[3]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.eq(t.i64.cast([0,0]),e[1])&&n.messageId===e[2]&&n.attachmentFbid===e[3]}),function(t){var n=t.update,r=t.item;return n({listItemAccessibilityText1:e[4],listItemAccessibilityText2:e[5],listItemAccessibilityText3:e[6],subtitleIconUrl:e[17],attachmentLoggingType:e[18],preheaderText:e[19],shouldAutoplayVideo:e[20],previewUrlLarge:e[21],previewWidthLarge:e[24],previewHeightLarge:e[25],avatarViewUrlList:e[10],avatarViewUrlExpirationTimestampList:e[11],avatarViewUrlFallbackList:e[12],avatarViewTitleList:e[13],avatarViewSize:e[14],avatarCount:e[15],avatarViewContextText:e[16]})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateExtraAttachmentColumnsStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);
__d("LSVerifyCustomCommandsExist",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.db.table(296).fetch([[[e[0]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?(r[1]=new t.Map,r[1].set("thread_key",e[0]),r[2]=t.toJSON(r[1]),t.storedProcedure(n("LSIssueNewTask"),"fetch_custom_thread_commands",t.i64.cast([0,767]),r[2],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))):(a=l.item,0)})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSOmnistoreSettingsVerifyCustomCommandsExistStoredProcedure",e.__tables__=["custom_thread_commands"],a.exports=e}),null);