;/*FB_PKG_DELIM*/

__d("MAWEncryptedBackupsUpdateGlobalRestoreStatus",["WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Set,u=new Set;function c(e){return e==="restore"?s:u}function d(e,t){var n=c(t);n.add(e)}function m(t,n){var r=c(n);r.has(t)?r.delete(t):o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with thread id "," is not currently being tracked, but restore seems to be in progress"])),t)}function p(e){var t=c(e);return t.size}l.addThreadIdToStatusArray=d,l.removeThreadIdFromStatusArray=m,l.getCurrentGlobalRestoreStatusArrayLength=p}),98);
__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["EBLogger","ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWJobManager","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","ReQL","WAJobOrchestratorTypes","WATagsLogger","cr:4992","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;async function f(e,t){try{var n=await o("MAWChatJid").toThreadKeyMaybeForChatJidInteger(e,(p||(p=o("I64"))).of_string(t));if(n!=null){var r=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.messages_ranges_v2__generated).getKeyRange(n));if(r!=null)return r.minMessageId}}catch(e){return Promise.reject(e)}}function g(e,t,n){if(t===0)return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.mi_act_mapping_table)).then(function(e){e.forEach(function(e){var t=o("MAWJobDefinitions").toThreadJidPrimaryId((p||(p=o("I64"))).to_string(e.jid));o("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(t,"restore"),n&&o("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(t,"ebprefetch")})})}async function h(t,a,i,l,m,h,C,b,v,S,R,L,E,k,I){k===void 0&&(k=o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION),o("WATagsLogger").TAGS(["labyrinth_web","eb_restore",S!=null?S:""]).LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""])),S!=null?S:"",i,R,l.length);var T=await o("MAWChatJid").toThreadKeyMaybeForChatJidInteger(t,(p||(p=o("I64"))).of_string(i));T==null&&o("EBLogger").EBLogger().MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"])),i);var D=!o("MAWOfflineQueueStatus").isOfflineQueueComplete()&&n("cr:4992")!=null&&R==null&&i!=null,x=o("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");await g(t,x,D);try{var $=await f(t,i);if(D&&n("cr:4992")!=null){o("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",S!=null?S:""]).LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""])),i),o("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(L,S);var P={action:o("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:i};await o("MAWBridgeUpdateClientRestoreStatus").call(t,P),await n("cr:4992")(t,a,i,l,m,h,C,b,v,S,R,$,L,E,k)}else return o("WATagsLogger").TAGS(["labyrinth_web","eb_restore",S!=null?S:""]).LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""])),i,R,l.length),y(a,i,l,$,m,C,v,S,R,L,E,k).then(function(){S!=null&&o("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:S})})}catch(e){return o("WATagsLogger").TAGS(["labyrinth_web","eb_restore",S!=null?S:""]).ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to restore messages for thread "," with error: ",""])),i,e),S!=null?o("MAWBridgeTraceRecordCheckpointHandler").call(t,{checkPointId:(_||(_=o("LSIntEnum"))).ofNumber(r("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:S,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return Promise.reject(e)}):Promise.reject(e)}}function y(e,t,n,a,i,l,s,u,c,d,p,_){var f=(m||(m=r("ExecutionEnvironment"))).isInWorker?o("MAWJobManager").getJobManager():o("MAWTimedJob").TimedUIJobStarters;return u!=null&&d===r("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION?f.waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(e,t,n,i,l,s,a!=null?a:void 0,u!=null?u:void 0,c!=null?c:void 0,void 0,void 0,d,{priority:_},p)).then(function(e){if(e.success===!0)o("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(u);else{var t;o("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(u,(t=e.payload)!=null?t:r("err")(e.error))}}):d===r("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?f.waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(e,t,n,i,l,s,a!=null?a:void 0,u!=null?u:void 0,c!=null?c:void 0,void 0,void 0,d,{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)).then(function(){return Promise.resolve()}):Promise.resolve(f.fireAndForget(o("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(e,t,n,i,l,s,a!=null?a:void 0,u!=null?u:void 0,c!=null?c:void 0,void 0,void 0,d,{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)))}l.call=h}),98);
__d("MWChatEncryptedBackupsAddonIcon.react",["MWAddOnCircleContainer.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(3),n=e.ariaHidden,a=e.icon,i;return t[0]!==n||t[1]!==a?(i=s.jsx(r("MWAddOnCircleContainer.react"),{ariaHidden:n,size:36,children:a}),t[0]=n,t[1]=a,t[2]=i):i=t[2],i}l.default=u}),98);