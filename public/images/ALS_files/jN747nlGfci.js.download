;/*FB_PKG_DELIM*/

__d("StoriesCometCardStatusSubscription_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="9611477815632391"}),null);
__d("StoriesCometCardStatusSubscription.graphql",["StoriesCometCardStatusSubscription_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"data",variableName:"input"}],r={alias:null,args:null,concreteType:"StoryCardStoryInfo",kind:"LinkedField",name:"story_card_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"thread_status",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"StoriesCometCardStatusSubscription",selections:[{alias:null,args:t,concreteType:"StoryCardStatusSubscribeResponsePayload",kind:"LinkedField",name:"story_card_status_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:[r],storageKey:null}],storageKey:null}],type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"StoriesCometCardStatusSubscription",selections:[{alias:null,args:t,concreteType:"StoryCardStatusSubscribeResponsePayload",kind:"LinkedField",name:"story_card_status_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("StoriesCometCardStatusSubscription_facebookRelayOperation"),metadata:{subscriptionName:"story_card_status_subscribe"},name:"StoriesCometCardStatusSubscription",operationKind:"subscription",text:null}}})();a.exports=e}),null);
__d("StoriesCometCardStatusSubscription",["CometRelay","StoriesCometCardStatusSubscription.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("StoriesCometCardStatusSubscription.graphql");function u(e,t,n){var r={input:t};return o("CometRelay").requestSubscription(e,{onNext:n,subscription:s,variables:r})}l.subscribe=u}),98);
__d("StoriesCreateAltTextTransformer",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){var r,o,a=e.altTextData,i=(a==null?void 0:a.selection)==="CUSTOM"&&(a==null?void 0:a.customText)!=null&&a.customText.trim()!=="",l=t==null||(r=t.attachments)==null?void 0:r[0];if(!l||!i){n(t);return}var s;if(l.photo){var u;s=babelHelpers.extends({},l,{photo:babelHelpers.extends({},l.photo,{custom_accessibility_caption:a==null?void 0:a.customText,id:((u=l.photo)==null?void 0:u.id)||""})})}else s=l;var c=babelHelpers.extends({},t,{attachments:[s].concat(((o=t.attachments)==null?void 0:o.slice(1))||[])});n(c)}i.default=e}),66);
__d("StoriesCreatePhotoUploadUtils",["FBLogger","MediaUploadFailureFalcoEvent","QPLUserFlow","QuickPerformanceLogger","StoriesUtils","blueimp-canvas-to-blob","cometComposerMediaUploadLogger","cometUniqueID","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;n("blueimp-canvas-to-blob");function s(e,t,n,r){var o;if(!(t==null||r===(n==null||(o=n.uploadingInfo)==null?void 0:o.photoDescriptorID))){var a=t.bottomColor,i=t.topColor,l=e.getContext("2d");l.save();var s=l.createLinearGradient(0,0,e.width,e.height);i!=null&&s.addColorStop(0,i),a!=null&&s.addColorStop(1,a),l.fillStyle=s,l.fillRect(0,0,e.width,e.height),l.restore()}}function u(e,t,n,o){var a=new Image,i=e.width,l=e.height;a.crossOrigin="Anonymous",a.onerror=function(){var e="Failed to load image: "+t;r("FBLogger")("fbstories").warn(e),o(e)},a.onload=function(){var t=e.getContext("2d");t.save(),t.drawImage(a,0,0,i,l),t.restore(),n()},a.src=t}function c(e,t,n,o,a){var i;if(n===((i=t.uploadingInfo)==null?void 0:i.photoDescriptorID)){o();return}var l=t.displayedURI;if(l==null){o();return}var s=t.bounds,u=t.rotation,c=e.width,d=e.height,m=u%180!==0?[d,c]:[c,d],p=m[0],_=m[1],f=new Image;f.crossOrigin="Anonymous",f.onerror=function(){var e="Failed to load image: "+l;r("FBLogger")("fbstories").warn(e),a(e)},f.onload=function(){var t=e.getContext("2d"),n=s.x*p,r=s.y*_,a=s.width*p,i=s.height*_;t.save(),t.translate(c/2,d/2),t.rotate(u*Math.PI/180),t.translate(-p/2,-_/2),t.drawImage(f,0,0,f.width,f.height,n,r,a,i),t.restore(),o()},f.src=l}function d(e,t,n,r){return[e==null?void 0:e.bottomColor,e==null?void 0:e.topColor,t==null?void 0:t.rotation,t==null?void 0:t.offset.dx,t==null?void 0:t.offset.dy,t==null?void 0:t.scale,n,r].join()}function m(e){return e<1e5?"extra-small":e<3e5?"small":e<5e5?"medium":e<75e4?"large":"extra-large"}function p(t,n,a,i,l,s,u,c){var d,p=function(t,o){var e=function(){n.successObserver.unsubscribe(i),n.errorObserver.unsubscribe(l)},i=function(i){i.uploadID===t&&(o&&r("cometComposerMediaUploadLogger")({fields:{media_id:i.entID,media_type:"PHOTO"},type:"MEDIA_UPLOAD_SUCCESS"},a),e(),u(i.entID))},l=function(i){i.uploadID===t&&(o&&(r("FBLogger")("fbstories").warn("Photo upload failed: %s",i.error!=null?i.error.toString():""),r("MediaUploadFailureFalcoEvent").log(function(){var e;return{creation_session_id:a,error_info:(e=i.error)==null?void 0:e.toString()}})),e(),c(i.error))};n.successObserver.subscribe(i),n.errorObserver.subscribe(l)},_=(d=i.uploadingInfo)==null?void 0:d.photoDescriptorID;if(_!=null&&l===_){var f=i.uploadingInfo;if(f!=null){if(f.entID!=null)return u(f.entID),f.uploadID;var g=f.uploadID;if(g!=null)return p(g,!1),g}}var h=r("cometUniqueID")(),y=o("StoriesUtils").getBlobImageParams(),C=y.format,b=y.quality;return t.toBlob(function(t){s!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(s,"blob created");var o=t;o.uploadID=h;var i=m(o.size);r("QPLUserFlow").addPoint(r("qpl")._(741087294,"2028"),"Blob created",i!=null?{data:{string:{fileSizeToLog:i}}}:void 0),p(h,!0),r("cometComposerMediaUploadLogger")({fields:{media_id:h,media_type:"PHOTO"},type:"MEDIA_UPLOAD_START"},a),n.upload([{extra:{fileType:"PHOTO"},file:o}])},C,b),h}l.drawBlurredBackgroundOnCanvas=s,l.drawSATPBackgroundOnCanvas=u,l.drawPhotoOnCanvas=c,l.generatePhotoDescriptorID=d,l.getFileSizeLogName=m,l.uploadPhoto=p}),98);
__d("StoriesCreateBlurredBgTransformer",["QuickPerformanceLogger","StoriesCreatePhotoUploadUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i=t.blurredBg,l=t.photoData;if(i==null||i.topColor==null||i.bottomColor==null){a(n);return}var s=n.canvas,u=n.photoDescriptorID,c=n.qplEvent;o("StoriesCreatePhotoUploadUtils").drawBlurredBackgroundOnCanvas(s,i,l,u),c!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(c,"blurred background drawn to canvas"),a(n)}l.default=s}),98);
__d("StoriesCreateCTALinkTransformer",["StoriesCreateMediaTypeEnum"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o,a,i,l;if(((o=e.formData)==null?void 0:o.mediaType)!==r("StoriesCreateMediaTypeEnum").PHOTO&&((a=e.formData)==null?void 0:a.mediaType)!==r("StoriesCreateMediaTypeEnum").VIDEO||((i=e.ctaLinkData)==null?void 0:i.ctaType)==null||((l=e.ctaLinkData)==null?void 0:l.link)==null){n(t);return}n(babelHelpers.extends({},t,{call_to_action_data:{is_cta_share_post:!0,link:e.ctaLinkData.link,page:e.ctaLinkData.page,type:e.ctaLinkData.ctaType}}))}l.default=e}),98);
__d("StoriesCreateGenAILabelTransformer",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){var r=e.genAISelfDisclosureData;n(babelHelpers.extends({},t,{ai_generated_self_disclosure_metadata:{was_self_disclosed_as_ai_generated:(r==null?void 0:r.isSelfDisclosedAsGenAI)===!0}}))}i.default=e}),66);
__d("StoriesCreateMusicStoryVideoGenTransformer",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){var r,o,a,i=t==null||(r=t.attachments)==null?void 0:r[0],l=(o=e.stickerData)==null?void 0:o.musicSticker;if((i==null?void 0:i.photo)==null||(l==null?void 0:l.song)==null){n(t);return}var s=l.startTime||0,u=l.song.id,c=i.photo.id,d={audio_asset_id:u,highlight_start_time_ms:s,photo_id:c},m=(a=i.photo)==null||(a=a.overlays)==null?void 0:a.filter(function(e){return e.music_sticker==null});n(babelHelpers.extends({},t,{attachments:[{video:{overlays:m,video_generation_params:{music_story:d}}}]}))}i.default=e}),66);
__d("StoriesCreateMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24226878183562473"}),null);
__d("StoriesCreateMutation.graphql",["StoriesCreateMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"data",variableName:"input"}],r={alias:null,args:null,kind:"ScalarField",name:"story_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"logging_token",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"StoriesCreateMutation",selections:[{alias:null,args:t,concreteType:"StoryCreateResponsePayload",kind:"LinkedField",name:"story_create",plural:!1,selections:[r,o,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,kind:"FragmentSpread",name:"useProfileCometStoryStatus_user"}],type:"User",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"StoriesCreateMutation",selections:[{alias:null,args:t,concreteType:"StoryCreateResponsePayload",kind:"LinkedField",name:"story_create",plural:!1,selections:[r,o,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:[{kind:"Literal",name:"first",value:1}],concreteType:"DirectInboxBroadcastBucketConnection",kind:"LinkedField",name:"story_bucket",plural:!1,selections:[{alias:null,args:null,concreteType:"DirectMessageThreadBucket",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"should_show_close_friend_badge",storageKey:null},i,{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"first_story_to_show",plural:!1,selections:[i,{alias:null,args:null,concreteType:"StoryCardSeenState",kind:"LinkedField",name:"story_card_seen_state",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_seen_by_viewer",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"story_overlays",plural:!0,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:"story_bucket(first:1)"}],type:"User",abstractKey:null},i],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("StoriesCreateMutation_facebookRelayOperation"),metadata:{},name:"StoriesCreateMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("StoriesCreateOverlayTransformer",["FBLogger","JSResourceForInteraction","QPLUserFlow","QuickPerformanceLogger","StoriesConstants","StoriesGating","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("JSResourceForInteraction")("html2canvas").__setRef("StoriesCreateOverlayTransformer"),u=4,c=290;function d(t,n,a){var i,l,d=((i=t.stickerData)==null||(i=i.channelSticker)==null?void 0:i.channelStickerMetaData)!=null;if((t.textOverlays==null||t.textOverlays.overlays.length===0)&&(t.stickerData==null||t.stickerData.stickers.length===0)&&!((l=t.stickerData)!=null&&(l=l.musicSticker)!=null&&l.song)&&!d){a(n);return}var m=d,p=n.clonedOverlayNode;if(p==null){r("FBLogger")("fbstories").warn("Overlay transformer missing cloned node"),a(n);return}var _=n.canvas,f=n.qplEvent,g=_.getContext("2d");r("promiseDone")(s.load(),function(t){f!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(f,"html2canvas module loaded");var i=document.body;if(i==null){r("FBLogger")("fbstories").warn("Overlay transformer missing document body"),a(n);return}i.appendChild(p),r("promiseDone")(t(p,{allowTaint:!1,backgroundColor:m?"null":"rgba(0,0,0,0)",height:m?o("StoriesConstants").DEFAULT_CANVAS_HEIGHT/u:p.offsetHeight,ignoreElements:function(t){var e;return t.id==="stories-emoji-button"?!0:t.contains(p)||((e=t.parentElement)==null?void 0:e.nodeName)==="HTML"||t===p||p.contains(t)||t instanceof HTMLStyleElement?!1:t instanceof HTMLLinkElement?t.as==="script"||t.getAttribute("data-preloader")!=null:!0},logging:o("StoriesGating").isEmployee(),onclone:function(t){if(d){Array.from(t.querySelectorAll("*")).forEach(function(e){var t=e.getAttribute("style")||"";e.setAttribute("style",t+"; font-family: Segoe UI, sans-serif !important")});var e=t.querySelectorAll('[id="channel-sticker"]')[0],n=e.getAttribute("style")||"",r=o("StoriesConstants").DEFAULT_CANVAS_HEIGHT/u,a=e.offsetHeight,i=(r-a)/2;e.setAttribute("style",n+("; width: "+c+"px; top: "+i+"px; left: 0%; margin-left: -8px; position: absolute; transform: scale(0.66);"))}},scale:u,useCORS:!0,width:m?o("StoriesConstants").DEFAULT_CANVAS_WIDTH/u:p.offsetWidth}).then(function(t){g.drawImage(t,0,0,_.width,_.height),p.remove(),r("QPLUserFlow").addPoint(r("qpl")._(741087294,"2028"),"Overlays added"),f!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(f,"overlays added"),a(n)}))})}l.default=d}),98);
__d("StoriesCreatePhotoTransformer",["QPLUserFlow","QuickPerformanceLogger","StoriesCreateMediaTypeEnum","StoriesCreatePhotoUploadUtils","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i,l=t.photoData;if(((i=t.formData)==null?void 0:i.mediaType)!==r("StoriesCreateMediaTypeEnum").PHOTO||l==null){a(n);return}var s=l.displayedURI;if(s==null){a(n);return}var u=n.canvas,c=n.photoDescriptorID,d=n.qplEvent;o("StoriesCreatePhotoUploadUtils").drawPhotoOnCanvas(u,l,c,function(){r("QPLUserFlow").addPoint(r("qpl")._(741087294,"2028"),"Photo drawn to canvas"),d!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(d,"photo drawn to canvas"),a(n)},function(e){r("QPLUserFlow").endFailure(r("qpl")._(741087294,"2028"),"Photo drawing failed"),n.onTransformError(e)})}l.default=s}),98);
__d("StoriesCreatePhotoUploadTransformer",["QPLUserFlow","QuickPerformanceLogger","StoriesCreateMediaTypeEnum","StoriesCreatePhotoUploadUtils","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i,l,s,u,c,d,m,p,_,f=t==null||(i=t.mediaAttachments)==null?void 0:i[0],g=t.photoData,h=n.audiences,y=n.canvas,C=n.photoDescriptorID,b=n.qplEvent,v=n.uploader,S=h==null||(l=h[0])==null||(l=l.stories)==null||(l=l.self)==null?void 0:l.target_id,R=((s=t.stickerData)==null||(s=s.channelSticker)==null?void 0:s.channelStickerMetaData)!=null,L=((u=t.formData)==null?void 0:u.mediaType)===r("StoriesCreateMediaTypeEnum").SATP&&((c=t.stickerData)==null?void 0:c.musicSticker)!=null;if(!L&&(f==null?void 0:f.fileType)!=="PHOTO"&&!R||S==null||g==null){a(n);return}var E=[];if(((d=t.stickerData)==null?void 0:d.productSticker)!=null){var k;E.push({product_sticker:(k=t.stickerData)==null?void 0:k.productSticker})}if(((m=t.stickerData)==null?void 0:m.channelSticker)!=null){var I;E.push({channel_sticker:(I=t.stickerData)==null?void 0:I.channelSticker.channelStickerMetaData})}if(((p=t.stickerData)==null?void 0:p.musicSticker)!=null){var T;E.push({music_sticker:(T=t.stickerData)==null?void 0:T.musicSticker.musicStickerMetaData})}if(((_=t.stickerData)==null?void 0:_.tagStickers)!=null)for(var D of(x=t.stickerData)==null?void 0:x.tagStickers){var x;E.push({tag_sticker:{bounds:D.bounds,creation_source:D.creation_source,tag_id:D.withTagID,type:D.type}})}o("StoriesCreatePhotoUploadUtils").uploadPhoto(y,v,t.composerSessionID,g,C,b,function(t){r("QPLUserFlow").addPoint(r("qpl")._(741087294,"2028"),"Photo uploaded"),b!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(b,"photo uploaded"),a(babelHelpers.extends({},n,{attachments:[{photo:{id:t,overlays:E}}]}))},function(e){r("QPLUserFlow").endFailure(r("qpl")._(741087294,"2028"),"Upload failed"),n.onTransformError(e)})}l.default=s}),98);
__d("StoriesCreateSATPBgPhotoTransformer",["QPLUserFlow","QuickPerformanceLogger","StoriesCreatePhotoUploadUtils","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i,l,s=t.satpData,u=((i=t.stickerData)==null||(i=i.channelSticker)==null?void 0:i.channelStickerMetaData)!=null,c=((l=t.stickerData)==null?void 0:l.musicSticker)!=null;if(!(u||c)||s==null){a(n);return}var d=s==null?void 0:s.background;if(d==null){a(n);return}var m=n.canvas,p=n.qplEvent,_=function(){r("QPLUserFlow").addPoint(r("qpl")._(741087294,"2028"),"Photo drawn to canvas"),p!=null&&(e||(e=r("QuickPerformanceLogger"))).markerPoint(p,"SATP background photo drawn to canvas"),a(n)},f=function(t){r("QPLUserFlow").endFailure(r("qpl")._(741087294,"2028"),"SATP background photo drawing failed"),n.onTransformError(t)};o("StoriesCreatePhotoUploadUtils").drawSATPBackgroundOnCanvas(m,d,_,f)}l.default=s}),98);
__d("StoriesCreateSATPCanvasUtils",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o=t.background;if(o!=null){var a=new Image;a.crossOrigin="Anonymous",a.onerror=function(){var e="Failed to load image: "+o;r("FBLogger")("fbstories").warn(e)},a.onload=function(){var t=e.getContext("2d");t.save(),t.drawImage(a,0,0,e.width,e.height),t.restore(),n()},a.src=o}}l.drawSATPBgOnCanvas=e}),98);
__d("StoriesCreateSATPBgTransformer",["FBLogger","StoriesCreateMediaTypeEnum","StoriesCreateSATPCanvasUtils","StoriesGating"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var a;if(((a=e.formData)==null?void 0:a.mediaType)!==r("StoriesCreateMediaTypeEnum").SATP||!o("StoriesGating").shouldEnableOptimisticImprovements()){n(t);return}var i=t.canvas,l=e==null?void 0:e.satpData;if(l==null)throw r("FBLogger")("fb_stories_web").mustfixThrow("Stories Create mutation SATP Data should not be null/undefined");o("StoriesCreateSATPCanvasUtils").drawSATPBgOnCanvas(i,l,function(){n(t)})}l.default=e}),98);
__d("StoriesLexicalMentionNode",["CometLexicalGenericEntityNode","stylex"],(function(t,n,r,o,a,i,l){"use strict";var e,s={root:{cursor:"xt0e3qv",textDecoration:"x1bvjpef",$$css:!0}},u=(function(t){function n(){return t.apply(this,arguments)||this}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.createDOM=function(o){var n=t.prototype.createDOM.call(this,o);return n.className=(e||(e=r("stylex")))([s.root]),n.spellcheck=!1,n},n.clone=function(t){var e;return new n({id:t.__id,text:t.__text,type:t.__entityType,uri:(e=t.__uri)!=null?e:void 0},t.__key)},n.getType=function(){return"stories-mention"},n.importJSON=function(t){var e;return c({id:t.id,text:t.text,type:t.entityType,uri:(e=t.uri)!=null?e:void 0})},n})(o("CometLexicalGenericEntityNode").CometLexicalGenericEntityNode);function c(e){return new u(e).setMode("segmented").toggleDirectionless()}function d(e){return e instanceof u}l.StoriesLexicalMentionNode=u,l.$createStoriesLexicalMentionNode=c,l.$isStoriesLexicalMentionNode=d}),98);
__d("calculateMentionStickerBounds",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r){var o=(t.left+t.right)/2,a=(t.top+t.bottom)/2,i=n%90*Math.PI/180,l=Math.floor(n/90)%2===1,s=r,u=l?t.height:t.width,c=l?t.width:t.height,d=1e-5,m=(u-s*Math.sin(i))/Math.max(Math.cos(i),d),p=(c-s*Math.cos(i))/Math.max(Math.sin(i),d),_=Math.min(m,p),f=o-_/2,g=a-s/2;return{height:s/e.height,rotation:n,width:_/e.width,x:(f-e.left)/e.width,y:(g-e.top)/e.height}}i.default=e}),66);
__d("createRectsFromDOMRangeWithOverlap",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=e.getRootElement();if(n===null)return[];var r=n.getBoundingClientRect(),o=getComputedStyle(n),a=parseFloat(o.paddingLeft)+parseFloat(o.paddingRight),i=Array.from(t.getClientRects()),l=i.length;i.sort(function(e,t){var n=e.top-t.top;return Math.abs(n)<=3?e.left-t.left:n});for(var s,u=0;u<l;u++){var c=i[u],d=c.width+a===r.width;if(d){s=c,i.splice(u--,1),l--;continue}}return i.length===0&&s!=null&&i.push(s),i}i.default=e}),66);
__d("StoriesCreateSATPTextTransformer",["FBLogger","Lexical","LexicalSelection","StoriesComposerUtils","StoriesCreateMediaTypeEnum","StoriesLexicalMentionNode","calculateMentionStickerBounds","createRectsFromDOMRangeWithOverlap","extractMessageFromPlainText"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var a,i,l,s,u,c;if(((a=e.formData)==null?void 0:a.mediaType)!==r("StoriesCreateMediaTypeEnum").SATP)return n(t);var d=e.lexicalEditor;if(d==null)return r("FBLogger")("fb_stories_web").mustfix("Stories Create missing lexical editor during submission"),n(t);var m=t==null||(i=t.attachments)==null?void 0:i.find(function(e){return(e==null?void 0:e.video)!=null});if(!m){var p=d.getEditorState().read(function(){return r("extractMessageFromPlainText")()});return n(babelHelpers.extends({},t,{message:p}))}var _=(l=e.overlayRef)==null?void 0:l.current,f=[];(s=e.lexicalEditor)==null||s.getEditorState().read(function(){o("Lexical").$nodesOfType(o("StoriesLexicalMentionNode").StoriesLexicalMentionNode).forEach(function(e){if(e!=null){var t=o("LexicalSelection").createDOMRange(d,e,0,e,e.getTextContent().length);if(t!=null){var n=r("createRectsFromDOMRangeWithOverlap")(d,t);if(_!=null&&n!=null)for(var a of n)f.push({tag_sticker:{bounds:r("calculateMentionStickerBounds")(_.getBoundingClientRect(),a,0,o("StoriesComposerUtils").FONT_SIZE),creation_source:"TEXT_TOOL_MENTION",tag_id:e.getID(),type:"PEOPLE"}})}}})});var g=t.attachments!=null&&t.attachments.length>0?(u=t.attachments[0])==null?void 0:u.video:null;return g==null?(r("FBLogger")("fb_stories_web").mustfix("Stories Create missing video data for burned story during submission"),n(t)):n(babelHelpers.extends({},t,{attachments:[{video:babelHelpers.extends({},g,{overlays:[].concat((c=g.overlays)!=null?c:[],f)})}]}))}l.default=e}),98);
__d("StoriesCreateSATPToPhotoStoryTransformer",["StoriesCreateMediaTypeEnum"],(function(t,n,r,o,a,i,l){"use strict";var e=["message","text_format_metadata","text_format_preset_id"];function s(t,n,o){var a,i;if(((a=t.formData)==null?void 0:a.mediaType)!==r("StoriesCreateMediaTypeEnum").SATP){o(n);return}var l=(i=t.stickerData)==null?void 0:i.musicSticker;if(l==null){o(n);return}var s=n.message,u=n.text_format_metadata,c=n.text_format_preset_id,d=babelHelpers.objectWithoutPropertiesLoose(n,e);o(d)}l.default=s}),98);
__d("StoriesCreateSATPTransformer",["FBLogger","StoriesCreateMediaTypeEnum"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o;if(((o=e.formData)==null?void 0:o.mediaType)!==r("StoriesCreateMediaTypeEnum").SATP){n(t);return}var a=e==null?void 0:e.satpData;if(a==null)throw r("FBLogger")("fb_stories_web").mustfixThrow("Stories Create mutation SATP Data should not be null/undefined");n(babelHelpers.extends({},t,{message:{ranges:[],text:a.text},text_format_metadata:{inspirations_custom_font_id:a.fontID},text_format_preset_id:a.presetID}))}l.default=e}),98);
__d("StoriesCreateVideoUtils",["generateVideoThumbnails","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o=document.createElement("video"),a=e.width,i=e.height;o.style.display="none",o.preload="auto",o.src=t;var l=function(){var t=r("generateVideoThumbnails")(o,a,i,1,"cover");r("promiseDone")(t,function(t){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){var t=e.getContext("2d");t.save(),t.drawImage(r,0,0,a,i),t.restore(),n()},r.src=t.selectedThumbnail.getURL()})};o.addEventListener("loadeddata",l),o.load()}l.drawVideoThumbnailOnCanvas=e}),98);
__d("StoriesCreateVideoThumbnailTransformer",["StoriesCreateMediaTypeEnum","StoriesCreateVideoUtils","StoriesGating"],(function(t,n,r,o,a,i,l){"use strict";var e=o("StoriesGating").isCometStoriesVideoProductionEnabled();function s(t,n,a){var i,l,s=t==null||(i=t.mediaAttachments)==null?void 0:i[0];if(!e||((l=t.formData)==null?void 0:l.mediaType)!==r("StoriesCreateMediaTypeEnum").VIDEO||(s==null?void 0:s.fileType)!=="VIDEO"||(s==null?void 0:s.file)==null){a(n);return}var u=s==null?void 0:s.fileObjectURL;if(u==null){a(n);return}var c=n.canvas;o("StoriesCreateVideoUtils").drawVideoThumbnailOnCanvas(c,u,function(){a(n)})}l.default=s}),98);
__d("StoriesCreateVideoTransformer",["cometUniqueID"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o,a,i,l,s,u,c,d=e==null||(o=e.mediaAttachments)==null?void 0:o[0];if((d==null?void 0:d.fileType)!=="VIDEO"||(d==null?void 0:d.file)==null){n(t);return}var m=t.uploader,p=d==null?void 0:d.file;p.uploadID=r("cometUniqueID")();var _=(a=(i=e.videoData)==null?void 0:i.currentDuration)!=null?a:0,f=(l=(s=e.videoData)==null?void 0:s.initialDuration)!=null?l:0,g=(u=(c=e.videoData)==null?void 0:c.startTime)!=null?u:0,h=null;_!==f&&(h={videoTrimEnd:g+_,videoTrimStart:g}),m.successObserver.subscribe(function(e){e.uploadID===p.uploadID&&n(babelHelpers.extends({},t,{attachments:[{video:{id:e.entID}}]}))}),m.errorObserver.subscribe(function(e){n(t)}),m.upload([{extra:{fileType:d.fileType,trimData:h},file:p}])}l.default=e}),98);
__d("reduceStoriesCreateViewStateToCreationData",["gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=["canvas","clonedOverlayNode","onTransformError","photoDescriptorID","qplEvent","uploader"];function s(e){var t=window.open("about:blank","image from canvas");t!=null&&t.document.write("<img src='"+e+"' alt='from canvas'/>")}function u(t,n,r,o){function a(r,i){var l=n[i];if(l!=null){var s=function(t){a(t,i+1)};l(t,r,s)}else{var u=r.canvas,c=r.clonedOverlayNode,d=r.onTransformError,m=r.photoDescriptorID,p=r.qplEvent,_=r.uploader,f=babelHelpers.objectWithoutPropertiesLoose(r,e);o(f,u)}}a(r,0)}l.default=u}),98);
__d("storiesUploadUpdater",["CometRelay","StoriesGating","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=r("uuidv4")(),a=e.create("client:newNode:"+n,"Story"),i=e.create(r("uuidv4")(),"StoryCardStoryInfo");if(t!=null&&o("StoriesGating").shouldEnableOptimisticImprovements()){var l=e.create(r("uuidv4")(),"Image");l.setValue(t,"uri"),i.setLinkedRecord(l,"story_thumbnail")}return i.setValue("PENDING","thread_status"),a.setValue(n,"id"),a.setLinkedRecord(i,"story_card_info"),a}function s(t,n){var a=t.create("client:newNode:"+r("uuidv4")(),"UnifiedStoryBucketToUnifiedStoriesConnection"),i=e(t,n),l=o("CometRelay").ConnectionHandler.createEdge(t,a,i,"UnifiedStoryBucketToUnifiedStoriesEdge");return o("CometRelay").ConnectionHandler.insertEdgeBefore(a,l),a}function u(e,t,n){var o=r("uuidv4")(),a=e.create("client:newNode:"+o,"StoryBucket");a.setLinkedRecord(t,"story_bucket_owner");var i=s(e,n);return a.setLinkedRecord(i,"unified_stories"),a.setValue(o,"id"),a}function c(e,t,n){var r=e.get(t);if(r){var a=r.getOrCreateLinkedRecord("unified_stories_buckets","UserToUnifiedStoryBucketsConnection",{find:"loading",first:1});if(a){var i=u(e,r,n),l=o("CometRelay").ConnectionHandler.createEdge(e,a,i,"UserToUnifiedStoryBucketsEdge");l&&o("CometRelay").ConnectionHandler.insertEdgeAfter(a,l)}}}l.default=c}),98);
__d("StoriesCreateMutation",["CometRelay","QPLUserFlow","QuickPerformanceLogger","StoriesCometCardStatusSubscription","StoriesConstants","StoriesCreateAltTextTransformer","StoriesCreateBlurredBgTransformer","StoriesCreateCTALinkTransformer","StoriesCreateGenAILabelTransformer","StoriesCreateMediaTypeEnum","StoriesCreateMusicStoryVideoGenTransformer","StoriesCreateMutation.graphql","StoriesCreateOverlayTransformer","StoriesCreatePhotoTransformer","StoriesCreatePhotoUploadTransformer","StoriesCreatePhotoUploadUtils","StoriesCreateSATPBgPhotoTransformer","StoriesCreateSATPBgTransformer","StoriesCreateSATPTextTransformer","StoriesCreateSATPToPhotoStoryTransformer","StoriesCreateSATPTransformer","StoriesCreateVideoThumbnailTransformer","StoriesCreateVideoTransformer","StoriesGating","TCometComposerTarget","WebStorage","cometComposerLogger","getComposerLoggingPayload","gkx","qpl","reduceStoriesCreateViewStateToCreationData","storiesUploadUpdater"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=[r("StoriesCreateSATPTransformer"),r("StoriesCreateSATPBgTransformer"),r("StoriesCreateBlurredBgTransformer"),r("StoriesCreateSATPBgPhotoTransformer")].concat(r("gkx")("9476")?[r("StoriesCreateSATPToPhotoStoryTransformer")]:[],[r("StoriesCreateVideoThumbnailTransformer"),r("StoriesCreatePhotoTransformer"),r("StoriesCreateOverlayTransformer"),r("StoriesCreateVideoTransformer"),r("StoriesCreateCTALinkTransformer")],r("gkx")("4703")?[r("StoriesCreateGenAILabelTransformer")]:[],[r("StoriesCreatePhotoUploadTransformer")],o("StoriesGating").shouldEnableAltTextInPhotoStories()?[r("StoriesCreateAltTextTransformer")]:[],r("gkx")("9476")?[r("StoriesCreateMusicStoryVideoGenTransformer")]:[],[r("StoriesCreateSATPTextTransformer")]),d=e!==void 0?e:e=n("StoriesCreateMutation.graphql"),m=o("StoriesGating").isCometStoriesVideoProductionEnabled();function p(e,t,n,a,i,l,p,f,g,h){var y,C,b,v,S;r("QPLUserFlow").start(r("qpl")._(741087294,"2028"));var R=((y=e.stickerData)==null||(y=y.channelSticker)==null?void 0:y.channelStickerMetaData)!=null,L=o("getComposerLoggingPayload").getStoriesComposerLoggingPayload(e),E={target:{id:t,type:o("TCometComposerTarget").getComposerTargetType("feed")}},k={composerEntryPointName:"channel_sticker_share",composerSourceSurface:"channel_sticker"};r("cometComposerLogger")({fields:babelHelpers.extends({},R?k:null,{composerType:"stories",isMyStorySelected:!0,payload:L}),type:"COMPOSER_POST"},e.composerSessionID,E);var I=document.createElement("canvas"),T=null,D=o("StoriesCometCardStatusSubscription").subscribe(n,{send_key:e.composerSessionID},function(t){var n,o=t==null||(n=t.story_card_status_subscribe)==null||(n=n.story)==null||(n=n.story_card_info)==null?void 0:n.thread_status;(o==="PUBLISHED"||o==="FAILED")&&(o==="PUBLISHED"?(r("cometComposerLogger")({fields:{destination:"stories"},type:"COMPOSER_POST_SERVER_CONTENT_RENDERED"},e.composerSessionID),l!=null&&(s||(s=r("QuickPerformanceLogger"))).markerEnd(l,2)):l!=null&&(s||(s=r("QuickPerformanceLogger"))).markerEnd(l,3),T&&T.dispose(),D.dispose())}),x=function(t){var e=new Error;t!=null&&(e.description=t.toString()),l!=null&&(s||(s=r("QuickPerformanceLogger"))).markerEnd(l,3),p(e),T&&T.dispose(),D.dispose()},$={audiences:[{stories:{self:{target_id:t}}}],source:"WWW"},P=o("StoriesGating").shouldEnableOptimisticImprovements();P||(T=_(n,$,t)),I.height=o("StoriesConstants").DEFAULT_CANVAS_HEIGHT,I.width=o("StoriesConstants").DEFAULT_CANVAS_WIDTH;var N=o("StoriesCreatePhotoUploadUtils").generatePhotoDescriptorID(e.blurredBg,e.photoData,(C=(b=e.textOverlays)==null?void 0:b.overlays.length)!=null?C:0,(v=(S=e.stickerData)==null?void 0:S.stickers.length)!=null?v:0);r("reduceStoriesCreateViewStateToCreationData")(e,c,{audiences:[{stories:{self:{target_id:t}}}],audiences_is_complete:!0,canvas:I,clonedOverlayNode:i,logging:{composer_session_id:e.composerSessionID},navigation_data:h!=null?{attribution_id_v2:h}:null,onTransformError:x,photoDescriptorID:N,qplEvent:l,source:"WWW",uploader:a},function(a,i){var c;if(P&&(T=_(n,$,t,i.toDataURL())),a.tracking=a.tracking?a.tracking.concat(g):[g],r("cometComposerLogger")({fields:{destination:"stories"},type:"COMPOSER_POST_MUTATION_START"},e.composerSessionID),l!=null&&(s||(s=r("QuickPerformanceLogger"))).markerPoint(l,"mutation started"),m&&((c=e.formData)==null?void 0:c.mediaType)===r("StoriesCreateMediaTypeEnum").VIDEO&&i!=null){var h,y,C=(h=a.attachments)==null||(h=h[0])==null||(h=h.video)==null?void 0:h.id,b=(u||(u=r("WebStorage"))).getSessionStorage(),v=JSON.parse((y=b==null?void 0:b.getItem(o("StoriesConstants").CACHED_STORY_THUMBNAIL_URI_SESSION_STORAGE_KEY))!=null?y:"{}");if(C!=null){var S,R=babelHelpers.extends({},v,(S={},S[C]=i.toDataURL(),S));b==null||b.setItem(o("StoriesConstants").CACHED_STORY_THUMBNAIL_URI_SESSION_STORAGE_KEY,JSON.stringify(R))}}r("QPLUserFlow").addPoint(r("qpl")._(741087294,"2028"),"Mutation started"),o("CometRelay").commitMutation(n,{mutation:d,onCompleted:function(n){var t;l!=null&&(s||(s=r("QuickPerformanceLogger"))).markerPoint(l,"mutation successful"),r("cometComposerLogger")({fields:{composerType:"stories",loggingIds:(t=n.story_create)==null?void 0:t.logging_token},type:"COMPOSER_POST_SUCCESS"},e.composerSessionID),T&&T.dispose(),r("QPLUserFlow").endSuccess(r("qpl")._(741087294,"2028")),f()},onError:function(n){var t;l!=null&&(s||(s=r("QuickPerformanceLogger"))).markerPoint(l,"mutation failed"),r("cometComposerLogger")({fields:{composerType:"stories",errorDescription:typeof n.description=="string"?n.description:(t=n.description)==null?void 0:t.toString(),errorInfo:n.message},type:"COMPOSER_POST_FAILURE"},e.composerSessionID),T&&T.dispose(),D&&D.dispose(),r("QPLUserFlow").endFailure(r("qpl")._(741087294,"2028"),"Mutation failed"),p(n)},variables:{input:babelHelpers.extends({},a)}})})}function _(e,t,n,a){var i=o("CometRelay").applyOptimisticMutation(e,{mutation:d,optimisticUpdater:function(t){r("storiesUploadUpdater")(t,n,a)},variables:{input:babelHelpers.extends({},t)}});return{dispose:function(){i&&i.dispose(),i=null}}}l.createStories=p}),98);