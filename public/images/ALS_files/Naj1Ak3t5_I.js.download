;/*FB_PKG_DELIM*/

__d("LSGetParentThreadKey",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[0]=t.i64.cast([0,0]):(r=a.item,n[0]=r.parentThreadKey)})},function(e){return r[0]=n[0]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxGetParentThreadKeyStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSUpdateFolderThreadSnippet",["LSArrayGetObjectAt","LSGetThreadParticipantDisplayName","LSGetViewerFBID","LSLocalize"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?0:(a=l.item,t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([-1,4294967284])),t.sequence([function(o){return t.i64.eq(a.threadType,t.i64.cast([0,17]))?t.sequence([function(n){return t.i64.eq(e[0],t.i64.cast([-1,4294967284])),t.sequence([function(n){return t.i64.neq(e[1],void 0)?t.resolve(r[4]=e[1]):t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.lt(n.lastReadWatermarkTimestampMs,n.lastActivityTimestampMs)&&(t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))||t.i64.eq(n.authorityLevel,t.i64.cast([0,60]))&&t.i64.eq(n.syncSource,t.i64.cast([0,2])))})).then(function(e){return r[5]=e})},function(e){return r[4]=r[5]}])},function(e){return r[2]=r[4]}])},function(o){return t.sequence([function(o){return t.i64.eq(r[2],t.i64.cast([0,0]))?t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&[t.i64.cast([0,18]),t.i64.cast([0,19]),t.i64.cast([0,27]),t.i64.cast([0,28])].some(function(e){return t.i64.eq(n.threadType,e)})})).then(function(e){return r[5]=e})},function(e){return t.i64.eq(r[5],t.i64.cast([0,1]))?t.sequence([function(e){return n("LSLocalize").localizeV2Async(t.i64.cast([0,1416259530]),void 0).then(function(e){return r[7]=e})},function(e){return r[6]=r[7]}]):t.sequence([function(e){return r[7]=t.createArray(),r[9]=(r[7].push(t.i64.to_string(r[5])),r[7]),n("LSLocalize").localizeV2Async(t.i64.cast([0,1681736754]),r[7]).then(function(e){return r[8]=e})},function(e){return r[6]=r[8]}])},function(e){return r[4]=r[6]}]):t.sequence([function(e){return t.i64.eq(r[2],t.i64.cast([0,1]))?t.sequence([function(e){return n("LSLocalize").localizeV2Async(t.i64.cast([0,3802288555]),void 0).then(function(e){return r[6]=e})},function(e){return t.resolve(r[7]=r[6])},function(e){return r[5]=r[7]}]):t.sequence([function(e){return r[6]=t.createArray(),r[8]=(r[6].push(t.i64.to_string(r[2])),r[6]),n("LSLocalize").localizeV2Async(t.i64.cast([0,1420387436]),r[6]).then(function(e){return r[7]=e})},function(e){return r[5]=r[7]}])},function(e){return r[4]=r[5]}])},function(e){return r[3]=r[4]}])},function(e){return r[1]=r[3]}]):t.sequence([function(n){return t.i64.eq(e[0],t.i64.cast([-1,4294967284])),t.sequence([function(n){return t.i64.neq(e[1],void 0)?t.resolve(r[7]=e[1]):t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.lt(n.lastReadWatermarkTimestampMs,n.lastActivityTimestampMs)&&(t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))||t.i64.eq(n.authorityLevel,t.i64.cast([0,60]))&&t.i64.eq(n.syncSource,t.i64.cast([0,2])))})).then(function(e){return r[8]=e})},function(e){return r[7]=r[8]}])},function(e){return r[2]=r[7]}])},function(n){return r[3]=e[2].get("all_read"),r[4]=e[2].get("unread_singular"),r[5]=e[2].get("unread_plural"),t.i64.eq(r[2],t.i64.cast([0,0]))?r[6]=r[3]:(t.i64.eq(r[2],t.i64.cast([0,1]))?r[7]=[t.i64.to_string(r[2]),r[4]].join(""):r[7]=[t.i64.to_string(r[2]),r[5]].join(""),r[6]=r[7]),r[1]=r[6]}])},function(e){return r[0]=r[1]}])},function(e){return t.forEach(t.db.table(9).fetch([[[a.threadKey]]]),function(e){var t=e.update,n=e.item;return t({snippet:r[0],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0})})}]))})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateFolderThreadSnippetStoredProcedure",e.__tables__=["threads","participants","messages","attachments"],a.exports=e}),null);
__d("LSUpsertFolder",["LSUpdateFolderThreadSnippet"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.i64.eq(e[0],t.i64.cast([-1,4294967268]))?t.sequence([function(e){return t.db.table(9).fetch([[[t.i64.cast([-1,4294967268])]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?(r[5]=t.i64.of_float(Date.now()),r[3]=r[5]):(n=a.item,r[3]=n.lastActivityTimestampMs)})},function(e){return r[0]=r[3]}]):t.sequence([function(n){return t.i64.neq(e[3],void 0)?t.resolve(r[3]=e[3]):t.sequence([function(n){return t.db.table(9).fetchDesc([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[4]=t.i64.cast([0,0]):(n=a.item,r[4]=n.lastActivityTimestampMs)})},function(e){return r[3]=r[4]}])},function(e){return r[0]=r[3]}])},function(n){return t.i64.neq(e[4],void 0)?t.resolve(r[1]=e[4]):t.sequence([function(n){return t.sortBy(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.lt(n.lastReadWatermarkTimestampMs,n.lastActivityTimestampMs)}),[["lastReadWatermarkTimestampMs","ASC"]]).next().then(function(n,o){var a=n.done,i=n.value;return a?t.sequence([function(n){return t.i64.eq(e[0],t.i64.cast([-1,4294967268]))?t.sequence([function(e){return t.db.table(9).fetch([[[t.i64.cast([-1,4294967268])]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?(r[8]=t.i64.of_float(Date.now()),r[6]=r[8]):(n=a.item,r[6]=n.lastActivityTimestampMs)})},function(e){return r[5]=r[6]}]):t.sequence([function(n){return t.i64.neq(e[3],void 0)?t.resolve(r[6]=e[3]):t.sequence([function(n){return t.db.table(9).fetchDesc([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[7]=t.i64.cast([0,0]):(n=a.item,r[7]=n.lastActivityTimestampMs)})},function(e){return r[6]=r[7]}])},function(e){return r[5]=r[6]}])},function(e){return r[3]=r[5]}]):(o=i.item,r[3]=o.lastReadWatermarkTimestampMs)})},function(e){return r[1]=r[3]}])},function(n){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(n,o){var a=n.done,i=n.value;return a?t.sequence([function(n){return t.forEach(t.filter(t.db.table(9).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(9).add({threadKey:e[0],mailboxType:t.i64.cast([0,0]),threadType:t.i64.cast([0,6]),threadName:e[1],folderName:"",parentThreadKey:t.i64.cast([0,0]),threadPictureUrl:e[2],lastActivityTimestampMs:r[0],lastReadWatermarkTimestampMs:r[1],removeWatermarkTimestampMs:t.i64.cast([0,0]),muteExpireTimeMs:t.i64.cast([0,0]),snippet:"",isAdminSnippet:!1,hasPersistentMenu:!1,disableComposerInput:!1,snippetHasEmoji:!1,authorityLevel:t.i64.cast([0,80]),ongoingCallState:t.i64.cast([0,0]),capabilities:t.i64.cast([0,0]),shouldRoundThreadPicture:!1})}]):(o=i.item,t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(n){var o=n.update,a=n.item;return o({threadName:e[1],folderName:"",parentThreadKey:t.i64.cast([0,0]),threadPictureUrl:e[2],lastActivityTimestampMs:r[0],lastReadWatermarkTimestampMs:r[1],removeWatermarkTimestampMs:t.i64.cast([0,0]),muteExpireTimeMs:t.i64.cast([0,0]),snippet:"",snippetText:void 0,snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:!1,hasPersistentMenu:!1,disableComposerInput:!1,snippetHasEmoji:!1,authorityLevel:t.i64.cast([0,80]),ongoingCallState:t.i64.cast([0,0]),capabilities:t.i64.cast([0,0]),shouldRoundThreadPicture:!1})}))})},function(r){return t.storedProcedure(n("LSUpdateFolderThreadSnippet"),e[0],e[5],e[6])}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpsertFolderStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);