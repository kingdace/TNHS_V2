;/*FB_PKG_DELIM*/

__d("FileMercuryUploadService",["FBLogger","cr:6057","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.onUploadStart,o=e.onUploadProgress,a=o===void 0?r("emptyFunction"):o,i=e.onUploadSuccess,l=i===void 0?r("emptyFunction"):i,u=e.onUploadFailure,c=u===void 0?r("emptyFunction"):u,d=e.isVoiceClip,m=d===void 0?!1:d,p=e.files,_=e.uploadIDs,f=e.isChatSupportUser,g=e.chatSupportUserId,h=e.voiceClipWaveformData,y=e.chatSupportUserNonce,C="/ajax/mercury/upload.php";f===!0&&(C="/ajax/mercury/chatsupportuser/upload.php");var b=await n("cr:6057").load(),v=new b({concurrentLimit:3,onUploadFailure:c,onUploadProgress:a,onUploadStart:function(n,r){t&&t(n,r.upload._file.size,r.upload._file.type)},onUploadSuccess:function(t,n){var e,o,a,i,u=n.response.payload.metadata,c;if(u==null)r("FBLogger")("messenger_web_media").warn("Empty payload"),c={};else{var d=u[0];d!=null?c=d:(r("FBLogger")("messenger_web_media").warn("Empty metadata isChatSupportUser: %s",f),c={})}var m=c.fbid,p=c.image_id,_=c.video_id,g=c.audio_id,h=c.gif_id,y=c.file_id,C=(e=(o=(a=(i=m!=null?m:p)!=null?i:_)!=null?a:g)!=null?o:h)!=null?e:y;if(typeof C=="number"&&(C=C.toString()),s(C),l(t,C),C==null)throw r("FBLogger")("messenger_web").mustfixThrow("Unrecognized file upload success payload")},retryLimit:1,uploadEndpoint:C}),S={};S.data={chat_support_user_id:f===!0&&g!=null?g:void 0,nonce:f===!0&&y!=null?y:void 0,voice_clip:m?!0:void 0,voice_clip_waveform_data:m?JSON.stringify(h):void 0},v.getAsyncFileUploadRequest(p,_,S).send()}function s(e){if(e!=null){var t=Number(e),n=t.toString();t>Number.MAX_SAFE_INTEGER&&n!==e&&r("FBLogger")("work_web_messaging","messaging-composer-upload-fbid-out-of-range").warn("FBID for attachment is out of JS Number range and it's not correctly handled on client: %d",e)}}l.uploadByMercuryUploadService=e}),98);
__d("LSAppendDataTraceAddon.nop",["LSAppendDataTraceAddonStoredProcedure","LSFactory","MetaConfig","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(o,a,i,l,s,u,c){return r("MetaConfig")._("62")?r("LSAppendDataTraceAddonStoredProcedure")(r("LSFactory")(o),{checkPointId:l,dataTraceId:i,errorMessage:u!=null?u:"",syncChannel:s,tags:c!=null?c:""}):(e||(e=n("Promise"))).resolve()};s.__nop_name__="LSAppendDataTraceAddonNop",l.default=s}),98);
__d("LSGetAttachmentType",["LSIntEnum","MessagingAttachmentType","cometIsMimeTypeForMedia","genIsNonAnimatedWebPFile"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){return t.type==="image/webp"?(e||(e=o("LSIntEnum"))).ofNumber(await r("genIsNonAnimatedWebPFile")(t)?r("MessagingAttachmentType").IMAGE:r("MessagingAttachmentType").VIDEO):u(t)}function u(t){var n=t.type;return o("cometIsMimeTypeForMedia").isMimeTypeForPhoto(n)?(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE):n==="audio/wav"?(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO):n==="image/gif"?(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE):o("cometIsMimeTypeForMedia").isMimeTypeForVideo(n)?(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO):(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").FILE)}l.LSGetAttachmentType=s,l.LSGetAttachmentTypeSyncButLessAccurate=u}),98);
__d("LSGetMessageAttributionParams",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.filter(t.db.table(31).fetch(),function(t){return t.offlineThreadingId===e[0]}).next().then(function(e,t){var r,o,a=e.done,i=e.value;return a?(r=[void 0,void 0,void 0],n[0]=r[0],n[1]=r[1],n[2]=r[2],r):(t=i.item,o=[t.threadAttributionSource,t.platformRef,t.platformToken],n[0]=o[0],n[1]=o[1],n[2]=o[2])})},function(e){var t;return t=[n[0],n[1],n[2]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMediaSendGetMessageAttributionParamsStoredProcedure",e.__tables__=["messages_optimistic_context"],a.exports=e}),null);
__d("LSInsertPhase2PendingTask",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return t.db.table(12).fetch([[[e[0]]],"optimistic"]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[0]=void 0:(t=o.item,r[0]=t.threadKey)})},function(o){return t.i64.neq(r[0],void 0)?t.sequence([function(o){return t.storedProcedure(n("LSIssueNewTask"),[t.i64.to_string(r[0]),"_multi_media"].join(""),t.i64.cast([0,4]),e[0],void 0,void 0,e[1],t.i64.cast([0,0]),t.i64.cast([0,29]),void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(e){return r[2]=void 0}]):t.resolve(r[2]=t.i64.cast([0,1002]))},function(e){return o[0]=r[2]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMediaSendInsertPhase2PendingTaskStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSIssueSendAttachmentMessageTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSPredefineTraceForTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_int32(e[5].length),t.i64.gt(r[0],t.i64.cast([0,0]))?t.loopAsync(r[0],function(o){return r[7]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[5],r[7]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[1],e[3]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&n.messageId===e[3]&&t.i64.eq(n.attachmentIndex,r[7])&&t.i64.eq(n.authorityLevel,t.i64.cast([0,20]))}),function(e){var n=e.update,o=e.item;return n({attachmentFbid:t.i64.to_string(r[8])})})}])}):t.resolve()},function(n){return e[9]?r[1]=t.i64.cast([0,9]):r[1]=t.i64.cast([0,3]),t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[2]=t.i64.cast([0,1]):(n=a.item,r[8]=n.syncGroup,t.i64.neq(r[8],void 0)?r[7]=r[8]:r[7]=t.i64.cast([0,1]),r[2]=r[7])})},function(o){return t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),r[2],void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[4]=t[0],t})},function(o){return e[12]!==void 0?t.sequence([function(o){return t.storedProcedure(n("LSPredefineTraceForTask"),e[12],r[4],t.i64.to_string(t.i64.cast([0,46])),e[3])},function(r){return t.storedProcedure(n("LSAppendDataTraceAddon"),e[12],t.i64.cast([0,20]),t.i64.cast([0,1]),void 0,void 0)}]):t.resolve()},function(n){return r[5]=new t.Map,r[6]=t.createArray(),t.db.table(31).add({taskId:r[4],threadKey:e[1],offlineThreadingId:e[3],threadAttributionSource:e[6],platformRef:e[10],platformToken:e[11],replySourceId:e[7],replySourceType:e[8],sendType:r[1],markThreadRead:!1,metadataDataclass:e[13]})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxIssueSendAttachmentMessageTaskStoredProcedure",e.__tables__=["attachments","threads","messages_optimistic_context"],a.exports=e}),null);
__d("LSLocalApplyOptimisticMessageV2",["LSArrayGetObjectAt","LSCreateOfflineThreadingID","LSDeserializeFromJsonIntoDictionaryV2.nop","LSGetLocalizedReplySnippet","LSIssueNewError","LSLocalize","LSSetMessageDisplayedContentTypes","LSSetMessageViewFlags"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSCreateOfflineThreadingID"),r[0]).then(function(e){var t;return t=e,r[1]=t[0],t})},function(o){return r[4]=t.i64.to_string(r[1]),r[3]=e[4]==null?e[3]:e[4],t.sequence([function(n){return r[5]=e[5].get("snippet_has_emoji"),t.islc(t.db.table(9).fetchDesc([[[]],"lastActivityTimestampMs"]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o=e.done,a=e.value;return o?r[6]=t.i64.cast([-1,4294967295]):(n=a.item,r[6]=n.lastActivityTimestampMs)})},function(o){return r[8]=t.i64.add(r[6],t.i64.cast([0,1])),r[10]=t.i64.gt(r[0],r[8])?r[0]:r[8],t.db.table(9).fetch([[[e[1]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(n){return(function(e){t.logger(e).info(e)})("localApplyOptimisticMessage insert optimistic thread"),t.i64.eq(e[2],t.i64.cast([0,1]))?t.sequence([function(n){return t.filter(t.db.table(7).fetch([[[e[1]]]]),function(n){return t.i64.eq(n.id,e[1])&&t.i64.eq(t.i64.cast([0,1]),t.i64.cast([0,1]))}).next().then(function(e,n){var o=e.done,a=e.value;return o?r[16]=!1:(n=a.item,r[19]=n.capabilities2,t.i64.neq(r[19],void 0)?r[18]=r[19]:r[18]=t.i64.cast([0,0]),r[16]=t.i64.neq(t.i64.and_(r[18],t.i64.cast([0,4096])),t.i64.cast([0,0])))})},function(e){return r[11]=r[16]}]):t.resolve(r[11]=!1)},function(n){return r[11]?r[12]="e2ee_cutover":r[12]="inbox",r[11]?r[13]=t.i64.cast([-1,4294967279]):r[13]=t.i64.cast([0,0]),t.forEach(t.filter(t.db.table(9).fetch([[[e[1]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,40]))}),function(e){return e.delete()})},function(n){return t.db.table(9).add({threadKey:e[1],mailboxType:t.i64.cast([0,0]),threadType:e[2],clientThreadKey:e[1],folderName:r[12],parentThreadKey:r[13],lastActivityTimestampMs:r[10],lastReadWatermarkTimestampMs:r[10],snippet:r[3],snippetHasEmoji:r[5]==null?!1:r[5],snippetSenderContactId:e[0],ongoingCallState:t.i64.cast([0,0]),authorityLevel:t.i64.cast([0,40])})},function(n){return t.i64.eq(e[2],t.i64.cast([0,13]))||t.i64.eq(e[2],t.i64.cast([0,7]))||t.i64.eq(e[2],t.i64.cast([0,1]))?t.sequence([function(n){return t.forEach(t.filter(t.db.table(14).fetch([[[e[1],e[1]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.contactId,e[1])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(n){return t.db.table(14).add({threadKey:e[1],contactId:e[1],readWatermarkTimestampMs:t.i64.cast([0,0]),deliveredWatermarkTimestampMs:t.i64.cast([0,0]),authorityLevel:t.i64.cast([0,20]),isModerator:!1})}]):t.resolve()},function(e){return t.sortBy(t.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[14]=!1:(t=o.item,r[14]=t.errorShouldBeShown)})},function(e){return r[14]===!0?t.sequence([function(e){return n("LSLocalize").localizeV2Async(t.i64.cast([0,2285622730]),void 0).then(function(e){return r[16]=e})},function(e){return n("LSLocalize").localizeV2Async(t.i64.cast([0,1919524925]),void 0).then(function(e){return r[17]=e})},function(e){return t.storedProcedure(n("LSIssueNewError"),void 0,t.i64.cast([0,1545093]),r[16],r[17],void 0,void 0)}]):t.resolve()}]):(a=l.item,t.forEach(t.filter(t.db.table(9).fetch([[[e[1]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&t.i64.eq(n.threadType,e[2])}),function(t){var n=t.update,o=t.item;return n({lastActivityTimestampMs:r[10],lastReadWatermarkTimestampMs:r[10],snippet:r[3],snippetHasEmoji:r[5]==null?!1:r[5],snippetSenderContactId:e[0],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,additionalThreadContext:void 0})}))})}])},function(o){return t.sequence([function(n){return t.islc(t.db.table(12).fetchDesc([[[e[1],t.i64.cast([0,80])],[e[1],t.i64.cast([0,60])],[e[1],t.i64.cast([0,40])]],"messageDisplayOrderAuthority"]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o=e.done,a=e.value;return o?(r[59]=t.i64.of_float(Date.now()),r[5]=r[59]):(n=a.item,r[5]=n.primarySortKey)})},function(o){var a,i,l;return r[7]=e[5].get("reply_source_id"),r[8]=e[5].get("reply_source_type"),r[9]=e[5].get("reply_source_type_v2"),r[10]=e[5].get("reply_type"),r[7]!==void 0&&(t.i64.eq(r[8],t.i64.cast([0,1]))||t.i64.eq(r[9],t.i64.cast([0,1])))?t.sequence([function(o){return t.filter(t.db.table(12).fetch([[[r[7]==null?"":r[7]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[1])&&n.messageId===(r[7]==null?"":r[7])}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(i=[r[7],void 0,void 0,t.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],r[59]=i[0],r[60]=i[1],r[61]=i[2],r[62]=i[3],r[63]=i[4],r[64]=i[5],r[65]=i[6],r[66]=i[7],r[67]=i[8],r[68]=i[9],r[69]=i[10],r[70]=i[11],r[71]=i[12],r[72]=i[13],r[73]=i[14],r[74]=i[15],i):(a=s.item,t.sequence([function(o){var i,l,s;return r[80]=a.senderId,r[79]=a.stickerId,t.i64.neq(r[79],void 0)?(i=[r[79],t.i64.cast([0,4])],r[81]=i[0],r[82]=i[1]):(l=[void 0,void 0],r[81]=l[0],r[82]=l[1]),s=[r[81],r[82]],r[76]=s[0],r[77]=s[1],t.sequence([function(o){return t.storedProcedure(n("LSGetLocalizedReplySnippet"),e[1],e[0],r[80],r[10]==null?t.i64.cast([0,0]):r[10]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[78]=t.i64.eq(r[9],t.i64.cast([0,1]))?r[81]:""}])},function(e){var n;return n=[r[7],r[8],r[9],t.i64.cast([0,1]),r[78],r[80],a.text,r[76],r[77],void 0,void 0,void 0,void 0,void 0,void 0,r[10]],r[59]=n[0],r[60]=n[1],r[61]=n[2],r[62]=n[3],r[63]=n[4],r[64]=n[5],r[65]=n[6],r[66]=n[7],r[67]=n[8],r[68]=n[9],r[69]=n[10],r[70]=n[11],r[71]=n[12],r[72]=n[13],r[73]=n[14],r[74]=n[15],n}]))})},function(e){var t;return t=[r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69],r[70],r[71],r[72],r[73],r[74]],r[11]=t[0],r[12]=t[1],r[13]=t[2],r[14]=t[3],r[15]=t[4],r[16]=t[5],r[17]=t[6],r[18]=t[7],r[19]=t[8],r[20]=t[9],r[21]=t[10],r[22]=t[11],r[23]=t[12],r[24]=t[13],r[25]=t[14],r[26]=t[15],t}]):t.resolve((r[7]===void 0||t.i64.eq(r[8],t.i64.cast([0,0]))||t.i64.eq(r[9],t.i64.cast([0,0]))?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],r[59]=a[0],r[60]=a[1],r[61]=a[2],r[62]=a[3],r[63]=a[4],r[64]=a[5],r[65]=a[6],r[66]=a[7],r[67]=a[8],r[68]=a[9],r[69]=a[10],r[70]=a[11],r[71]=a[12],r[72]=a[13],r[73]=a[14],r[74]=a[15]):(i=[r[7],r[8],r[9],t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],r[59]=i[0],r[60]=i[1],r[61]=i[2],r[62]=i[3],r[63]=i[4],r[64]=i[5],r[65]=i[6],r[66]=i[7],r[67]=i[8],r[68]=i[9],r[69]=i[10],r[70]=i[11],r[71]=i[12],r[72]=i[13],r[73]=i[14],r[74]=i[15]),l=[r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69],r[70],r[71],r[72],r[73],r[74]],r[11]=l[0],r[12]=l[1],r[13]=l[2],r[14]=l[3],r[15]=l[4],r[16]=l[5],r[17]=l[6],r[18]=l[7],r[19]=l[8],r[20]=l[9],r[21]=l[10],r[22]=l[11],r[23]=l[12],r[24]=l[13],r[25]=l[14],r[26]=l[15]))},function(o){var a,i,l,s;return r[27]=e[5].get("mention_data"),r[27]?r[28]=!1:r[28]=!0,r[28]?(i=[void 0,void 0,void 0,void 0],r[29]=i[0],r[30]=i[1],r[31]=i[2],r[32]=i[3]):(r[59]=r[27].get("mention_offsets"),r[60]=r[27].get("mention_lengths"),r[61]=r[27].get("mention_ids"),r[62]=r[27].get("mention_types"),a=[r[59],r[60],r[61],r[62]],r[29]=a[0],r[30]=a[1],r[31]=a[2],r[32]=a[3]),r[33]=e[5].get("magic_words_data"),r[33]?r[34]=!1:r[34]=!0,r[34]?(s=[void 0,void 0],r[35]=s[0],r[36]=s[1]):(r[59]=r[33].get("magic_word_offsets"),r[60]=r[33].get("magic_word_lengths"),l=[r[59],r[60]],r[35]=l[0],r[36]=l[1]),r[58]=t.i64.eq(r[10],t.i64.cast([0,1]))?r[17]:e[3],r[37]=e[5].get("sticker_id"),r[38]=e[5].get("sticker_alt_text"),r[39]=e[5].get("hot_emoji_size"),r[40]=e[5].get("iout"),r[41]=e[5].get("platform_XMD_encoded"),r[42]=e[5].get("is_forwarded"),r[43]=e[5].get("forward_score"),r[44]=e[5].get("power_up_style"),r[45]=e[5].get("local_data_id"),r[46]=e[5].get("command_type"),r[47]=e[5].get("reply_type"),r[48]=e[5].get("ephemeral_duration_in_sec"),r[49]=e[5].get("subthread_parent_message_id"),r[50]=e[5].get("is_exclusive_to_subthread"),e[6]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),e[6]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return r[60]=new t.Map,r[61]=r[59].keys(),r[62]=t.i64.of_int32(r[61].length),t.i64.gt(r[62],t.i64.cast([0,0]))?t.loopAsync(r[62],function(e){return r[67]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[61],r[67]).then(function(e){var t;return t=e,r[68]=t[0],r[69]=t[1],t})},function(e){return r[70]=r[59].get(r[68]),r[60].set(r[68],r[70])}])}):t.resolve()},function(e){return r[63]=r[60].get("ai_metadata"),r[63]?r[64]=!1:r[64]=!0,r[64]?t.resolve(r[65]=void 0):t.sequence([function(e){return r[67]=new t.Map,r[68]=r[63].keys(),r[69]=t.i64.of_int32(r[68].length),t.i64.gt(r[69],t.i64.cast([0,0]))?t.loopAsync(r[69],function(e){return r[70]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[68],r[70]).then(function(e){var t;return t=e,r[71]=t[0],r[72]=t[1],t})},function(e){return r[73]=r[63].get(r[71]),r[67].set(r[71],r[73])}])}):t.resolve()},function(e){return r[65]=r[67]}])},function(e){return r[65]!==void 0?(r[67]=r[65].get("ai_product"),r[66]=r[67]):r[66]=void 0,r[51]=r[66]}]):t.resolve(r[51]=void 0)},function(n){return r[52]=e[5].get("rich_text_format_type"),t.i64.eq(r[52],t.i64.cast([0,1]))?r[53]=t.i64.cast([0,3]):(r[51]==="HIDDEN_METADATA"?r[59]=t.i64.cast([0,2]):r[59]=t.i64.cast([0,0]),r[53]=r[59]),r[54]=e[5].get("is_forwarded"),r[54]?r[55]=t.i64.cast([0,3]):r[55]=r[13],r[56]=e[5].get("plugin_type"),t.i64.eq(r[56],t.i64.cast([0,40]))?r[57]="Instamadillo":r[57]="FBBroker",t.i64.eq(t.i64.cast([0,20]),t.i64.cast([0,20]))?t.db.table(12).add({threadKey:e[1],messageId:r[4],timestampMs:r[0],offlineThreadingId:r[4],primarySortKey:r[5],secondarySortKey:r[0],text:r[58],senderId:e[0],stickerId:r[37],hotEmojiSize:r[39],platformXmdEncoded:r[41],isForwarded:r[42],forwardScore:r[43],isAdminMessage:!1,sendStatus:t.i64.cast([0,1]),sendStatusV2:t.i64.cast([0,1]),authorityLevel:t.i64.cast([0,20]),localDataId:r[45],replyType:r[26],ephemeralDurationInSec:r[48],subthreadParentMessageId:r[49],isExclusiveToSubthread:r[50],metadataDataclass:e[6],messageRenderingType:r[53],replySourceId:r[11],replySourceType:r[12],replySourceTypeV2:r[55],replyStatus:r[14],replySnippet:r[15],replyToUserId:r[16],replyMessageText:r[17],replyAttachmentId:r[18],replyAttachmentType:r[19],replyMediaUrl:r[20],replyMediaUrlFallback:r[21],replyMediaPreviewWidth:r[22],replyMediaPreviewHeight:r[23],replyMediaUrlMimeType:r[24],mentionOffsets:r[29],mentionLengths:r[30],mentionIds:r[31],mentionTypes:r[32],transportKey:r[57]}):t.sequence([function(e){return t.db.table(12).fetch([[[r[4]]],"optimistic"]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[r[5],r[0],r[45]],r[59]=n[0],r[60]=n[1],r[61]=n[2],n):(t=i.item,o=[t.primarySortKey,t.secondarySortKey,t.localDataId],r[59]=o[0],r[60]=o[1],r[61]=o[2])})},function(e){return t.forEach(t.filter(t.db.table(12).fetch([[[r[4]]],"optimistic"]),function(e){return e.offlineThreadingId===r[4]&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(n){return t.db.table(12).add({threadKey:e[1],messageId:r[4],timestampMs:r[0],offlineThreadingId:r[4],primarySortKey:r[59],secondarySortKey:r[60],text:r[58],senderId:e[0],stickerId:r[37],hotEmojiSize:r[39],platformXmdEncoded:r[41],isForwarded:r[42],forwardScore:r[43],isAdminMessage:!1,sendStatus:t.i64.cast([0,1]),sendStatusV2:t.i64.cast([0,1]),authorityLevel:t.i64.cast([0,20]),localDataId:r[61],replyType:r[26],ephemeralDurationInSec:r[48],subthreadParentMessageId:r[49],isExclusiveToSubthread:r[50],metadataDataclass:e[6],messageRenderingType:r[53],replySourceId:r[11],replySourceType:r[12],replySourceTypeV2:r[55],replyStatus:r[14],replySnippet:r[15],replyToUserId:r[16],replyMessageText:r[17],replyAttachmentId:r[18],replyAttachmentType:r[19],replyMediaUrl:r[20],replyMediaUrlFallback:r[21],replyMediaPreviewWidth:r[22],replyMediaPreviewHeight:r[23],replyMediaUrlMimeType:r[24],mentionOffsets:r[29],mentionLengths:r[30],mentionIds:r[31],mentionTypes:r[32],transportKey:r[57]})}])}])},function(o){return r[5]=t.createArray(),r[6]=(r[5].push("LSMailboxLocalApplyOptimisticMessageV2StoredProcedure"),r[5]),r[7]=(r[5].push("localApplyOptimisticMessage"),r[5]),r[8]=(r[5].push(e[1]),r[5]),r[9]=(r[5].push(r[4]),r[5]),r[10]=t.toJSON(r[5]),(function(e){t.logger(e).info(e)})(r[10]),r[2]=e[5].get("calculate_denormalizations"),r[2]==null||r[2]?t.sequence([function(o){return t.storedProcedure(n("LSSetMessageViewFlags"),e[1],r[4],r[0],t.i64.eq(e[2],t.i64.cast([0,1])))},function(o){return r[5]=e[5].get("sticker_id"),t.storedProcedure(n("LSSetMessageDisplayedContentTypes"),e[1],r[4],r[0],e[3],!1,t.i64.neq(r[5],void 0))}]):t.resolve()},function(e){var t;return t=[r[4],r[0]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxLocalApplyOptimisticMessageV2StoredProcedure",e.__tables__=["threads","contacts","participants","user_visible_network_connectivity_error","messages"],a.exports=e}),null);
__d("LSMarkSubJobCompletedV2",["LSArrayGetObjectAt"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return r[0]=t.createArray(),t.db.table(51).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?0:(n=a.item,r[3]=new t.Map,r[3].set("offline_attachment_id",n.offlineAttachmentId),r[3].set("offline_threading_id",n.offlineThreadingId),r[3].set("in_message_index",n.inMessageIndex),r[3].set("attachment_type",n.attachmentType),r[3].set("should_transcode",n.shouldTranscode),r[3].set("use_double_phase",n.useDoublePhase),r[3].set("send_by_server",n.sendByServer),r[3].set("is_secure",n.isSecure),r[3].set("state",n.state),r[3].set("fbid",n.fbid),r[3].set("metadata",n.metadata),r[3].set("error",n.error),r[3].set("message_id",n.messageId),r[4]=(r[0].push(r[3]),r[0]))})},function(o){return r[2]=t.i64.of_int32(r[0].length),t.i64.neq(r[2],t.i64.cast([0,0]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[0],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[3]=t[0],r[4]=t[1],t})},function(n){return r[5]=r[3].get("state"),t.i64.neq(e[1],void 0)?e[2]!==void 0?(t.i64.eq(r[5],t.i64.cast([-1,4294967293]))?(r[7]=t.i64.cast([-1,4294967295]),r[6]=r[7]):(t.i64.eq(r[5],t.i64.cast([0,1]))?r[7]=t.i64.cast([0,2]):(t.i64.eq(r[5],t.i64.cast([0,3]))?r[8]=t.i64.cast([0,4]):(t.i64.eq(r[5],t.i64.cast([0,5]))?r[9]=t.i64.cast([0,6]):(t.i64.eq(r[5],t.i64.cast([0,13]))?r[10]=t.i64.cast([0,14]):(t.i64.eq(r[5],t.i64.cast([0,7]))?r[11]=t.i64.cast([0,8]):(t.i64.eq(r[5],t.i64.cast([0,9]))?r[12]=t.i64.cast([0,10]):(t.i64.eq(r[5],t.i64.cast([0,11]))?r[13]=t.i64.cast([0,12]):r[13]=r[5],r[12]=r[13]),r[11]=r[12]),r[10]=r[11]),r[9]=r[10]),r[8]=r[9]),r[7]=r[8]),r[6]=r[7]),t.forEach(t.db.table(51).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({state:r[6],fbid:e[1],messageId:e[2],metadata:e[3]})})):(t.i64.eq(r[5],t.i64.cast([-1,4294967293]))?(r[7]=t.i64.cast([-1,4294967295]),r[6]=r[7]):(t.i64.eq(r[5],t.i64.cast([0,1]))?r[7]=t.i64.cast([0,2]):(t.i64.eq(r[5],t.i64.cast([0,3]))?r[8]=t.i64.cast([0,4]):(t.i64.eq(r[5],t.i64.cast([0,5]))?r[9]=t.i64.cast([0,6]):(t.i64.eq(r[5],t.i64.cast([0,13]))?r[10]=t.i64.cast([0,14]):(t.i64.eq(r[5],t.i64.cast([0,7]))?r[11]=t.i64.cast([0,8]):(t.i64.eq(r[5],t.i64.cast([0,9]))?r[12]=t.i64.cast([0,10]):(t.i64.eq(r[5],t.i64.cast([0,11]))?r[13]=t.i64.cast([0,12]):r[13]=r[5],r[12]=r[13]),r[11]=r[12]),r[10]=r[11]),r[9]=r[10]),r[8]=r[9]),r[7]=r[8]),r[6]=r[7]),t.forEach(t.db.table(51).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({state:r[6],fbid:e[1],metadata:e[3]})})):t.i64.neq(e[4],void 0)?(t.i64.eq(r[5],t.i64.cast([-1,4294967293]))?(r[7]=t.i64.cast([-1,4294967295]),r[6]=r[7]):(t.i64.eq(r[5],t.i64.cast([0,1]))?r[7]=t.i64.cast([0,2]):(t.i64.eq(r[5],t.i64.cast([0,3]))?r[8]=t.i64.cast([0,4]):(t.i64.eq(r[5],t.i64.cast([0,5]))?r[9]=t.i64.cast([0,6]):(t.i64.eq(r[5],t.i64.cast([0,13]))?r[10]=t.i64.cast([0,14]):(t.i64.eq(r[5],t.i64.cast([0,7]))?r[11]=t.i64.cast([0,8]):(t.i64.eq(r[5],t.i64.cast([0,9]))?r[12]=t.i64.cast([0,10]):(t.i64.eq(r[5],t.i64.cast([0,11]))?r[13]=t.i64.cast([0,12]):r[13]=r[5],r[12]=r[13]),r[11]=r[12]),r[10]=r[11]),r[9]=r[10]),r[8]=r[9]),r[7]=r[8]),r[6]=r[7]),t.forEach(t.db.table(51).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({state:r[6],error:e[4]})})):(t.i64.eq(r[5],t.i64.cast([-1,4294967293]))?(r[7]=t.i64.cast([-1,4294967295]),r[6]=r[7]):(t.i64.eq(r[5],t.i64.cast([0,1]))?r[7]=t.i64.cast([0,2]):(t.i64.eq(r[5],t.i64.cast([0,3]))?r[8]=t.i64.cast([0,4]):(t.i64.eq(r[5],t.i64.cast([0,5]))?r[9]=t.i64.cast([0,6]):(t.i64.eq(r[5],t.i64.cast([0,13]))?r[10]=t.i64.cast([0,14]):(t.i64.eq(r[5],t.i64.cast([0,7]))?r[11]=t.i64.cast([0,8]):(t.i64.eq(r[5],t.i64.cast([0,9]))?r[12]=t.i64.cast([0,10]):(t.i64.eq(r[5],t.i64.cast([0,11]))?r[13]=t.i64.cast([0,12]):r[13]=r[5],r[12]=r[13]),r[11]=r[12]),r[10]=r[11]),r[9]=r[10]),r[8]=r[9]),r[7]=r[8]),r[6]=r[7]),t.forEach(t.db.table(51).fetch([[[e[0]]]]),function(e){var t=e.update,n=e.item;return t({state:r[6]})}))}]):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMediaSendMarkSubJobCompletedV2StoredProcedure",e.__tables__=["media_send_jobs"],a.exports=e}),null);
__d("LSMarkSubJobCompletedV2StoredProcedure",["LSMarkSubJobCompletedV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSMarkSubJobCompletedV2"),a.offlineAttachmentId,a.fbid,a.messageId,a.metadata,a.error);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSMessagePointQueryStoredProcedure",["LSMessagePointQuery","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSMessagePointQuery"),a.threadKey,a.messageId,a.threadType,a.numContextMessages);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSMessageSendToSentQPLInteractionHelper.nop",["LSSynchronousPromise","QPLUserFlow","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a){return a!=null&&r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),n,{instanceKey:parseInt(a,10)}),o("LSSynchronousPromise").makeSynchronousPromise()}e.__nop_name__="LSMessageSendToSentQPLInteractionHelper",l.default=e}),98);
__d("LSUpdateOptimisticAttachmentPreview",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[0],e[1],e[2]]]]),function(n){return n.attachmentFbid===e[2]&&t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]&&t.i64.eq(n.authorityLevel,t.i64.cast([0,20]))}),function(t){var n=t.update,r=t.item;return n({playableUrl:e[3],playableUrlFallback:e[4],playableUrlExpirationTimestampMs:e[5],playableUrlMimeType:e[6],previewUrl:e[7],previewUrlFallback:e[8],previewUrlExpirationTimestampMs:e[9],previewUrlMimeType:e[10],previewWidth:e[11],previewHeight:e[12],imageUrl:void 0,imageUrlFallback:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlMimeType:void 0,titleText:e[13]})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateOptimisticAttachmentPreviewStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);
__d("LSOptimisticSendAttachmentForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSUpdateOptimisticAttachmentPreview"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[1]=e[3]===""?void 0:e[3],r[1]!==void 0?t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[1],r[1]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&n.messageId===r[1]&&t.i64.eq(n.authorityLevel,t.i64.cast([0,20]))}),function(n){var r=n.update,o=n.item;return r({attachmentFbid:t.i64.to_string(e[7])})})},function(e){return r[0]=r[1]}]):t.sequence([function(o){return t.storedProcedure(n("LSLocalApplyOptimisticMessage"),e[0],e[1],e[2],e[4],e[5],e[6],void 0,void 0,void 0,void 0,t.i64.cast([0,3]),void 0,void 0,void 0,!0).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],t})},function(o){return t.filter(t.db.table(16).fetch(),function(n){return n.attachmentFbid===t.i64.to_string(e[7])}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],r[3],r[2],r[2],t.i64.to_string(e[7]),t.i64.cast([0,2]),void 0,t.i64.cast([0,0]),void 0,!0,!1):(a=l.item,t.sequence([function(o){return t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],r[3],r[2],r[2],t.i64.to_string(e[7]),a.attachmentType,a.filename,a.attachmentIndex,a.attributionAppId,!0,!1)},function(o){return t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],r[2],t.i64.to_string(e[7]),a.playableUrl,a.playableUrlFallback,a.playableUrlExpirationTimestampMs,a.playableUrlMimeType,a.previewUrl,a.previewUrlFallback,a.previewUrlExpirationTimestampMs,a.previewUrlMimeType,a.previewWidth,a.previewHeight,a.titleText)}]))})},function(e){return r[0]=r[2]}])},function(o){return t.sequence([function(n){return r[2]=t.createArray(),r[6]=(r[2].push(e[7]),r[2]),t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[3]=t.i64.cast([0,1]):(n=a.item,r[7]=n.syncGroup,t.i64.neq(r[7],void 0)?r[6]=r[7]:r[6]=t.i64.cast([0,1]),r[3]=r[6])})},function(o){return t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),r[3],void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[5]=t[0],t})},function(n){return t.db.table(31).add({taskId:r[5],threadKey:e[1],offlineThreadingId:r[0],threadAttributionSource:e[8],sendType:t.i64.cast([0,4]),markThreadRead:!1,initiatingSource:e[9]})}])},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticSendAttachmentForwardStoredProcedure",e.__tables__=["attachments","threads","messages_optimistic_context"],a.exports=e}),null);
__d("LSOptimisticSendAttachmentForwardStoredProcedure",["LSOptimisticSendAttachmentForward","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticSendAttachmentForward"),a.senderId,a.threadKey,a.threadType,a.offlineThreadingId,a.text,a.snippet,a.snippetHasEmoji,a.forwardedAttachmentFbid,a.source,a.initiatingSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSOptimisticSendMessageForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSPredefineTraceForTask","LSUpdateOptimisticAttachmentPreview"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.filter(t.db.table(12).fetch([[[e[3],e[4],e[5]]]]),function(n){return t.i64.eq(n.threadKey,e[3])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.timestampMs,e[4])&&n.messageId===e[5]&&t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[3]=t.createArray(),r[4]=(r[3].push("optimisticSendMessageForward msg not found"),r[3]),r[5]=(r[3].push(e[5]),r[3]),r[6]=t.toJSON(r[3]),(function(e){t.logger(e).mustfix(e)})(r[6]),i=["",t.i64.cast([-1,4294967295])],r[0]=i[0],r[1]=i[1]):(a=s.item,t.sequence([function(o){return r[11]=a.forwardScore,r[3]=a.text,r[4]=r[11],t.storedProcedure(n("LSLocalApplyOptimisticMessage"),e[0],e[1],e[2],r[3],void 0,void 0,a.stickerId,a.hotEmojiSize,void 0,void 0,t.i64.cast([0,3]),void 0,r[4],void 0,!0).then(function(e){var t;return t=e,r[5]=t[0],r[6]=t[1],t})},function(o){return t.forEach(t.db.table(16).fetch([[[a.threadKey,a.messageId]]]),function(o){var a=o.item;return t.sequence([function(o){return r[16]=a.attachmentFbid,r[12]=t.createArray(),r[13]=(r[12].push(r[16]),r[12]),r[14]=(r[12].push(r[5]),r[12]),r[15]=t.toJSON(r[12]),t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],r[6],r[5],r[16],r[15],a.attachmentType,a.filename,a.attachmentIndex,void 0,a.hasMedia,a.hasXma)},function(o){return t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],r[5],r[15],a.playableUrl,a.playableUrlFallback,a.playableUrlExpirationTimestampMs,a.playableUrlMimeType,a.previewUrl,a.previewUrlFallback,a.previewUrlExpirationTimestampMs,a.previewUrlMimeType,a.previewWidth,a.previewHeight,a.titleText)}])})},function(n){return t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[7]=t.i64.cast([0,1]):(n=a.item,r[13]=n.syncGroup,t.i64.neq(r[13],void 0)?r[12]=r[13]:r[12]=t.i64.cast([0,1]),r[7]=r[12])})},function(o){return t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),r[7],void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[9]=t[0],t})},function(e){return t.resolve()},function(n){return t.db.table(31).add({taskId:r[9],threadKey:e[1],offlineThreadingId:r[5],messageId:e[5],threadAttributionSource:e[6],sendType:t.i64.cast([0,5]),markThreadRead:!1,initiatingSource:e[7]})},function(n){var o;return r[12]=new t.Map,r[13]=r[12].set("optimisticSendMessageForward",e[1]),r[14]=r[12].set("fwdMsgID",e[5]),r[15]=t.toJSON(r[12]),r[10]=r[15],(function(e){t.logger(e).info(e)})(r[10]),o=[r[5],r[9]],r[0]=o[0],r[1]=o[1]}]))})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticSendMessageForwardStoredProcedure",e.__tables__=["messages","attachments","threads","messages_optimistic_context"],a.exports=e}),null);
__d("LSOptimisticSendMessageForwardStoredProcedure",["LSOptimisticSendMessageForward","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticSendMessageForward"),a.senderId,a.threadKey,a.threadType,a.forwardedMsgThreadKey,a.forwardedMsgTimestampMs,a.forwardedMsgId,a.source,a.initiatingSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSOptimisticSendMessageV2",["LSAppendDataTraceAddon.nop","LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessageV2","LSLogEventAnnotate.nop","LSMessageSendToSentQPLInteractionHelper.nop","LSOptimisticMarkThreadReadV2","LSPredefineTraceForTask","LSUpdateOptimisticAttachmentPreview","gkx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=e[6].get("qpl_instance_key"),o[1]=e[6].get("platform_send_instance_key"),t.storedProcedure(n("LSLocalApplyOptimisticMessageV2"),e[0],e[1],e[2],e[4],e[5],e[6],e[8]).then(function(e){var t;return t=e,o[2]=t[0],o[3]=t[1],t})},function(a){return t.sequence([function(r){return o[6]=e[6].get("external_attachment_url"),o[45]=o[6]===""?void 0:o[6],o[45]!==void 0?t.sequence([function(r){return o[46]=e[6].get("attribution_app_id"),o[47]=e[6].get("optimistic_attachment_preview"),t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_gif_start",o[0])},function(r){return t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],o[3],o[2],o[2],o[2],t.i64.cast([0,3]),o[45],t.i64.cast([0,0]),o[46],!0,!1)},function(r){return o[47]?o[48]=!1:o[48]=!0,o[48]?t.resolve():(o[49]=o[47].get("playable_url"),o[50]=o[47].get("playable_url_fallback"),o[51]=o[47].get("playable_url_expiration_timestamp_ms"),o[52]=o[47].get("playable_url_mime_type"),o[53]=o[47].get("preview_url"),o[54]=o[47].get("preview_url_fallback"),o[55]=o[47].get("preview_url_expiration_timestamp_ms"),o[56]=o[47].get("preview_url_mime_type"),o[57]=o[47].get("preview_width"),o[58]=o[47].get("preview_height"),o[59]=o[47].get("image_url"),o[60]=o[47].get("image_url_fallback"),o[61]=o[47].get("image_url_expiration_timestamp_ms"),o[62]=o[47].get("image_url_mime_type"),o[63]=o[47].get("title_text"),t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],o[2],o[2],o[49],o[50],o[51],o[52],o[53],o[54],o[55],o[56],o[57],o[58],o[63]))},function(e){return t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_gif_end",o[0])},function(e){return o[7]=t.i64.cast([0,7])}]):t.sequence([function(r){return o[46]=e[6].get("sticker_id"),t.i64.neq(o[46],void 0)?t.sequence([function(r){return t.i64.neq(o[46],t.i64.cast([53057,267535043]))&&t.i64.neq(o[46],t.i64.cast([85970,924785702]))&&t.i64.neq(o[46],t.i64.cast([85970,1004785694]))&&t.i64.neq(o[46],t.i64.cast([85970,1044785690]))?t.sequence([function(r){return o[50]=t.i64.to_string(o[46]),o[48]=e[6].get("optimistic_attachment_preview"),t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_sticker_start",o[0])},function(r){return t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],o[3],o[2],t.i64.to_string(o[46]),o[50],t.i64.cast([0,1]),void 0,t.i64.cast([0,0]),void 0,!0,!1)},function(r){return o[48]?o[49]=!1:o[49]=!0,o[49]?t.resolve():(o[51]=o[48].get("playable_url"),o[52]=o[48].get("playable_url_fallback"),o[53]=o[48].get("playable_url_expiration_timestamp_ms"),o[54]=o[48].get("playable_url_mime_type"),o[55]=o[48].get("preview_url"),o[56]=o[48].get("preview_url_fallback"),o[57]=o[48].get("preview_url_expiration_timestamp_ms"),o[58]=o[48].get("preview_url_mime_type"),o[59]=o[48].get("preview_width"),o[60]=o[48].get("preview_height"),o[61]=o[48].get("image_url"),o[62]=o[48].get("image_url_fallback"),o[63]=o[48].get("image_url_expiration_timestamp_ms"),o[64]=o[48].get("image_url_mime_type"),o[65]=o[48].get("title_text"),t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],o[2],o[50],o[51],o[52],o[53],o[54],o[55],o[56],o[57],o[58],o[59],o[60],o[65]))},function(e){return t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_sticker_end",o[0])}]):t.resolve()},function(e){return o[47]=t.i64.cast([0,2])}]):t.sequence([function(r){return o[48]=e[6].get("signed_xma_dataclass"),o[48]!==void 0?t.sequence([function(r){return t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],o[3],o[2],o[2],o[2],t.i64.cast([0,7]),void 0,t.i64.cast([0,0]),void 0,!1,!0)},function(e){return o[49]=t.i64.cast([0,12])}]):t.resolve(o[49]=t.i64.cast([0,1]))},function(e){return o[47]=o[49]}])},function(e){return o[7]=o[47]}])},function(e){return t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_send_message_v2_task_start",o[0])},function(n){return o[8]=t.i64.cast([0,0]),t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var r=e.done,a=e.value;return r?o[9]=t.i64.cast([0,1]):(n=a.item,o[47]=n.syncGroup,t.i64.neq(o[47],void 0)?o[46]=o[47]:o[46]=t.i64.cast([0,1]),o[9]=o[46])})},function(r){return o[11]=e[6].get("plugin_type"),t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,o[11]==null?t.i64.cast([0,0]):o[11],t.i64.cast([0,0]),o[9],void 0,t.i64.cast([0,0]),void 0,o[8]==null?t.i64.cast([0,0]):o[8]).then(function(e){var t;return t=e,o[12]=t[0],t})},function(e){return t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_send_message_v2_task_end",o[0])},function(r){return o[13]=e[6].get("data_trace_id"),o[13]!==void 0?t.sequence([function(e){return t.storedProcedure(n("LSPredefineTraceForTask"),o[13],o[12],t.i64.to_string(t.i64.cast([0,46])),o[2])},function(r){return o[46]=e[6].get("source"),o[49]=t.i64.to_string(o[46]),o[49]!==void 0?o[47]=o[49]:o[47]=t.i64.to_string(t.i64.cast([0,0])),o[48]=",",t.nativeOperation(n("LSAppendDataTraceAddon.nop"),o[13],t.i64.cast([0,20]),t.i64.cast([0,1]),void 0,[o[47],o[48],t.i64.to_string(o[7]),o[48],t.i64.to_string(e[2])].join(""))}]):t.resolve()},function(n){return o[14]=e[6].get("blocked_by_otids"),o[15]=new t.Map,o[16]=e[6].get("openEb"),o[17]=e[6].get("source"),o[18]=e[6].get("external_attachment_url"),o[19]=e[6].get("platform_ref"),o[20]=e[6].get("platform_token"),o[21]=e[6].get("reply_source_id"),o[22]=e[6].get("reply_source_attachment_id"),o[23]=e[6].get("reply_source_type"),o[24]=e[6].get("mark_read"),o[25]=e[6].get("initiating_app_id"),o[26]=e[6].get("initiating_source"),o[27]=e[6].get("navigation_chain"),o[28]=e[6].get("dety_params"),o[29]=e[6].get("skip_url_preview_gen"),o[30]=e[6].get("text_has_links"),o[31]=e[6].get("multitab_env"),o[32]=e[6].get("subthread_parent_message_id"),o[33]=e[6].get("is_exclusive_to_subthread"),o[34]=e[6].get("rich_text_format_type"),o[35]=e[6].get("plugin_type"),t.i64.eq(o[35],t.i64.cast([0,40]))?o[36]="Instamadillo":o[36]="FBBroker",o[37]=e[6].get("signed_xma_dataclass"),o[38]=e[6].get("signed_xma_dataclass_validation"),t.db.table(31).add({taskId:o[12],threadKey:e[1],openEb:o[16],qplInstanceKey:o[0],offlineThreadingId:o[2],threadAttributionSource:o[17],externalAttachmentUrl:o[18],platformRef:o[19],platformToken:o[20],replySourceId:o[21],replySourceType:o[23],sendType:o[7],markThreadRead:o[24]==null?!1:o[24],initiatingSource:o[26],skipUrlPreviewGen:o[29],textHasLinks:o[30],dataclassParams:e[7],multitabEnv:o[31],subthreadParentMessageId:o[32],isExclusiveToSubthread:o[33],metadataDataclass:e[8],richTextFormatType:o[34],transportKey:o[36]})},function(a){return r("gkx")("834")&&t.i64.eq(e[2],t.i64.cast([0,1]))?t.resolve(0):(o[46]=e[6].get("mark_read"),o[46]!=null&&o[46]?t.sequence([function(e){return t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_mark_thread_read_start",o[0])},function(r){return t.storedProcedure(n("LSOptimisticMarkThreadReadV2"),e[1],o[3])},function(e){return t.nativeOperation(n("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_mark_thread_read_end",o[0])}]):t.resolve())},function(r){return o[39]=t.createArray(),o[40]=(o[39].push("optimisticSendMessageV2"),o[39]),o[41]=(o[39].push(e[1]),o[39]),o[42]=(o[39].push(o[2]),o[39]),o[43]=t.toJSON(o[39]),(function(e){t.logger(e).info(e)})(o[43]),o[44]=new t.Map,o[44].set("offline_threading_id",o[2]),o[44].set("task_id",o[12]),o[44].set("task_queue_name",t.i64.to_string(e[1])),o[44].set("task_label",t.i64.to_string(t.i64.cast([0,46]))),t.nativeOperation(n("LSLogEventAnnotate.nop"),t.i64.cast([0,16]),t.i64.cast([0,23]),t.i64.cast([0,0]),o[44])},function(e){var t;return t=[o[2],o[12]],o[4]=t[0],o[5]=t[1],t}])},function(e){return a[0]=o[4]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSMailboxOptimisticSendMessageV2StoredProcedure",e.__tables__=["threads","messages_optimistic_context"];var s=e;l.default=s}),98);
__d("LSOptimisticSendMessageV2StoredProcedure",["LSOptimisticSendMessageV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticSendMessageV2"),a.senderId,a.threadKey,a.threadType,a.mailboxType,a.text,a.snippet,a.extraSendMessageParams,a.dataclassParams,a.metadataDataclass);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSRemoveMediaSendJobs",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMediaSendRemoveMediaSendJobsStoredProcedure",e.__tables__=["media_send_jobs"],a.exports=e}),null);
__d("LSRemoveMediaSendJobsStoredProcedure",["LSRemoveMediaSendJobs","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSRemoveMediaSendJobs"),a.offlineThreadingId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSSendPhase1MultiPhotoMessageV2",["LSArrayGetObjectAt","LSGetMessageAttributionParams","LSIssueSendAttachmentMessageTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.createArray(),r[1]=new t.Map,r[2]=new t.Map,r[3]=!1,r[4]=t.i64.cast([0,0]),t.forEach(t.sortBy(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),[["inMessageIndex","ASC"]]),function(e){var n=e.item;return r[7]=n.fbid,r[4]=t.i64.add(r[4],t.i64.cast([0,1])),t.i64.neq(r[7],void 0)?r[8]=(r[0].push(r[7]),r[0]):0})},function(o){return r[5]=t.i64.of_int32(r[0].length),t.i64.neq(r[5],r[4])||t.i64.eq(r[4],t.i64.cast([0,0]))?t.resolve(r[6]=t.i64.cast([0,10002])):t.sequence([function(n){return t.db.table(12).fetch([[[e[0]]],"optimistic"]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0,void 0,void 0,void 0],r[7]=n[0],r[8]=n[1],r[9]=n[2],r[10]=n[3],r[11]=n[4],n):(t=i.item,o=[t.threadKey,t.senderId,t.text,t.replySourceId,t.replySourceTypeV2],r[7]=o[0],r[8]=o[1],r[9]=o[2],r[10]=o[3],r[11]=o[4])})},function(o){return t.i64.eq(r[7],void 0)||t.i64.eq(r[8],void 0)?t.resolve((t.i64.eq(r[7],void 0)?r[14]=t.i64.cast([0,10003]):r[14]=t.i64.cast([0,10004]),r[13]=r[14])):t.sequence([function(e){return t.db.table(9).fetch([[[r[7]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[14]=void 0:(t=o.item,r[14]=t.threadType)})},function(n){return t.filter(t.db.table(31).fetch(),function(t){return t.offlineThreadingId===e[0]}).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0,void 0,void 0,void 0,void 0,void 0],r[16]=n[0],r[17]=n[1],r[18]=n[2],r[19]=n[3],r[20]=n[4],r[21]=n[5],r[22]=n[6],n):(t=i.item,o=[t.platformRef,t.platformToken,t.initiatingSource,void 0,void 0,t.dataclassParams,t.metadataDataclass],r[16]=o[0],r[17]=o[1],r[18]=o[2],r[19]=o[3],r[20]=o[4],r[21]=o[5],r[22]=o[6])})},function(o){return t.i64.neq(r[14],void 0)?t.sequence([function(o){return r[25]=r[1].keys(),r[26]=t.i64.of_int32(r[25].length),t.i64.gt(r[26],t.i64.cast([0,0]))?t.loopAsync(r[26],function(o){return r[32]=o,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[25],r[32]).then(function(e){var t;return t=e,r[33]=t[0],r[34]=t[1],t})},function(o){return r[35]=r[2].get(r[33]),r[36]=t.i64.to_string(r[35]),r[36]!==void 0?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[25],r[32]).then(function(e){var t;return t=e,r[37]=t[0],r[38]=t[1],t})},function(n){return r[39]=r[1].get(r[33]),t.forEach(t.filter(t.db.table(16).fetch([[[r[7],e[0],r[37]]]]),function(n){return t.i64.eq(n.threadKey,r[7])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&n.messageId===e[0]&&n.attachmentFbid===r[37]}),function(e){var t=e.update,n=e.item;return t({attachmentFbid:r[36],originalFileHash:r[39]})})}]):t.resolve()}])}):t.resolve()},function(o){return t.storedProcedure(n("LSGetMessageAttributionParams"),e[0]).then(function(e){var t;return t=e,r[27]=t[0],r[28]=t[1],r[29]=t[2],t})},function(o){return t.i64.neq(r[27],void 0)?r[30]=r[27]:r[30]=t.i64.cast([0,0]),t.storedProcedure(n("LSIssueSendAttachmentMessageTask"),r[8],r[7],r[14],e[0],r[9],r[0],r[30],r[10],r[11],r[3],r[16],r[17],e[1],r[22])},function(e){return t.i64.ge(t.i64.cast([0,0]),t.i64.cast([0,0]))?r[31]=void 0:r[31]=t.i64.cast([0,10006]),r[24]=r[31]}]):t.resolve(r[24]=t.i64.cast([0,10005]))},function(e){return r[13]=r[24]}])},function(e){return r[6]=r[13]}])},function(e){return o[0]=r[6]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMediaSendSendPhase1MultiPhotoMessageV2StoredProcedure",e.__tables__=["media_send_jobs","messages","threads","messages_optimistic_context","attachments"],a.exports=e}),null);
__d("LSResumeMediaSendJob",["LSInsertPhase2PendingTask","LSSendPhase1MultiPhotoMessageV2"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=new t.Map,r[1]=new t.Map,r[1].set("main_job_succeeded",!1),r[1].set("resume_failed",!1),r[1].set("error",void 0),r[1].set("running_sub_job_states",r[0]),r[2]=new t.Map,r[2].set("should_transcode",!1),r[2].set("use_double_phase",!1),r[2].set("send_by_server",!1),r[2].set("is_secure",!1),r[2].set("should_dedupe",!1),r[2].set("is_optimistic_upload",!1),t.sortBy(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),[["state","ASC"]]).next().then(function(e,t){var n=e.done,o=e.value;return n?0:(t=o.item,r[2].set("should_transcode",t.shouldTranscode),r[2].set("use_double_phase",t.useDoublePhase),r[2].set("send_by_server",t.sendByServer),r[2].set("is_secure",t.isSecure),r[2].set("is_optimistic_upload",!1))})},function(n){return r[4]=new t.Map,t.forEach(t.sortBy(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),[["inMessageIndex","ASC"]]),function(e){var n=e.item;return r[13]=n.offlineAttachmentId,r[11]=n.state,r[12]=n.error,t.i64.eq(r[11],t.i64.cast([-1,4294967293]))?r[10]=!0:(t.i64.eq(r[11],t.i64.cast([0,1]))?r[14]=!0:(t.i64.eq(r[11],t.i64.cast([0,3]))?r[15]=!0:(t.i64.eq(r[11],t.i64.cast([0,5]))?r[16]=!0:(t.i64.eq(r[11],t.i64.cast([0,13]))?r[17]=!0:(t.i64.eq(r[11],t.i64.cast([0,7]))?r[18]=!0:(t.i64.eq(r[11],t.i64.cast([0,9]))?r[19]=!0:(t.i64.eq(r[11],t.i64.cast([0,11]))?r[20]=!0:r[20]=!1,r[19]=r[20]),r[18]=r[19]),r[17]=r[18]),r[16]=r[17]),r[15]=r[16]),r[14]=r[15]),r[10]=r[14]),r[10]?t.resolve(t.i64.eq(r[11],t.i64.cast([0,5]))||t.i64.eq(r[11],t.i64.cast([0,11]))?0:r[4].set(r[13],r[11])):t.i64.neq(r[12],void 0)?t.resolve((r[1].set("resume_failed",!0),r[1].set("error",r[12]))):(t.i64.eq(r[11],t.i64.cast([-1,4294967295]))?r[14]=t.i64.cast([0,5]):(t.i64.eq(r[11],t.i64.cast([-1,4294967294]))?(r[16]=r[2].get("should_transcode"),r[15]=r[16]?t.i64.cast([0,1]):t.i64.cast([0,3])):(t.i64.eq(r[11],t.i64.cast([0,2]))?r[16]=t.i64.cast([0,3]):(t.i64.eq(r[11],t.i64.cast([0,4]))?(r[18]=r[2].get("send_by_server"),r[19]=r[2].get("use_double_phase"),r[17]=r[18]?r[19]?t.i64.cast([0,13]):void 0:t.i64.cast([0,5])):(t.i64.eq(r[11],t.i64.cast([0,6]))?(r[19]=r[2].get("use_double_phase"),r[18]=r[19]?t.i64.cast([0,13]):void 0):(t.i64.eq(r[11],t.i64.cast([0,14]))?(r[20]=r[2].get("use_double_phase"),r[21]=r[2].get("should_transcode"),r[19]=r[20]?r[21]?t.i64.cast([0,7]):t.i64.cast([0,9]):void 0):(t.i64.eq(r[11],t.i64.cast([0,8]))?r[20]=t.i64.cast([0,9]):(t.i64.eq(r[11],t.i64.cast([0,10]))?(r[22]=r[2].get("send_by_server"),r[21]=r[22]?void 0:t.i64.cast([0,11])):(t.i64.eq(r[11],t.i64.cast([0,12])),r[22]=void 0,r[21]=r[22]),r[20]=r[21]),r[19]=r[20]),r[18]=r[19]),r[17]=r[18]),r[16]=r[17]),r[15]=r[16]),r[14]=r[15]),t.i64.neq(r[14],void 0)?t.sequence([function(e){return t.forEach(t.db.table(51).fetch([[[r[13]]]]),function(e){var t=e.update,n=e.item;return t({state:r[14]})})},function(e){return t.i64.eq(r[14],t.i64.cast([0,5]))||t.i64.eq(r[14],t.i64.cast([0,11]))?0:r[4].set(r[13],r[14])}]):t.resolve())})},function(n){return t.sortBy(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),[["state","ASC"]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[5]=void 0:(t=o.item,r[5]=t.state)})},function(o){return t.i64.neq(r[5],void 0)?(r[10]=r[2].get("send_by_server"),r[11]=r[2].get("use_double_phase"),r[12]=r[2].get("use_double_phase"),(r[10]?r[11]?t.i64.eq(r[5],t.i64.cast([0,10])):t.i64.eq(r[5],t.i64.cast([0,4])):r[12]?t.i64.eq(r[5],t.i64.cast([0,12])):t.i64.eq(r[5],t.i64.cast([0,6])))?t.resolve(r[1].set("main_job_succeeded",!0)):t.i64.eq(r[5],t.i64.cast([0,5]))?t.sequence([function(n){return r[13]=void 0,t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var n=e.item;return r[15]=n.error,t.i64.eq(r[15],void 0)?(t.i64.neq(n.fbid,void 0)?r[16]=void 0:r[16]=t.i64.cast([0,9]),r[14]=r[16]):r[14]=r[15],t.i64.neq(r[14],void 0)?r[13]=r[14]:0})},function(o){return t.i64.neq(r[13],void 0)?t.resolve((r[1].set("resume_failed",!0),r[1].set("error",r[13]))):(r[14]=r[2].get("is_optimistic_upload"),r[14]?(r[15]=r[2].get("send_by_server"),r[16]=r[2].get("use_double_phase"),r[17]=r[2].get("use_double_phase"),(r[15]?r[16]?t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,10])):t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,4])):r[17]?t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,12])):t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,6])))?t.resolve(r[1].set("main_job_succeeded",!0)):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([-1,4294967295]))?r[18]=t.i64.cast([0,5]):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([-1,4294967294]))?(r[20]=r[2].get("should_transcode"),r[19]=r[20]?t.i64.cast([0,1]):t.i64.cast([0,3])):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,2]))?r[20]=t.i64.cast([0,3]):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,4]))?(r[22]=r[2].get("send_by_server"),r[23]=r[2].get("use_double_phase"),r[21]=r[22]?r[23]?t.i64.cast([0,13]):void 0:t.i64.cast([0,5])):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,6]))?(r[23]=r[2].get("use_double_phase"),r[22]=r[23]?t.i64.cast([0,13]):void 0):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,14]))?(r[24]=r[2].get("use_double_phase"),r[25]=r[2].get("should_transcode"),r[23]=r[24]?r[25]?t.i64.cast([0,7]):t.i64.cast([0,9]):void 0):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,8]))?r[24]=t.i64.cast([0,9]):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,10]))?(r[26]=r[2].get("send_by_server"),r[25]=r[26]?void 0:t.i64.cast([0,11])):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,12])),r[26]=void 0,r[25]=r[26]),r[24]=r[25]),r[23]=r[24]),r[22]=r[23]),r[21]=r[22]),r[20]=r[21]),r[19]=r[20]),r[18]=r[19]),t.i64.neq(r[18],void 0)?t.sequence([function(n){return t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var t=e.update,n=e.item;return t({state:r[18]})})},function(n){return t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var t=e.item;return r[4].set(t.offlineAttachmentId,t.state)})}]):t.resolve())):t.sequence([function(o){return r[15]=r[2].get("is_secure"),r[15]?t.sequence([function(n){return r[17]=t.createArray(),r[18]=new t.Map,r[19]=new t.Map,r[20]=!1,r[21]=t.i64.cast([0,0]),t.forEach(t.sortBy(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),[["inMessageIndex","ASC"]]),function(e){var n=e.item;return r[26]=n.fbid,r[21]=t.i64.add(r[21],t.i64.cast([0,1])),t.i64.neq(r[26],void 0)?r[27]=(r[17].push(r[26]),r[17]):0})},function(n){return r[22]=t.createArray(),t.forEach(t.sortBy(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),[["inMessageIndex","ASC"]]),function(e){var t=e.item;return r[26]=t.metadata,r[26]!==void 0?r[27]=(r[22].push(r[26]),r[22]):0})},function(e){return r[23]=t.i64.of_int32(r[17].length),r[24]=t.i64.of_int32(r[22].length),t.i64.neq(r[23],r[21])||t.i64.neq(r[24],r[21])?r[25]=t.i64.cast([0,11]):((function(e){t.logger(e).debug(e)})("[TincanLS][LSSecureMailboxSendSecureMediaMessageStoredProcedure] Started"),(function(e){t.logger(e).debug(e)})("[TincanLS][LSSecureMailboxSendSecureMediaMessageStoredProcedure] Completed"),r[25]=void 0),r[16]=r[25]}]):t.sequence([function(o){return t.storedProcedure(n("LSSendPhase1MultiPhotoMessageV2"),e[0],e[2]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(n){return t.i64.eq(r[17],void 0)?t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var n=e.update,r=e.item;return n({state:t.i64.cast([0,6])})}):t.resolve()},function(e){return r[16]=r[17]}])},function(n){return t.i64.eq(r[16],void 0)?(r[17]=r[2].get("send_by_server"),r[18]=r[2].get("use_double_phase"),r[19]=r[2].get("use_double_phase"),(r[17]?r[18]?t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,10])):t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,4])):r[19]?t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,12])):t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,6])))?t.resolve(r[1].set("main_job_succeeded",!0)):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([-1,4294967295]))?r[20]=t.i64.cast([0,5]):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([-1,4294967294]))?(r[22]=r[2].get("should_transcode"),r[21]=r[22]?t.i64.cast([0,1]):t.i64.cast([0,3])):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,2]))?r[22]=t.i64.cast([0,3]):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,4]))?(r[24]=r[2].get("send_by_server"),r[25]=r[2].get("use_double_phase"),r[23]=r[24]?r[25]?t.i64.cast([0,13]):void 0:t.i64.cast([0,5])):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,6]))?(r[25]=r[2].get("use_double_phase"),r[24]=r[25]?t.i64.cast([0,13]):void 0):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,14]))?(r[26]=r[2].get("use_double_phase"),r[27]=r[2].get("should_transcode"),r[25]=r[26]?r[27]?t.i64.cast([0,7]):t.i64.cast([0,9]):void 0):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,8]))?r[26]=t.i64.cast([0,9]):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,10]))?(r[28]=r[2].get("send_by_server"),r[27]=r[28]?void 0:t.i64.cast([0,11])):(t.i64.eq(t.i64.cast([0,6]),t.i64.cast([0,12])),r[28]=void 0,r[27]=r[28]),r[26]=r[27]),r[25]=r[26]),r[24]=r[25]),r[23]=r[24]),r[22]=r[23]),r[21]=r[22]),r[20]=r[21]),t.i64.neq(r[20],void 0)?t.sequence([function(n){return t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var t=e.update,n=e.item;return t({state:r[20]})})},function(n){return t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var t=e.item;return r[4].set(t.offlineAttachmentId,t.state)})}]):t.resolve())):t.resolve((r[1].set("resume_failed",!0),r[1].set("error",r[16])))}]))}]):t.i64.eq(r[5],t.i64.cast([0,11]))?t.sequence([function(n){return r[13]=void 0,t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var n=e.item;return r[14]=n.error,t.i64.neq(r[14],void 0)?r[13]=r[14]:0})},function(e){return t.i64.neq(r[13],void 0)?(r[1].set("resume_failed",!0),r[1].set("error",r[13])):r[1].set("main_job_succeeded",!0)}]):t.i64.eq(r[5],t.i64.cast([0,13]))?t.sequence([function(o){return t.storedProcedure(n("LSInsertPhase2PendingTask"),e[0],e[1]).then(function(e){var t;return t=e,r[13]=t[0],t})},function(n){return t.i64.neq(r[13],void 0)?t.resolve((r[1].set("resume_failed",!0),r[1].set("error",r[13]))):t.sequence([function(n){return t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var n=e.update,r=e.item;return n({state:t.i64.cast([0,14])})})},function(n){return r[1].set("main_job_succeeded",!0),t.forEach(t.filter(t.db.table(51).fetch(),function(t){return t.offlineThreadingId===e[0]}),function(e){var t=e.item;return r[4].set(t.offlineAttachmentId,t.state)})}])}]):t.resolve(0)):t.resolve((r[1].set("resume_failed",!0),r[1].set("error",t.i64.cast([0,11]))))},function(e){var t;return r[7]=r[1].get("main_job_succeeded"),r[8]=r[1].get("resume_failed"),r[9]=r[1].get("error"),t=[r[7],r[8],r[9],r[4]],o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMediaSendResumeMediaSendJobStoredProcedure",e.__tables__=["media_send_jobs"],a.exports=e}),null);
__d("LSResumeMediaSendJobStoredProcedure",["LSResumeMediaSendJob","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSResumeMediaSendJob"),a.jobId,a.pluginType,a.dataTraceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWMediaDownloadStatusUIState",["I64","LSAuthorityLevel","LSIntEnum","LSMediaUrlUtils","MAWClientMediaStatusUtils","MAWMediaDownloadStatus","MessagingAttachmentType","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["MediaDownload"]),d=5;function m(t,n,a){if((a==null?void 0:a.receiverFetchId)!=null&&o("LSMediaUrlUtils").hasValidReceiverFetchPreviewUrl(a.previewUrl,a.previewUrlExpirationTimestampMs))return"downloaded";var i=n>=d,l=t!=null?t:{},s=l.mainMediaStatus,u=l.previewMediaStatus,m=t==null||s===r("MAWMediaDownloadStatus").DOWNLOADING||s===r("MAWMediaDownloadStatus").MISSING_FILE||s===r("MAWMediaDownloadStatus").RETRYING||s===r("MAWMediaDownloadStatus").AUTOMATICALLY_RETRYABLE_TIMEOUT_FAILURE,p=s===r("MAWMediaDownloadStatus").SUCCESS,f=s===r("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,g=f&&i,h=s===r("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,y=t==null||u===r("MAWMediaDownloadStatus").RETRYING||u===r("MAWMediaDownloadStatus").DOWNLOADING||u===r("MAWMediaDownloadStatus").MISSING_FILE||u===void 0&&m,C=u===r("MAWMediaDownloadStatus").SUCCESS,b=u===r("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE||u===void 0&&f,v=b&&i,S=u===r("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE||u===void 0&&h,R=a!=null&&_(a);if(R&&!y){if(C||p)return h||g?"non_retryable_error_with_preview":f?"retryable_error_with_preview":"downloaded";if(S||v)return"non_retryable_error";if(b)return"retryable_error"}else{if(p)return"downloaded";if(h||g)return"non_retryable_error";if(f)return"retryable_error";if(m)return"loading"}return c.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["useMAWMediaDownloadStatusUIState: unexpected download status"]))),"loading"}function p(e,t,n){var a,i=(n==null?void 0:n.transportKey)==="FBBroker"||(n==null?void 0:n.transportKey)==="FBLegacyBroker",l=!i&&n!=null&&(s||(s=o("I64"))).to_int32(n.authorityLevel)===r("LSAuthorityLevel").OPTIMISTIC,c=l&&t!=null?{id:t,mainMediaStatus:(u||(u=o("LSIntEnum"))).ofNumber(1),mainMediaStatusDetails:"optimistic_secure_upload",previewMediaStatus:(u||(u=o("LSIntEnum"))).ofNumber(1),previewMediaStatusDetails:"optimistic_secure_upload"}:e,d=c!=null?o("MAWClientMediaStatusUtils").getMAWMediaStatus(c):null,p=m(d,(s||(s=o("I64"))).to_int32((a=c==null?void 0:c.downloadRetryCount)!=null?a:(s||(s=o("I64"))).zero),n);return{mawMediaStatus:d,nonDebouncedUIState:p,status:c}}function _(e){if(e==null)return!1;var t=e.attachmentType;return(s||(s=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))||(s||(s=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))}l.getMediaDownloadStatusUIState=m,l.getNonDebouncedUIStateAndStatus=p}),98);
__d("MWChatForwardDialogQuery$Parameters",["MWChatForwardDialogQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e={kind:"PreloadableConcreteRequest",params:{id:n("MWChatForwardDialogQuery_facebookRelayOperation"),metadata:{},name:"MWChatForwardDialogQuery",operationKind:"query",text:null}};a.exports=e}),null);
__d("MWChatForwardDialog.entrypoint",["JSResourceForInteraction","MWChatForwardDialogQuery$Parameters","MWXacGating","WebPixelRatio"],(function(t,n,r,o,a,i,l){"use strict";var e={getPreloadProps:function(t){return{queries:{forwardQueryReference:{parameters:n("MWChatForwardDialogQuery$Parameters"),variables:{scale:o("WebPixelRatio").get(),suppress_xac_groups:!o("MWXacGating").isGroupsEnabled()}}}}},root:r("JSResourceForInteraction")("MWChatForwardDialog.react").__setRef("MWChatForwardDialog.entrypoint")};l.default=e}),98);
__d("useGetForwardSource",["LSIntEnum","LSMessagingThreadAttributionType","MWLSThreadDisplayContext","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("react-compiler-runtime").c(4),n=o("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();if(n!=null)if(n==="Inbox"){var a;return t[0]===Symbol.for("react.memo_cache_sentinel")?(a=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_INBOX_FORWARD),t[0]=a):a=t[0],a}else if(n==="ChatTab"){var i;return t[1]===Symbol.for("react.memo_cache_sentinel")?(i=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_CHAT_FORWARD),t[1]=i):i=t[1],i}else{var l;return t[2]===Symbol.for("react.memo_cache_sentinel")?(l=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW),t[2]=l):l=t[2],l}else{var s;return t[3]===Symbol.for("react.memo_cache_sentinel")?(s=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW),t[3]=s):s=t[3],s}}l.default=s}),98);
__d("useLSMessagingInitiatingSource",["LSIntEnum","LSMessagingInitiatingSource","MWLSThreadDisplayContext","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("react-compiler-runtime").c(4),n=o("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();if(n!=null)if(n==="Inbox"){var a;return t[0]===Symbol.for("react.memo_cache_sentinel")?(a=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingInitiatingSource").FACEBOOK_INBOX),t[0]=a):a=t[0],a}else if(n==="FullscreenChat"){var i;return t[1]===Symbol.for("react.memo_cache_sentinel")?(i=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingInitiatingSource").FACEBOOK_FULLSCREEN),t[1]=i):i=t[1],i}else if(n==="ChatTab"){var l;return t[2]===Symbol.for("react.memo_cache_sentinel")?(l=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingInitiatingSource").FACEBOOK_CHAT),t[2]=l):l=t[2],l}else{var s;return t[3]===Symbol.for("react.memo_cache_sentinel")?(s=(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingInitiatingSource").ROOMS_SIDE_CHAT),t[3]=s):s=t[3],s}}l.default=s}),98);
__d("MessagePowerUp",[],(function(t,n,r,o,a,i){var e=Object.freeze({AVATAR_LOVE:1e3,AVATAR_ANGER:1001,AVATAR_LAUGH:1002,AVATAR_CRY:1003,NONE:0,LOVE:1,GIFT_WRAP:2,CELEBRATION:3,FIRE:4,HALLOWEEN:5,NOM_NOM_DASH:6,NEW_YEARS:7,VALENTINES_DAY:8,ANTI_VALENTINES:9});i.default=e}),66);
__d("WorkChatMessageType",[],(function(t,n,r,o,a,i){"use strict";var e="text",l="gif",s="sticker",u="audio",c="file",d="hotEmoji";i.text=e,i.gif=l,i.sticker=s,i.audio=u,i.file=c,i.hotEmoji=d}),66);
__d("useMWLSSendStickerMessage",["I64","Int64Hooks","LSFactory","LSIntEnum","LSMailboxType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSOptimisticSendMessageV2StoredProcedure","LSShape","LSThreadAttributionTypeUtil","MWPActor.react","MessagePowerUp","WorkChatMessageType","promiseDone","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,n,a){var l=o("react-compiler-runtime").c(7),c=(u||(u=r("useReStore")))(),d=o("MWPActor.react").useActor(),m,p;return l[0]!==d||l[1]!==n||l[2]!==t||l[3]!==a||l[4]!==c?(m=function(u,m,p){r("promiseDone")(c.runInTransaction(function(a){var i=o("LSThreadAttributionTypeUtil").getSourceAndResetAttribution(u,t!=null?t:"unknown");return r("LSOptimisticSendMessageV2StoredProcedure")(r("LSFactory")(a),{extraSendMessageParams:o("LSShape").ofRecord({calculate_denormalizations:!0,initiating_source:n,mark_read:!0,optimistic_attachment_preview:o("LSShape").ofRecord({playable_url:void 0,playable_url_expiration_timestamp_ms:void 0,playable_url_fallback:void 0,playable_url_mime_type:void 0,preview_height:(e||(e=o("I64"))).zero,preview_url:p,preview_url_expiration_timestamp_ms:void 0,preview_url_fallback:void 0,preview_url_mime_type:void 0,preview_width:e.zero}),power_up_style:(s||(s=o("LSIntEnum"))).ofNumber(r("MessagePowerUp").NONE),reply_source_id:void 0,reply_source_type:s.ofNumber(r("LSMessageReplySourceType").MESSAGE),reply_source_type_v2:s.ofNumber(r("LSMessageReplySourceTypeV2").MESSAGE),snippet_has_emoji:!1,source:i,sticker_id:e.of_string(m)}),mailboxType:s.ofNumber(r("LSMailboxType").MESSENGER),senderId:d,threadKey:u,threadType:s.ofNumber(1)})},"readwrite",void 0,void 0,i.id+":49").then(function(e){a==null||a(o("WorkChatMessageType").sticker,1,e[0])}))},p=[c,d,n,t,a],l[0]=d,l[1]=n,l[2]=t,l[3]=a,l[4]=c,l[5]=m,l[6]=p):(m=l[5],p=l[6]),o("Int64Hooks").useCallbackInt64(m,p)}l.default=c}),98);
__d("MWLSForwardMessage",["I64","Int64Hooks","LSFactory","LSMediaUrlAttachment","LSOptimisticSendAttachmentForwardStoredProcedure","LSOptimisticSendMessageForwardStoredProcedure","MWChatThreadId","MWPActor.react","ODS","Promise","ReQL","promiseDone","react-compiler-runtime","useGetForwardSource","useLSMessagingInitiatingSource","useLSMessagingSource","useMWLSSendStickerMessage","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(){var t=o("react-compiler-runtime").c(7),a=(c||(c=r("useReStore")))(),l=o("MWPActor.react").useActor(),d=r("useLSMessagingInitiatingSource")(),f=r("useGetForwardSource")(),g=r("useLSMessagingSource")(),h=r("useMWLSSendStickerMessage")(g,d),y,C;return t[0]!==d||t[1]!==h||t[2]!==l||t[3]!==f||t[4]!==a?(y=function(c,g,y){if(y.type==="sent"){var t=y.value,C=t.timestamp,b=t.messageId,v=t.threadId;(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","send");var S=function(){return a.runInTransaction(function(e){return r("LSOptimisticSendMessageForwardStoredProcedure")(r("LSFactory")(e),{forwardedMsgId:b,forwardedMsgThreadKey:v,forwardedMsgTimestampMs:C,initiatingSource:d,senderId:l,source:f,threadKey:c,threadType:g})},"readwrite",void 0,void 0,i.id+":62").then(_)};r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.messages).getKeyRange(v,C,b)).then(function(t){if(t==null)return S();var r=t.stickerId;return r!=null?o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.attachments).getKeyRange(v,b)).then(function(t){var a=t!=null?o("LSMediaUrlAttachment").previewUrl(t):void 0;return h(c,(u||(u=o("I64"))).to_string(r),a),(e||(e=n("Promise"))).resolve()}):S()}),p,m)}},C=[a,l,d,f,h],t[0]=d,t[1]=h,t[2]=l,t[3]=f,t[4]=a,t[5]=y,t[6]=C):(y=t[5],C=t[6]),o("Int64Hooks").useCallbackInt64(y,C)}function m(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","failure")}function p(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","success")}function _(){}function f(){var e=o("react-compiler-runtime").c(6),t=(c||(c=r("useReStore")))(),n=o("MWPActor.react").useActor(),a=r("useLSMessagingInitiatingSource")(),l=r("useGetForwardSource")(),d,m;return e[0]!==a||e[1]!==n||e[2]!==l||e[3]!==t?(d=function(){return function(e,c,d){(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","send");var m=o("MWChatThreadId").getMessagingThreadType(e),p=o("MWChatThreadId").toThreadKey(e);r("promiseDone")(t.runInTransaction(function(e){return r("LSOptimisticSendAttachmentForwardStoredProcedure")(r("LSFactory")(e),{forwardedAttachmentFbid:(u||(u=o("I64"))).of_string(c),initiatingSource:a,senderId:n,source:l,threadKey:p,threadType:m})},"readwrite",void 0,void 0,i.id+":140"),h,g)}},m=[t,n,a,l],e[0]=a,e[1]=n,e[2]=l,e[3]=t,e[4]=d,e[5]=m):(d=e[4],m=e[5]),o("Int64Hooks").useMemoInt64(d,m)}function g(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","failure")}function h(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","success")}l.useForwardMessage=d,l.useForwardAttachment=f}),98);
__d("getFBTSafeGenderFromGenderConst",["GenderConst","IntlVariations"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case r("GenderConst").MALE_SINGULAR:return r("IntlVariations").GENDER_MALE;case r("GenderConst").FEMALE_SINGULAR:return r("IntlVariations").GENDER_FEMALE;default:return r("IntlVariations").GENDER_UNKNOWN}}l.default=e}),98);
__d("getMessengerPreciseTimestamp",["$InternalEnum","formatDate"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum").Mirrored(["TODAY","WEEK_AGO","CURRENT_YEAR","OTHER_YEAR"]),s=864e5,u=6*s;function c(t){var n=new Date(t),r=new Date,o=new Date(r.getFullYear(),r.getMonth(),r.getDate());return o<n?e.TODAY:o.getTime()-u<n.getTime()?e.WEEK_AGO:o.getFullYear()===n.getFullYear()?e.CURRENT_YEAR:e.OTHER_YEAR}function d(t){var n=c(t);switch(n){case e.TODAY:return"g:ia";case e.WEEK_AGO:return"l g:ia";case e.CURRENT_YEAR:return"F jS, g:ia";case e.OTHER_YEAR:return"F j, Y g:i a"}}function m(e,t){return r("formatDate")(new Date(e),d(e),void 0,t)}l.default=m}),98);
__d("MWMessageDeliveryStatus",["fbt","I64","LSIntEnum","getFBTSafeGenderFromGenderConst","getMessengerPreciseTimestamp","intlList","intlSummarizeNumber"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(e){if(e.length!==1)return{heads:e,type:"MultipleSeenHeads"};var t=e[0];return{head:t,type:"SingleSeenHead"}}function d(e,t){return{delivered:t,heads:e,type:"DeliveredAndRead"}}function m(e){return{count:e,type:"SeenCount"}}function p(e){return e.timestamp>0?s._(/*BTDS*/"_j{\"*\":\"Seen by {full name} at {seen time}\"}",[s._name("full name",e.name,r("getFBTSafeGenderFromGenderConst")(e.gender)),s._param("seen time",r("getMessengerPreciseTimestamp")(e.timestamp))]):s._(/*BTDS*/"_j{\"*\":\"Seen by {full name}\"}",[s._name("full name",e.name,r("getFBTSafeGenderFromGenderConst")(e.gender))])}function _(e,t){if(e.length===0)return"";if(t)return s._(/*BTDS*/"Seen by everyone").toString();var n=e.map(function(e){return s._(/*BTDS*/"_j{\"*\":\"{full name}\"}",[s._name("full name",e.name,r("getFBTSafeGenderFromGenderConst")(e.gender))])}),o=r("intlList")(n,r("intlList").CONJUNCTIONS.AND,r("intlList").DELIMITERS.COMMA);return s._(/*BTDS*/"Seen by {full name}",[s._param("full name",o)]).toString()}function f(e){var t=r("intlSummarizeNumber")(e);return s._(/*BTDS*/"Seen by {seen count}",[s._param("seen count",t)]).toString()}var g={delivered:s._(/*BTDS*/"Delivered"),error:s._(/*BTDS*/"Couldn't send"),loading:s._(/*BTDS*/"Loading..."),retriableError:s._(/*BTDS*/"Click to retry."),sending:s._(/*BTDS*/"Sending"),sent:s._(/*BTDS*/"Sent")};function h(e){switch(e.type){case"Sending":return g.sending;case"Sent":case"Delivered":return g.sent;case"Error":return g.error;case"SingleSeenHead":return p(e.head);case"NoneStatus":case"MultipleSeenHeads":return"";case"DeliveredAndRead":return _(e.heads,e.delivered);case"SeenCount":return f(e.count);case"Loading":return g.loading;case"RetriableError":return g.retriableError;case"ValidationError":return""}}function y(e){switch(e.type){case"Sending":return g.sending;case"Sent":return g.sent;case"Delivered":return g.delivered;case"Error":case"RetriableError":return g.error;case"SingleSeenHead":return p(e.head);case"DeliveredAndRead":return _(e.heads,e.delivered);default:return""}}function C(t){return(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(1))?{type:"Sending"}:(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(2))||(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(6))?{type:"Sent"}:(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(4))||(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(5))?{type:"Error"}:{type:"NoneStatus"}}function b(t,n,r){var a=C(t.sendStatusV2);return(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(4))||(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(5))||(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(1))?a:!r&&(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(2))?{type:"NoneStatus"}:(e||(e=o("I64"))).ge(n,t.timestampMs)?{type:"Delivered"}:a}function v(e){return["SingleSeenHead","Sending","MultipleSeenHeads","Error","RetriableError"].includes(e.type)}l.seenHead=c,l.deliveredAndRead=d,l.seenCount=m,l.getSingleSeenHead=p,l.getSeenCount=f,l.Titles=g,l.getBroadcastStatusTitle=h,l.getStatusTitle=y,l.getFromSendStatus=C,l.getDeliveryStatusForMessageSentByYou=b,l.isAlwaysShownStatus=v}),226);
__d("MWPComposerMediaUploadUtil",["FileMercuryUploadService","I64","LSGetAttachmentType","LSIntEnum","MessagingAttachmentType","ResumableUploadServiceState.enum","URI","cr:7187","emptyFunction","gkx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c="messenger_file",d="messenger_audio",m="messenger_image",p="messenger_video",_="file_type",f="image_type",g="video_type",h="audio_type",y="FILE_ATTACHMENT",C="VOICE_MESSAGE",b="target_id";function v(t,a,i,l,s,v){if(i===void 0&&(i=r("emptyFunction")),!!n("cr:7187")){var S=(u||(u=r("URI"))).getRequestURI().getDomain(),R=/workplace.com/i.test(S)?"workplace.com":/messenger.com/i.test(S)?"messenger.com":"facebook.com";l.forEach(function(l,u){var S,L=l.attachmentType,E=l.file,k=c,I=_,T=y;switch(L){case(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE):k=m,I=f;break;case(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO):k=d,I=h,T=C;break;case(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO):k=p,I=g;break;default:break}var D=n("cr:7187").create({consumer:k,customHttpHeaders:new Map([[b,v],[I,T]]),serviceDomain:R});D.addListener((S=r("ResumableUploadServiceState.enum")).START,function(){t&&t(s[u],E.size,E.type)}),D.addListener(S.SUCCESS,function(e){a(s[u],e.media_id)}),D.addListener(S.FAIL,function(e){i(s[u],{response:e})}),D.addListener(S.TRANSPORT_FAILURE,function(e){i(s[u],{response:e})}),D.resume(E)})}}async function S(t,a,i,l,u,c,d,m,p,_,f,g){if(a===void 0&&(a=r("emptyFunction")),l===void 0&&(l=r("emptyFunction")),u===void 0&&(u=!1),n("cr:7187")&&g!=null&&m!==!0){var h=[],y=[],C=[],b=[],S=await Promise.all(c.map(function(e){return o("LSGetAttachmentType").LSGetAttachmentType(e)}));c.forEach(function(t,n){var a=S[n];(s||(s=o("I64"))).equal(a,(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))?(h.push({attachmentType:a,file:t}),y.push(d[n])):(C.push(t),b.push(d[n]))}),h.length>0&&v(t,i,l,h,y,g),C.length>0&&r("promiseDone")(o("FileMercuryUploadService").uploadByMercuryUploadService({chatSupportUserId:p,chatSupportUserNonce:f,files:C,isChatSupportUser:m,isVoiceClip:u,onUploadFailure:l,onUploadProgress:a,onUploadStart:t,onUploadSuccess:i,uploadIDs:b,voiceClipWaveformData:_}))}else r("promiseDone")(o("FileMercuryUploadService").uploadByMercuryUploadService({chatSupportUserId:p,chatSupportUserNonce:f,files:c,isChatSupportUser:m,isVoiceClip:u,onUploadFailure:l,onUploadProgress:a,onUploadStart:t,onUploadSuccess:i,uploadIDs:d,voiceClipWaveformData:_}))}function R(t,n,a,i){var l;return{action_url:void 0,attachment_fbid:t,attachment_index:(s||(s=o("I64"))).zero,attachment_type:(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO),cta1_title:void 0,cta2_title:void 0,cta3_title:void 0,description_text:void 0,filename:void 0,filesize:void 0,has_media:!0,has_xma:!1,image_url:void 0,mini_preview:void 0,offline_attachment_id:t,original_file_hash:void 0,playable_duration_ms:s.of_float(a*1e3),playable_url:URL.createObjectURL(n),playable_url_mime_type:n.type,preview_height:void 0,preview_url:void 0,preview_url_mime_type:void 0,preview_width:void 0,sampling_frequency_hz:i==null?void 0:i.sampling_freq,source_text:void 0,subtitle_text:void 0,title_text:void 0,waveform_data:i==null||(l=i.amplitudes)==null?void 0:l.join(","),xma_layout_type:void 0,xmas_template_type:void 0}}function L(t,n,a){var i=t.map(function(e){return{action_url:void 0,attachment_fbid:e.offlineAttachmentId,attachment_index:(s||(s=o("I64"))).zero,attachment_type:e.attachmentType,cta1_title:void 0,cta2_title:void 0,cta3_title:void 0,description_text:void 0,filename:e.filename,filesize:void 0,has_media:!0,has_xma:!1,image_url:void 0,mini_preview:void 0,offline_attachment_id:e.offlineAttachmentId,original_file_hash:void 0,playable_duration_ms:void 0,playable_url:e.previewUrl,playable_url_mime_type:e.mimeType,preview_height:e.previewHeight,preview_url:e.previewUrl,preview_url_mime_type:void 0,preview_width:e.previewWidth,source_text:void 0,subtitle_text:void 0,title_text:void 0,xma_layout_type:void 0,xmas_template_type:void 0}}),l=[],u=[];return i.forEach(function(t){((s||(s=o("I64"))).equal(t.attachment_type,(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))||r("gkx")("4280")&&(s||(s=o("I64"))).equal(t.attachment_type,(e||(e=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO)))&&!n?(u.push(t),a===!0&&u.length===30&&(l.unshift([].concat(u)),u.length=0)):l.push([t])}),u.length>0&&(a===!0?l.push(u):l.unshift(u)),l.map(function(e){return e.map(function(e,t){return babelHelpers.extends({},e,{attachment_index:(s||(s=o("I64"))).of_int32(t)})})})}l.startUpload=S,l.getAudioAttachment=R,l.createPartitionedAttachments=L}),98);
__d("MWPOpenComposerUtils",["I64","LSRemoveMediaSendJobsStoredProcedure","LSResumeMediaSendJobStoredProcedure","MWConsole"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return e.media_staging.get(t).then(function(n){return n!=null?e.media_staging.delete(t):Promise.resolve()})}async function u(e,t,n){var r=await e.media_staging.get(t);r!=null&&await e.media_staging.put(n(r))}function c(e,t,n,r,o){return e.attachments.get(t,n,r).then(function(a){return a!=null?e.attachments.upsert([t,n,r],o(a)):Promise.resolve()})}function d(t,n,a){return r("LSResumeMediaSendJobStoredProcedure")(t,{dataTraceId:a!=null?a:void 0,jobId:n,pluginType:(e||(e=o("I64"))).zero}).then(function(e){var o=e[0],a=e[1],i=e[2];return o?r("LSRemoveMediaSendJobsStoredProcedure")(t,{offlineThreadingId:n}):Promise.resolve()})}l.deleteMediaStaging=s,l.updateMediaStaging=u,l.updateAttachment=c,l.resumeSendJob=d}),98);
__d("MWPThreadCapabilitiesContext",["I64","Int64Hooks","LSIntEnum","LSMessageThreadUnsendabilityStatus","LSThreadBitOffset","ThreadStatus","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=e||(e=o("react")),d=e,m=d.createContext,p=d.useContext,_=m({air131ShareChatMessagesWithMetaAiEnabled:!1,blurMediaEnabled:!1,canUnsendMessage:!1,communityMessagingChannelDescriptionCustomization:!1,communityMessagingChannelInvite:!1,disableLinks:!1,editMessageEnabled:!1,feedbackAndReportEnabled:!1,hasLSThreadBitOffset:function(t){return!1},isPaused:!1,localDeleteMessageEnabled:!1,messageForwardEnabled:!1,messageUnsendEnabled:!1,modifyPinnedMessageV2Enabled:!1,reactEnabled:!1,reactionsV2WriteEnabled:!1,replyEnabled:!1,reportMessageToAdminEnabled:!1,rtcVideoCallEnabled:!1,rtcVoiceCallEnabled:!1,seenCountV2Enabled:!1,subThreadCreationEnabled:!1});function f(e){var t=o("react-compiler-runtime").c(17),n=e.children,a=e.customCapabilityCheck,i=e.thread,l=i.capabilities,d=i.capabilities2,m=i.capabilities3,p=i.capabilities4,f=i.capabilities5,g=i.threadType,h,y;t[0]!==l||t[1]!==d||t[2]!==m||t[3]!==p||t[4]!==f||t[5]!==g?(h=function(t){var e={capabilities:l,capabilities2:d,capabilities3:m,capabilities4:p,capabilities5:f,threadType:g};return o("LSThreadBitOffset").has(t,e)},y=[l,d,m,p,f,g],t[0]=l,t[1]=d,t[2]=m,t[3]=p,t[4]=f,t[5]=g,t[6]=h,t[7]=y):(h=t[6],y=t[7]);var C=o("Int64Hooks").useCallbackInt64(h,y),b,v;t[8]!==a||t[9]!==C||t[10]!==i.cannotUnsendReason||t[11]!==i.threadStatus?(b=function(){return{air131ShareChatMessagesWithMetaAiEnabled:C(256),blurMediaEnabled:C(46),canUnsendMessage:i.cannotUnsendReason!=null?(s||(s=o("I64"))).equal(i.cannotUnsendReason,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageThreadUnsendabilityStatus").CAN_UNSEND)):!0,communityMessagingChannelDescriptionCustomization:C(135),communityMessagingChannelInvite:C(120),disableLinks:C(45),editMessageEnabled:C(194),feedbackAndReportEnabled:C(17),hasLSThreadBitOffset:C!=null?C:a,isPaused:i.threadStatus!=null&&((s||(s=o("I64"))).equal(i.threadStatus,(s||(s=o("I64"))).of_int32(r("ThreadStatus").PAUSED))||(s||(s=o("I64"))).equal(i.threadStatus,(s||(s=o("I64"))).of_int32(r("ThreadStatus").PAUSED_AND_UPGRADED_TO_COMMUNITY))),localDeleteMessageEnabled:C(102),messageForwardEnabled:C(103),messageUnsendEnabled:C(122)&&i.cannotUnsendReason!=null?(s||(s=o("I64"))).equal(i.cannotUnsendReason,(u||(u=o("LSIntEnum"))).ofNumber(r("LSMessageThreadUnsendabilityStatus").CAN_UNSEND)):!1,modifyPinnedMessageV2Enabled:C(172),reactEnabled:C(18),reactionsV2WriteEnabled:C(169),replyEnabled:C(42),reportMessageToAdminEnabled:C(93),rtcVideoCallEnabled:C(24),rtcVoiceCallEnabled:C(25),seenCountV2Enabled:C(140),subThreadCreationEnabled:C(167)}},v=[a,C,i.threadStatus,i.cannotUnsendReason],t[8]=a,t[9]=C,t[10]=i.cannotUnsendReason,t[11]=i.threadStatus,t[12]=b,t[13]=v):(b=t[12],v=t[13]);var S=o("Int64Hooks").useMemoInt64(b,v),R;return t[14]!==n||t[15]!==S?(R=c.jsx(_.Provider,{value:S,children:n}),t[14]=n,t[15]=S,t[16]=R):R=t[16],R}function g(){return p(_)}l.Provider=f,l.useMWPThreadCapabilitiesContext=g}),98);
__d("MWUnvaultedText",["cr:2472","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useMemo,u=function(t,r){return n("cr:2472")==null||r==null||r===""?r:t?n("cr:2472").unvaultOrThrow(r):n("cr:2472").unvault(r,!0)};function c(e,t){var n=o("react-compiler-runtime").c(3),r,a;n[0]!==e||n[1]!==t?(a=u(e,t),n[0]=e,n[1]=t,n[2]=a):a=n[2],r=a;var i=r;return i}l.getMWUnvaultedText=u,l.useMWUnvaultedText=c}),98);
__d("isDeliveryStatusErrorState",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.type==="Error"||e.type==="RetriableError"}i.default=e}),66);
__d("useIsSecureMessage",["LSMessagingThreadTypeUtil","ReQL","ReQLSuspense","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r,a=o("react-compiler-runtime").c(2),l=(r=o("ReQLSuspense").useFirst(function(){return t==null?o("ReQL").empty():o("ReQL").fromTableAscending(e.tables.threads,["threadType"]).getKeyRange(t.threadKey).map(s)},[e,t],i.id+":37"))!=null?r:n.fallbackThreadType;if(l==null){var u;return(u=n.fallbackIsSecure)!=null?u:!1}var c;return a[0]!==l?(c=o("LSMessagingThreadTypeUtil").isArmadilloSecure(l),a[0]=l,a[1]=c):c=a[1],c}function s(e){var t=e.threadType;return t}l.default=e}),98);
__d("useMAWMediaDebouncedState",["clearTimeout","justknobx","react","react-compiler-runtime","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useRef,d=s.useState;function m(e){var t=o("react-compiler-runtime").c(5),n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=r("justknobx")._("3145"),t[0]=n):n=t[0];var a=n,i=d(e),l=i[0],s=i[1],u=c(null),m;t[1]===Symbol.for("react.memo_cache_sentinel")?(m=function(){r("clearTimeout")(u.current),u.current=null},t[1]=m):m=t[1];var p=m,_;t[2]===Symbol.for("react.memo_cache_sentinel")?(_=function(t,n){if(p(),!n){s(t);return}u.current=r("setTimeout")(function(){s(t)},a)},t[2]=_):_=t[2];var f=_,g;return t[3]!==l?(g=[l,f,p],t[3]=l,t[4]=g):g=t[4],g}l.default=m}),98);
__d("useMAWBulkMediaDownloadStatusUIStateDebounced",["react","react-compiler-runtime","useMAWMediaDebouncedState"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useEffect;function u(e){var t=o("react-compiler-runtime").c(4),n=r("useMAWMediaDebouncedState")(e),a=n[0],i=n[1],l,u;return t[0]!==i||t[1]!==e?(l=function(){i(e,!e.some(c))},u=[e,i],t[0]=i,t[1]=e,t[2]=l,t[3]=u):(l=t[2],u=t[3]),s(l,u),a}function c(e){return e==="loading"||e==="downloaded"}l.default=u}),98);
__d("useMAWMediaDownloadStatusBulk",["MAWMediaDownloadStatusUIState","cr:17206","emptyHook","react","useMAWBulkMediaDownloadStatusUIStateDebounced"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useMemo,u=n("cr:17206")||{useFetchInitialDownloadStatusBulk:r("emptyHook").thatReturnsNull};function c(e,t){var n=s(function(){return e.map(function(e){var n=e.attachment,r=e.mediaRenderQpl,a=e.mediaStatus,i=e.statusKey,l=a!=null?a:t==null?void 0:t.find(function(e){var t=e.id;return t===i});return babelHelpers.extends({},o("MAWMediaDownloadStatusUIState").getNonDebouncedUIStateAndStatus(l,i,n),{attachment:n,mediaRenderQpl:r,statusKey:i})})},[e,t]),a=s(function(){var e=[],t=[],r=[];return n.forEach(function(n){e.push(n.mawMediaStatus),t.push(n.nonDebouncedUIState),r.push({attachment:n.attachment,mediaRenderQpl:n.mediaRenderQpl,mediaStatus:n.status,statusKey:n.statusKey})}),[e,t,r]},[n]),i=a[0],l=a[1],c=a[2],d=r("useMAWBulkMediaDownloadStatusUIStateDebounced")(l);return u.useFetchInitialDownloadStatusBulk(c),{mawMediaStatuses:i,uiStates:d}}l.default=c}),98);
__d("useMWChatForward",["MWChatForwardDialog.entrypoint","MessengerWebUXLogger","react","react-compiler-runtime","useMWXEntryPointDialog"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useRef;function d(e){var t=o("react-compiler-runtime").c(11),n=e.dropToggle,a=e.forwardDialogType,i=e.messageID,l=e.onClose,s=e.onSend,u=c(null),d;t[0]===Symbol.for("react.memo_cache_sentinel")?(d={},t[0]=d):d=t[0];var m=r("useMWXEntryPointDialog")(r("MWChatForwardDialog.entrypoint"),d),p=m[0],_=r("MessengerWebUXLogger").useInteractionLogger(),f;t[1]!==n||t[2]!==a||t[3]!==_||t[4]!==i||t[5]!==l||t[6]!==s||t[7]!==p?(f=function(){p({dropToggle:n,forwardDialogType:a,messageID:i,onSend:s},l,_==null?void 0:_("forward_message"))},t[1]=n,t[2]=a,t[3]=_,t[4]=i,t[5]=l,t[6]=s,t[7]=p,t[8]=f):f=t[8];var g=f,h;return t[9]!==g?(h={onClick:g,triggerRef:u},t[9]=g,t[10]=h):h=t[10],h}l.default=d}),98);
__d("useMWIsContactRestricted",["LSContactBitOffset","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("react-compiler-runtime").c(2),n;t[0]!==e?(n=e!=null&&o("LSContactBitOffset").has(66,e),t[0]=e,t[1]=n):n=t[1];var r=n;return r}l.default=e}),98);
__d("useMWV2ForwardMessage",["$InternalEnum","CometRelay","FBLogger","I64","Int64Hooks","LSIntEnum","LSMessagingThreadTypeUtil","MAWDbMsg","MAWExternalId","MAWThreadId","MAWVault","MAWVerifyThreadCutover","MWChatMessageId","MWChatThreadId","MWLSForwardMessage","MWPActor.react","MWSharedMsgLogUtils","MWSharedS2SBaseAnnotations","MWUnvaultedText","ReQL","ReQLSuspense","WAResultOrError","cr:19816","cr:19893","cr:19894","cr:9759","promiseDone","react","react-compiler-runtime","sendToSentQPLLogger","useGetForwardSource","useIsSecureMessage","useLSMessagingSource","useReStore","useStringWithSubstitutions"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(s||(s=o("react"))).useMemo;function m(e,t,n){var r;return(r=o("ReQL")).firstAsync(r.mergeJoin(r.fromTableAscending(e.tables.participants).getKeyRange(t),r.fromTableAscending(e.tables.contacts)).filter(function(e){var t=e[0],r=e[1];return!(c||(c=o("I64"))).equal(r.id,n)}))}function p(e,t,n){var r=o("react-compiler-runtime").c(20),a=t.messageId,l=t.threadKey,s;r[0]!==e.tables.attachments||r[1]!==a||r[2]!==l?(s=function(){return o("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(l,a)},r[0]=e.tables.attachments,r[1]=a,r[2]=l,r[3]=s):s=r[3];var u;r[4]!==e||r[5]!==a||r[6]!==l?(u=[e,a,l],r[4]=e,r[5]=a,r[6]=l,r[7]=u):u=r[7];var c=o("ReQLSuspense").useArray(s,u,i.id+":89"),d;r[8]!==n||r[9]!==e.tables.attachments||r[10]!==a||r[11]!==l?(d=function(){return n!=null?o("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(l,a,n):o("ReQL").empty()},r[8]=n,r[9]=e.tables.attachments,r[10]=a,r[11]=l,r[12]=d):d=r[12];var m;r[13]!==n||r[14]!==e||r[15]!==a||r[16]!==l?(m=[n,e,a,l],r[13]=n,r[14]=e,r[15]=a,r[16]=l,r[17]=m):m=r[17];var p=o("ReQLSuspense").useFirst(d,m,i.id+":98"),_=c.length>0?c[0]:void 0;if(n!=null){var f=p!=null?p:_,g;return r[18]!==f?(g=f!=null?[f]:[],r[18]=f,r[19]=g):g=r[19],g}return c}function _(){var t=(e||(e=r("useReStore")))();return o("Int64Hooks").useCallbackInt64(async function(e,a,i,l,s,u,c,d,p){var _=o("MWChatThreadId").toThreadKey(s),g=o("MWChatThreadId").getMessagingThreadType(s),h=await o("MAWVerifyThreadCutover").verifyThreadCutover(Promise.resolve(t),_),y=await Promise.all([o("MAWThreadId").isSecureThreadKey(t.tables,_),o("MAWThreadId").getThread(t.tables,_),m(t,_,i)]),C=y[0],b=y[1],v=y[2],S=C||h;try{if(n("cr:19893")!=null&&!S)return o("sendToSentQPLLogger").addSendToSentAnnotations(u,{string:{forward_type:f.SecureToOpen}}),d!=null?await Promise.allSettled([d.messagesAndAttachments.map(function(e){var r;return n("cr:19893").forwardMessage(t,_,g,e.message,l,(r=e.attachment)!=null?r:void 0,i,c)})]):await n("cr:19893").forwardMessage(t,_,g,e,l,a[0],i,c,p),o("sendToSentQPLLogger").markSendToSentSuccess(u),[o("WAResultOrError").makeResult({description:"open message",messageType:"fixMe"})];var R=o("MAWDbMsg").toMsgId(e.messageId);if(R==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("Message does not have an id");if(n("cr:19816")!=null){o("sendToSentQPLLogger").addSendToSentAnnotations(u,{string:{forward_type:f.SecureToSecure}});var L;if(d!=null){var E=d.messagesAndAttachments.map(function(e){return o("MAWDbMsg").toMsgId(e.message.messageId)}).filter(Boolean);L=await n("cr:19816").forwardMessageBatch(t,_,E,c,u)}else L=await n("cr:19816").forwardMessage(t,_,R,c,u,p!=null?o("MAWVault").vault(p):void 0).then(function(e){return[e]});return n("cr:9759")!=null&&b!=null&&await n("cr:9759")(t,b,v,o("LSMessagingThreadTypeUtil").isOneToOne(b.threadType)),L!=null?L:[o("WAResultOrError").makeResult({description:"removal pending rollout of MAWMessageSendReporterV2",messageType:"fixMe"})]}throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We won't reach to this step, if you are in QE, you should use secure forward")}catch(e){throw o("sendToSentQPLLogger").markSendToSentFail(u,"failed_forwarding_message",e),r("FBLogger")("messenger_web").catching(e).mustfix("MW Fail forwarding a message"),e}},[t])}var f=n("$InternalEnum")({SecureToOpen:"secure_to_open",OpenToOpen:"open_to_open",SecureToSecure:"secure_to_secure",OpenToSecure:"open_to_secure"});function g(t,a,i,l){var s,d=o("react-compiler-runtime").c(68),g=(e||(e=r("useReStore")))(),y=p(g,t,i),C;d[0]!==a?(C={fallbackThreadType:a},d[0]=a,d[1]=C):C=d[1];var b=r("useIsSecureMessage")(g,t,C),v=o("MWPActor.react").useActor(),S=!(c||(c=o("I64"))).equal(v,t.senderId),R=o("MWLSForwardMessage").useForwardMessage(),L=o("MWLSForwardMessage").useForwardAttachment(),E=r("useGetForwardSource")(),k;d[2]!==t.messageId||d[3]!==t.threadKey||d[4]!==t.timestampMs?(k=o("MWChatMessageId").makeSent((c||(c=o("I64"))).to_string(t.threadKey),t.messageId,c.to_string(t.timestampMs)),d[2]=t.messageId,d[3]=t.threadKey,d[4]=t.timestampMs,d[5]=k):k=d[5];var I=k,T=o("CometRelay").useRelayEnvironment(),D=_(),x;d[6]!==t.displayedContentTypes?(x=o("MWSharedMsgLogUtils").getMessageTypeFromDisplayedContentType(t.displayedContentTypes),d[6]=t.displayedContentTypes,d[7]=x):x=d[7];var $=x,P=r("useLSMessagingSource")(),N,M;if(d[8]!==t.mentionIds){var w,A;M=new Set((w=(A=t.mentionIds)==null||A.split==null?void 0:A.split(","))!=null?w:[]),d[8]=t.mentionIds,d[9]=M}else M=d[9];N=M;var F=N,O=F.size>0,B=o("MWUnvaultedText").useMWUnvaultedText(!1,t.text),W=(s=o("useStringWithSubstitutions").useStringWithMentionSubstitutionsAndUpdatedRanges(b?B:null,[],F,t.threadKey))!=null?s:{textWithSubstitutions:B},q=W.textWithSubstitutions,U;d[10]!==y||d[11]!==g.tables||d[12]!==O||d[13]!==S||d[14]!==l||d[15]!==t||d[16]!==$||d[17]!==D||d[18]!==v||d[19]!==E||d[20]!==q?(U=async function(n){var e=o("MWChatThreadId").toThreadKey(n),r=await o("MAWThreadId").getThread(g.tables,e),a=function(r){return D(t,y,v,S,n,r,E,l,O?q:void 0)},i=o("sendToSentQPLLogger").markSendToSentStartWithAnnotation(r,{isForward:!0,mediaGroupInfo:l},(u||(u=o("LSIntEnum"))).unwrapIntEnum(E),{string:{attachment_type:"forward",message_type:$}});await a(i)},d[10]=y,d[11]=g.tables,d[12]=O,d[13]=S,d[14]=l,d[15]=t,d[16]=$,d[17]=D,d[18]=v,d[19]=E,d[20]=q,d[21]=U):U=d[21];var V;d[22]!==y||d[23]!==g||d[24]!==O||d[25]!==S||d[26]!==P||d[27]!==l||d[28]!==t||d[29]!==$||d[30]!==D||d[31]!==v||d[32]!==E||d[33]!==q?(V=[g,v,P,l,E,D,t,y,S,$,q,O],d[22]=y,d[23]=g,d[24]=O,d[25]=S,d[26]=P,d[27]=l,d[28]=t,d[29]=$,d[30]=D,d[31]=v,d[32]=E,d[33]=q,d[34]=V):V=d[34];var H=o("Int64Hooks").useCallbackInt64(U,V),G;d[35]!==i||d[36]!==y||d[37]!==g||d[38]!==L||d[39]!==R||d[40]!==S||d[41]!==t||d[42]!==$||d[43]!==I||d[44]!==T||d[45]!==v||d[46]!==E?(G=async function(a){var e=o("MWChatThreadId").toThreadKey(a),l=o("MWChatThreadId").getMessagingThreadType(a),s=await Promise.all([o("MAWThreadId").isSecureThreadKey(g.tables,e),o("MAWThreadId").getThread(g.tables,e),m(g,e,v),o("MAWVerifyThreadCutover").verifyThreadCutover(Promise.resolve(g),e),o("MAWThreadId").getThread(g.tables,e)]),c=s[0],d=s[1],p=s[2],_=s[3],C=s[4],b=c||_,k=function(t){var e=o("sendToSentQPLLogger").markSendToSentStart();if(C!=null){var n=o("MWSharedS2SBaseAnnotations").getMessageTypeParams({isForward:!0,threadType:C.threadType});r("promiseDone")(o("MWSharedMsgLogUtils").getSendToSentAnnotations({attachmentTypeParams:n,messageOfflineThreadingId:t,source:(u||(u=o("LSIntEnum"))).unwrapIntEnum(E),thread:C}),function(t){t.string=babelHelpers.extends({},t.string,{attachment_type:"forward",message_type:$}),o("sendToSentQPLLogger").addSendToSentAnnotations(e,t)})}return o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{forward_type:f.OpenToSecure,message_type:$}}),e};if(n("cr:19894")!=null&&b){var D=function(o,a){return function(r){return n("cr:19894").forwardMessage(T,g,e,t,S,a,E,r!=null?r:void 0,o).then(h)}};if(y.length===0){var x=o("MAWExternalId").generateExternalId(),P=k(x);await D(x,void 0)(P),o("sendToSentQPLLogger").markSendToSentSuccess(P)}else await Promise.all(y.map(async function(e){var t=o("MAWExternalId").generateExternalId(),n=k(t);try{await D(t,e)(n),o("sendToSentQPLLogger").markSendToSentSuccess(n)}catch(e){var a=e;throw o("sendToSentQPLLogger").markSendToSentFail(n,"failed_forwarding_message",a),r("FBLogger")("messenger_web").catching(a).mustfix("MW Fail forwarding a message"),a}}));n("cr:9759")!=null&&d!=null&&n("cr:9759")(g,d,p,o("LSMessagingThreadTypeUtil").isOneToOne(d.threadType))}else if(!b){var N=k();try{o("sendToSentQPLLogger").addSendToSentAnnotations(N,{string:{forward_type:f.OpenToOpen,message_type:$}}),i==null?R(e,l,I):L(a,i),o("sendToSentQPLLogger").markSendToSentSuccess(N);return}catch(e){var M=e;throw o("sendToSentQPLLogger").markSendToSentFail(N,"failed_forwarding_message",M),r("FBLogger")("messenger_web").catching(M).mustfix("MW Fail forwarding a message"),M}}},d[35]=i,d[36]=y,d[37]=g,d[38]=L,d[39]=R,d[40]=S,d[41]=t,d[42]=$,d[43]=I,d[44]=T,d[45]=v,d[46]=E,d[47]=G):G=d[47];var z;d[48]!==i||d[49]!==y||d[50]!==g||d[51]!==L||d[52]!==R||d[53]!==S||d[54]!==P||d[55]!==l||d[56]!==t||d[57]!==$||d[58]!==I||d[59]!==T||d[60]!==v||d[61]!==E?(z=[g,v,E,i,T,t,S,l,P,y,R,I,L,$],d[48]=i,d[49]=y,d[50]=g,d[51]=L,d[52]=R,d[53]=S,d[54]=P,d[55]=l,d[56]=t,d[57]=$,d[58]=I,d[59]=T,d[60]=v,d[61]=E,d[62]=z):z=d[62];var j=o("Int64Hooks").useCallbackInt64(G,z),K,Q;return d[63]!==j||d[64]!==H||d[65]!==b?(Q=function(){return b?H:j},K=[b,H,j],d[63]=j,d[64]=H,d[65]=b,d[66]=K,d[67]=Q):(K=d[66],Q=d[67]),o("Int64Hooks").useMemoInt64(Q,K)}function h(e){return[e]}l.ForwardType=f,l.useMWV2ForwardMessage=g}),98);
__d("useMWV2MessageForwardAction",["I64","LSBitFlag","LSIntEnum","MWChatMessageId","MWV2LogMessageClick","MWV2MessageRowIsRowFocusedContext.react","gkx","promiseDone","qex","react","react-compiler-runtime","useMWChatForward","useMWV2ForwardMessage","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=c||(c=o("react")),m=d.useCallback,p=d.useContext;function _(t,n,a,i){var l=o("react-compiler-runtime").c(20),c=(e||(e=r("useReStore")))(),d=r("gkx")("20836"),m=!d&&t,_=!d&&r("qex")._("564")===!0,y=m?_?"cross_transport":"secure":_?"cross_transport":"open_",C;l[0]!==n.messageId||l[1]!==n.threadKey||l[2]!==n.timestampMs?(C=o("MWChatMessageId").makeSent((s||(s=o("I64"))).to_string(n.threadKey),n.messageId,s.to_string(n.timestampMs)),l[0]=n.messageId,l[1]=n.threadKey,l[2]=n.timestampMs,l[3]=C):C=l[3];var b=C,v=o("useMWV2ForwardMessage").useMWV2ForwardMessage(n,a,i==null?void 0:i.attachmentFbid),S=p(o("MWV2MessageRowIsRowFocusedContext.react").context),R=S.setFocused,L=S.setIsDialogOpened,E=n.stickerId,k=!t,I=o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(1),n.displayedContentTypes)&&!n.textHasLinks||o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(16384),n.displayedContentTypes)||o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(2),n.displayedContentTypes)||o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(4),n.displayedContentTypes)||o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(512),n.displayedContentTypes)||o("LSBitFlag").has((u||(u=o("LSIntEnum"))).ofNumber(1024),n.displayedContentTypes)||E!=null&&(s||(s=o("I64"))).equal(E,(s||(s=o("I64"))).of_string("369239263222822"))||E!=null&&(s||(s=o("I64"))).equal(E,(s||(s=o("I64"))).of_string("369239343222814"))||E!=null&&(s||(s=o("I64"))).equal(E,(s||(s=o("I64"))).of_string("369239383222810")),T=k&&!I,D;l[4]!==R||l[5]!==L?(D=function(){L(h),R(g)},l[4]=R,l[5]=L,l[6]=D):D=l[6];var x=D,$;l[7]!==v?($=function(t){return r("promiseDone")(v(t))},l[7]=v,l[8]=$):$=l[8];var P=$,N;l[9]!==y||l[10]!==b||l[11]!==T||l[12]!==x||l[13]!==P?(N={dropToggle:T,forwardDialogType:y,messageID:b,onClose:x,onSend:P},l[9]=y,l[10]=b,l[11]=T,l[12]=x,l[13]=P,l[14]=N):N=l[14];var M=r("useMWChatForward")(N),w;return l[15]!==c||l[16]!==M||l[17]!==n||l[18]!==L?(w=function(){o("MWV2LogMessageClick").log(c,n,44),M!=null&&(L(f),M.onClick())},l[15]=c,l[16]=M,l[17]=n,l[18]=L,l[19]=w):w=l[19],w}function f(){return!0}function g(){return!0}function h(){return!1}l.default=_}),98);